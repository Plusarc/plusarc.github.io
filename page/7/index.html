<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="google-site-verification" content="google88d81a02a91db82f">















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=7.1.1">


  <link rel="mask-icon" href="/favicon.ico?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'LP2H1MWXO2',
      apiKey: '69bf93a909694ef7f679098292b442ca',
      indexName: 'Plusaber',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Plusaber&apos;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Plusaber&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Plusaber&#39;s Blog">
<meta property="og:description" content="Plusaber&apos;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Plusaber&#39;s Blog">
<meta name="twitter:description" content="Plusaber&apos;s Blog">





  
  
  <link rel="canonical" href="http://yoursite.com/page/7/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Plusaber's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Plusaber's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/06/05/Java_Spring(1)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Plusaber">
      <meta itemprop="description" content="Plusaber's Blog">
      <meta itemprop="image" content="/images/plusaber.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Plusaber's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/06/05/Java_Spring(1)/" class="post-title-link" itemprop="url">Spring(1)_基础</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-06-05 00:00:00" itemprop="dateCreated datePublished" datetime="2015-06-05T00:00:00+09:00">2015-06-05</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2015/06/05/Java_Spring(1)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/06/05/Java_Spring(1)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Spring 框架是一个开源的 Java 平台，它为容易而快速的开发出耐用的 Java 应用程序提供了全面的基础设施。Spring最基本的使命是：<strong>简化Java开发</strong>。Spring 框架的核心特性可以用于开发任何 Java 应用程序，但是在 Java EE 平台上构建 web 应用程序是需要扩展的。 Spring 框架的目标是使 J2EE 开发变得更容易使用，通过启用基于 POJO 编程模型来促进良好的编程实践。</p>
<p>为了降低Java开发的复杂性，Spring采取了一下4种关键策略：</p>
<ul>
<li>基于POJO(bean)的轻量级和最小侵入性编程；</li>
<li>通过依赖注入和面向接口实现松耦合；</li>
<li>基于切面和管理进行声明式编程；</li>
<li>通过切面和模板减少样板式代码。</li>
</ul>
<p>Spring最重要的两个特性是<strong>依赖注入</strong>和<strong>基于切面编程</strong>。</p>
<h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><p>在面向对象编程中，我们将不可避免的耦合对象，也就在一个对象的功能中需要依赖与其他一些对象。耦合具有两面性，一方面耦合的代码难以测试，难以复用。另一方面耦合是必须的—完全没有的耦合的代码什么也做不了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DamselRescuingKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> RescueDamselQuest quest;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DamselRescuingKnight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.quest = <span class="keyword">new</span> RescueDamselQuest(); <span class="comment">// 紧耦合</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      quest.embark();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上面的代码，如果需要不同的quest的行为，则无法轻易实现，必须修改源代码，且无法复用。</p>
<p>通过依赖注入(DI)，对象的依赖关系将有负责协调系统中对各个对象的第三方组件在创建对象时设定。对象无需自行创建或管理它们的依赖关系—也就是对象无需自己创建需要依赖的对象，而是创建时有第三方安排合适的需要依赖的对象给这个对象。</p>
<p>到底什么是依赖注入？让我们将这两个词分开来看一看。这里将依赖关系部分转化为两个类之间的关联。例如，类A依赖于类B。现在，让我们看一看第二部分，注入。所有这一切都意味着类B 将通过 IoC 被注入到类 A 中。</p>
<p>依赖注入可以以向构造函数传递参数的方式发生，或者通过使用 setter 方法 post-construction。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Quest quest;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BraveKnight</span><span class="params">(Quest quest)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.quest = quest; <span class="comment">// 构造器注入</span></span><br><span class="line">  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      quest.embark();</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuest</span><span class="params">(Quest quest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.quest = quest; <span class="comment">// setter注入</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样BraveKnigh没有与任何特定的Quest实现发生耦合。只需要直接使用依赖对象的方法，而该依赖对象会在运行时有第三方指定。这就是依赖注入最大的好处—松耦合。</p>
<p>现在BraveKnight类可以接受传递给它的任何一种Quest的实现，我们又该如何将特定的Query实现传递给它？</p>
<p>在Spring中，每个对象都是一个bean，由Spring容器管理。创建应用组件（对象）之间的协作关系的行为通常称为装配。Spring有多种装配Bean的方式，采用XML配置通常是最常见的装配方式，也就是，对象之间的协作关系都在XML中指定。下面是一个简单的Spring配置文件:knights.xml，该配置文件让BraveKnight接受了一个SlayDragonQuest探险任务。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"knight"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.BraveKnight"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"quest"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Inject quest bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"quest"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.SlayDragonQuest"</span>&gt;</span> <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#&#123;T(System).out&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下一步需要做的是装载XML配置文件，并把应用启动起来。<br>Spring通过应用上下文(Application Context)装载Bean的定义并把他们组装起来。Spring应用上下文全权负责对象的创建和组装。Spring自带了几种应用上下文的实现，它们之间的主要区别是如何加载它们的配置。</p>
<p>因为knight.xml中的Bean是在XML文件中声明的，随意选择ClassPathXmlApplicaitonContext作为应用上下文是比较合适的，该类加载位于应用系统classpath下的一个或多个xml文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.support.</span><br><span class="line">ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnightMain</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ClassPathXmlApplicationContext context =</span><br><span class="line">Load Spring context</span><br><span class="line">Get knight bean</span><br><span class="line">          <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">            <span class="string">"META-INF/spring/knight.xml"</span>);</span><br><span class="line">    Knight knight = context.getBean(Knight.class);</span><br><span class="line">    knight.embarkOnQuest();</span><br><span class="line">     context.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="面向切面编程-AOP"><a href="#面向切面编程-AOP" class="headerlink" title="面向切面编程(AOP)"></a>面向切面编程(AOP)</h2><p>依赖注入让相互协作的软件组件保持松散耦合，而AOP编程允许把遍布应用的功能分离出来形成可重用的组件。</p>
<p>面向切面编程往往被定义为促使应用程序分离关注点的一项技术。系统通常由许多不同组件组成，每一个组件各负责一块特定功能。一些组件除了实现自身核心的功能之外，还经常承担额外的职责。诸如日志、事务管理和安全之类的系统服务经常融入到有自身核心业务逻辑的组件中去，这些系统业务通常称为<strong>横切关注点</strong>，因为它们总是跨越系统的多个组件。</p>
<p>如果将这些关注点，分散到多个组件中去，代码将出现双重复杂性：</p>
<ul>
<li>如果横切关注点实现代码将重复出现在多个组件（模块）中。如果要改变这些关注点的逻辑，则必须修改每个组件的相关代码。即是我们将其抽象成模块，其他模块只是调用其方法，但是方法的调用还是会重复出现在各个模块中。</li>
<li>组件的代码可能会因为处理这些横切关注点的使用（也就是与自身核心业务无关的代码）变得混乱。一个像地址簿增加地址条目的方法应该只关注如何添加地址，而不是同时需要关注是不是安全或者是否需要支持事务。</li>
</ul>
<p>下面图片展示了这种复杂性。左边的业务对象与系统级服务集合的过于紧密。每个对象不但需要知道它需要日志，安全控制，事务处理，而且还要亲自执行这些服务。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Spring_aop_example1.png" alt="Spring_aop_example1"></p>
<p>AOP使这些服务模块化，并以声明的方式讲它们应用到需要影响的组件中去。结果是功能组件具有更高内聚性以及更加关注自身业务，完全不需要了解系统服务的复杂性，从而保持POJO简单。</p>
<p>如下面图片所示，AOP可以让我们使用各种功能层去包裹核心业务。这些功能层也声明的方式应用到系统中，核心业务甚至根本不知道这些服务的存在。使得我们可以将横切关注点和业务逻辑模块分离。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Spring_aop_example2.png" alt="Spring_aop_example2"></p>
<p>假设knight在执行任务之前需要辅助者进行一些操作，最直接的方式是由knight自己直接调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Minstrel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> PrintStream stream;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Minstrel</span><span class="params">(PrintStream stream)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.stream = stream;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singBeforeQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      stream.println(<span class="string">"Fa la la, the knight is so brave!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singAfterQuest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      stream.println(<span class="string">"Tee hee hee, the brave knight "</span> +</span><br><span class="line">        <span class="string">"did embark on a quest!"</span>);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.knights;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BraveKnight</span> <span class="keyword">implements</span> <span class="title">Knight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Quest quest;</span><br><span class="line">    <span class="keyword">private</span> Minstrel minstrel;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BraveKnight</span><span class="params">(Quest quest, Minstrel minstrel)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.quest = quest;</span><br><span class="line">      <span class="keyword">this</span>.minstrel = minstrel;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">embarkOnQuest</span><span class="params">()</span> <span class="keyword">throws</span> QuestException </span>&#123;</span><br><span class="line">      minstrel.singBeforeQuest();</span><br><span class="line">      quest.embark();</span><br><span class="line">      minstrel.singAfterQuest();</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Should a knight manage his own minstrel?</span></span><br></pre></td></tr></table></figure>
<p>这样做可以达到预期效果，但是knight引入不少与自身业务无关的代码，如果需要更多的战斗前准备，代码将会变得很混乱和难以修改。我们希望kinght只需关注自己的业务，Minstrel能自己判断并在knight战斗前后执行相应操作。</p>
<p>我们可以把Minstrel抽象为一个切面：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/aop/spring-aop-3.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"knight"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.BraveKnight"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"quest"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"quest"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.SlayDragonQuest"</span>&gt;</span> <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#&#123;T(System).out&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"minstrel"</span> <span class="attr">class</span>=<span class="string">"com.springinaction.knights.Minstrel"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"#&#123;T(System).out&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"minstrel"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"embark"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">"execution(* *.embarkOnQuest(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">pointcut-ref</span>=<span class="string">"embark"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">method</span>=<span class="string">"singBeforeQuest"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">pointcut-ref</span>=<span class="string">"embark"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">method</span>=<span class="string">"singAfterQuest"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里使用Spring的AOP配置的命名空间把Minstrel Bean声明为一个切面。首先把其声明一个bean，然后在<code>&lt;aop:aspect&gt;</code>元素中引用该Bean。更加具体的语法说明会在后面介绍。</p>
<h2 id="使用模板消除样板式代码"><a href="#使用模板消除样板式代码" class="headerlink" title="使用模板消除样板式代码"></a>使用模板消除样板式代码</h2><h1 id="容纳Bean"><a href="#容纳Bean" class="headerlink" title="容纳Bean"></a>容纳Bean</h1><h2 id="Spring容器"><a href="#Spring容器" class="headerlink" title="Spring容器"></a>Spring容器</h2><p>在基于Spring的应用中，应用对象生存于Spring容器中。Spring容器负责创建对象，装配对象，配置，管理对象的整个生命周期。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Spring_aop_example3.png" alt></p>
<p>容器是Spring框架的核心。Spring容器使用依赖注入管理构成应用的组件，创建相互协作的组件之间的关联。毫无疑问，这些对象更加简单干净，容易理解，更加容易重用以及更易于单元测试。</p>
<p>Spring有两种类型的容器：<code>Bean工厂</code>（BeanFactory）是最简单的容器，提供了基本的DI支持。应用上下文基于BeanFactory之上构建，并提供面向应用的服务，例如从属性文件解析文本信息的能力，以及发布应用事件给感兴趣的时间监听者的能力。</p>
<p>在大部分情况下Bean工厂由于太简单无法满足需求，所以一般使用上下文。</p>
<h2 id="应用上下文"><a href="#应用上下文" class="headerlink" title="应用上下文"></a>应用上下文</h2><p>Spring自带了几种类型的应用上下文：</p>
<ul>
<li><code>AnnotationConfigApplicationContext</code>—Loads a Spring application context from one or more Java-based configuration classes</li>
<li><code>AnnotationConfigWebApplicationContext</code>—Loads a Spring web application context from one or more Java-based configuration classes</li>
<li><code>ClassPathXmlApplicationContext</code>—Loads a context definition from one or more XML files located in the classpath, treating context-definition files as class- path resources</li>
<li><code>FileSystemXmlApplicationContext</code>—Loads a context definition from one or more XML files in the filesystem</li>
<li><code>XmlWebApplicationContext</code>—Loads context definitions from one or more XML files contained in a web application</li>
</ul>
<h2 id="Bean的生命周期"><a href="#Bean的生命周期" class="headerlink" title="Bean的生命周期"></a>Bean的生命周期</h2><p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Spring_aop_example4.png" alt></p>
<ol>
<li>Spring instantiates the bean.</li>
<li>Spring injects values and bean references into the bean’s properties.</li>
<li>If the bean implements BeanNameAware, Spring passes the bean’s ID to the <code>setBeanName()</code> method.</li>
<li>If the bean implements BeanFactoryAware, Spring calls the <code>setBeanFactory()</code> method, passing in the bean factory itself.</li>
<li>If the bean implements ApplicationContextAware, Spring calls the <code>setApplicationContext()</code> method, passing in a reference to the enclosing application context.</li>
<li>If the bean implements the BeanPostProcessor interface, Spring calls its <code>postProcessBeforeInitialization()</code> method.</li>
<li>If the bean implements the InitializingBean interface, Spring calls its <code>afterPropertiesSet()</code> method. Similarly, if the bean was declared with an initmethod, then the specified initialization method is called.</li>
<li>If the bean implements BeanPostProcessor, Spring calls its <code>postProcessAfterInitialization()</code> method.</li>
<li>At this point, the bean is ready to be used by the application and remains in the application context until the application context is destroyed.</li>
<li>If the bean implements the DisposableBean interface, Spring calls its <code>destroy()</code> method. Likewise, if the bean was declared with a destroy method, the specified method is called.</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/05/26/Design Pattern_Proxy pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Plusaber">
      <meta itemprop="description" content="Plusaber's Blog">
      <meta itemprop="image" content="/images/plusaber.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Plusaber's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/05/26/Design Pattern_Proxy pattern/" class="post-title-link" itemprop="url">Proxy pattern</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-05-26 00:00:00" itemprop="dateCreated datePublished" datetime="2015-05-26T00:00:00+09:00">2015-05-26</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Design-Pattern/" itemprop="url" rel="index"><span itemprop="name">Design Pattern</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2015/05/26/Design Pattern_Proxy pattern/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/26/Design Pattern_Proxy pattern/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Proxy-pattern"><a href="#Proxy-pattern" class="headerlink" title="Proxy pattern"></a>Proxy pattern</h1><p>代理模式为另一个对象提供一个代理对象以控制对这个对象的访问，被代理的对象可以是远程对象、创建开销大的对象或者需要安全控制的对象。</p>
<h2 id="远程代理"><a href="#远程代理" class="headerlink" title="远程代理"></a>远程代理</h2><p>远程代理即是我们希望通过调用一个本地对象，然后其能将每个请求转发到远程对象上进行。换句话说，客户对象意味它调用的是远程服务上的方法，实际上是代理对象假装有客户要调用的方法，真正执行方法的在远程的对象。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_1.png" alt="Design_pattern_proxy_1"></p>
<p>通过Java RMI我们可以简单实现远程调用，而无需处理细节的网络通信。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_2.png" alt="Design_pattern_proxy_2"></p>
<p>使用Java RMI的具体步骤为：</p>
<ol>
<li>创建远程接口</li>
<li>实现远程接口的类Impl（main方法需要注册到RMI中）</li>
<li>使用Java rmic生成Impl的stud和skeleton，也就是客户和服务的辅助类。</li>
<li>在远程机器上启动RMI registry(倾听Impl的注册)</li>
<li>运行主方法(可以是启动类)将Impl注册到RMI服务上。</li>
<li>客户端调用Naming方法取得stub对象。</li>
<li>客户调用哦该stub方法，就像stub就是真正的服务对象一样。</li>
</ol>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_3.png" alt="Design_pattern_proxy_3"></p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_4.png" alt="Design_pattern_proxy_4"></p>
<p>服务端实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GumballMachineRemote</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="keyword">transient</span> GumballMachine gumballMachine;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You inserted a quarter"</span>);</span><br><span class="line">		gumballMachine.setState(gumballMachine.getHasQuarterState());</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You turned, but there's no quarter"</span>);</span><br><span class="line">	 &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You need to pay first"</span>);</span><br><span class="line">	&#125; </span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"waiting for quarter"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span></span></span><br><span class="line"><span class="class">		<span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">GumballMachineRemote</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	State soldOutState;</span><br><span class="line">	State noQuarterState;</span><br><span class="line">	State hasQuarterState;</span><br><span class="line">	State soldState;</span><br><span class="line">	State winnerState;</span><br><span class="line"> </span><br><span class="line">	State state = soldOutState;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"> 	String location;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(String location, <span class="keyword">int</span> numberGumballs)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">		soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</span><br><span class="line">		noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</span><br><span class="line">		hasQuarterState = <span class="keyword">new</span> HasQuarterState(<span class="keyword">this</span>);</span><br><span class="line">		soldState = <span class="keyword">new</span> SoldState(<span class="keyword">this</span>);</span><br><span class="line">		winnerState = <span class="keyword">new</span> WinnerState(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.count = numberGumballs;</span><br><span class="line"> 		<span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			state = noQuarterState;</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">this</span>.location = location;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.insertQuarter();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.ejectQuarter();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.turnCrank();</span><br><span class="line">		state.dispense();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</span><br><span class="line">			count = count - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.count = count;</span><br><span class="line">		state = noQuarterState;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> count;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> location;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldOutState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soldOutState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoQuarterState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> noQuarterState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasQuarterState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hasQuarterState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soldState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getWinnerState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> winnerState;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</span><br><span class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004"</span>);</span><br><span class="line">		result.append(<span class="string">"\nInventory: "</span> + count + <span class="string">" gumball"</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</span><br><span class="line">			result.append(<span class="string">"s"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		result.append(<span class="string">"\n"</span>);</span><br><span class="line">		result.append(<span class="string">"Machine is "</span> + state + <span class="string">"\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> result.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在RMI registry中注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		GumballMachineRemote gumballMachine = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			System.out.println(<span class="string">"GumballMachine &lt;name&gt; &lt;inventory&gt;"</span>);</span><br><span class="line"> 			System.exit(<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			count = Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">			gumballMachine = </span><br><span class="line">				<span class="keyword">new</span> GumballMachine(args[<span class="number">0</span>], count);</span><br><span class="line">			Naming.rebind(<span class="string">"//"</span> + args[<span class="number">0</span>] + <span class="string">"/gumballmachine"</span>, gumballMachine);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitor</span> </span>&#123;</span><br><span class="line">	GumballMachineRemote machine;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMonitor</span><span class="params">(GumballMachineRemote machine)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.machine = machine;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">report</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"Gumball Machine: "</span> + machine.getLocation());</span><br><span class="line">			System.out.println(<span class="string">"Current inventory: "</span> + machine.getCount() + <span class="string">" gumballs"</span>);</span><br><span class="line">			System.out.println(<span class="string">"Current state: "</span> + machine.getState());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitorTestDrive</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String[] location = &#123;<span class="string">"rmi://santafe.mightygumball.com/gumballmachine"</span>,</span><br><span class="line">		                     <span class="string">"rmi://boulder.mightygumball.com/gumballmachine"</span>,</span><br><span class="line">		                     <span class="string">"rmi://seattle.mightygumball.com/gumballmachine"</span>&#125;; </span><br><span class="line"> </span><br><span class="line">		GumballMonitor[] monitor = <span class="keyword">new</span> GumballMonitor[location.length];</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i &lt; location.length; i++) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">           		GumballMachineRemote machine = </span><br><span class="line">						(GumballMachineRemote) Naming.lookup(location[i]);</span><br><span class="line">           		monitor[i] = <span class="keyword">new</span> GumballMonitor(machine);</span><br><span class="line">				System.out.println(monitor[i]);</span><br><span class="line">        	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            	e.printStackTrace();</span><br><span class="line">        	&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; monitor.length; i++) &#123;</span><br><span class="line">			monitor[i].report();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="虚拟代理"><a href="#虚拟代理" class="headerlink" title="虚拟代理"></a>虚拟代理</h2><p>远程代理可以作为另一个JVM上对象的本地代表。调用代理的方法，会被代理利用网络转发到远程执行，并且结果会通过网络返回给代理，再有代理将结果转给客户。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_5.png" alt="Design_pattern_proxy_5"></p>
<p>而虚拟代理通常作为创建开销大的对象的代表。虚拟代理经常直到我们真正需要一个对象的时候才创建它。当对象在创建前和创建中时，由虚拟代理来扮演对象的替身。对象创建后，代理就会将请求委托给对象。</p>
<p>比如我们需要创建一个CD封面对象，这个封面图片需要从网上下载。在下外完成前，我们最好也显式一些内容，这时我们就可以使用虚拟代理。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_6.png" alt="Design_pattern_proxy_6"></p>
<ul>
<li>ImageProxy首先创建一个ImageIcon，然后开始从网络上加载图像。</li>
<li>在加载过程中，ImageProxy显式”加载中…”</li>
<li>当图像加载完毕，ImageProxy把所有方法掉用委托给真正的ImageIcon。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageProxy</span> <span class="keyword">implements</span> <span class="title">Icon</span> </span>&#123;</span><br><span class="line">	ImageIcon imageIcon;</span><br><span class="line">	URL imageURL;</span><br><span class="line">	Thread retrievalThread;</span><br><span class="line">	<span class="keyword">boolean</span> retrieving = <span class="keyword">false</span>;</span><br><span class="line">     </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ImageProxy</span><span class="params">(URL url)</span> </span>&#123; imageURL = url; &#125;</span><br><span class="line">     </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIconWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageIcon.getIconWidth();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">800</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIconHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageIcon.getIconHeight();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">600</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">     </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paintIcon</span><span class="params">(<span class="keyword">final</span> Component c, Graphics  g, <span class="keyword">int</span> x,  <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</span><br><span class="line">			imageIcon.paintIcon(c, g, x, y);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			g.drawString(<span class="string">"Loading CD cover, please wait..."</span>, x+<span class="number">300</span>, y+<span class="number">190</span>);</span><br><span class="line">			<span class="keyword">if</span> (!retrieving) &#123;</span><br><span class="line">				retrieving = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">				retrievalThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">					<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							imageIcon = <span class="keyword">new</span> ImageIcon(imageURL, <span class="string">"CD Cover"</span>);</span><br><span class="line">							c.repaint();</span><br><span class="line">						&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">				retrievalThread.start();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageComponent</span> <span class="keyword">extends</span> <span class="title">JComponent</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Icon icon;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ImageComponent</span><span class="params">(Icon icon)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.icon = icon;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIcon</span><span class="params">(Icon icon)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.icon = icon;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paintComponent</span><span class="params">(Graphics g)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.paintComponent(g);</span><br><span class="line">		<span class="keyword">int</span> w = icon.getIconWidth();</span><br><span class="line">		<span class="keyword">int</span> h = icon.getIconHeight();</span><br><span class="line">		<span class="keyword">int</span> x = (<span class="number">800</span> - w)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">int</span> y = (<span class="number">600</span> - h)/<span class="number">2</span>;</span><br><span class="line">		icon.paintIcon(<span class="keyword">this</span>, g, x, y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageProxyTestDrive</span> </span>&#123;</span><br><span class="line">	ImageComponent imageComponent;</span><br><span class="line">	JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"CD Cover Viewer"</span>);</span><br><span class="line">    JMenuBar menuBar;</span><br><span class="line">    JMenu menu;</span><br><span class="line">	Hashtable cds = <span class="keyword">new</span> Hashtable();</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ImageProxyTestDrive testDrive = <span class="keyword">new</span> ImageProxyTestDrive();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ImageProxyTestDrive</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		cds.put(<span class="string">"Ambient: Music for Airports"</span>,<span class="string">"http://images.amazon.com/images/P/B000003S2K.01.LZZZZZZZ.jpg"</span>);</span><br><span class="line">        cds.put(<span class="string">"Buddha Bar"</span>,<span class="string">"http://images.amazon.com/images/P/B00009XBYK.01.LZZZZZZZ.jpg"</span>);</span><br><span class="line">        cds.put(<span class="string">"Ima"</span>,<span class="string">"http://images.amazon.com/images/P/B000005IRM.01.LZZZZZZZ.jpg"</span>);</span><br><span class="line">        cds.put(<span class="string">"Karma"</span>,<span class="string">"http://images.amazon.com/images/P/B000005DCB.01.LZZZZZZZ.gif"</span>);</span><br><span class="line">        cds.put(<span class="string">"MCMXC A.D."</span>,<span class="string">"http://images.amazon.com/images/P/B000002URV.01.LZZZZZZZ.jpg"</span>);</span><br><span class="line">        cds.put(<span class="string">"Northern Exposure"</span>,<span class="string">"http://images.amazon.com/images/P/B000003SFN.01.LZZZZZZZ.jpg"</span>);</span><br><span class="line">        cds.put(<span class="string">"Selected Ambient Works, Vol. 2"</span>,<span class="string">"http://images.amazon.com/images/P/B000002MNZ.01.LZZZZZZZ.jpg"</span>);</span><br><span class="line"></span><br><span class="line">		URL initialURL = <span class="keyword">new</span> URL((String)cds.get(<span class="string">"Selected Ambient Works, Vol. 2"</span>));</span><br><span class="line">		menuBar = <span class="keyword">new</span> JMenuBar();</span><br><span class="line">		menu = <span class="keyword">new</span> JMenu(<span class="string">"Favorite CDs"</span>);</span><br><span class="line">        menuBar.add(menu);</span><br><span class="line">        frame.setJMenuBar(menuBar);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(Enumeration e = cds.keys(); e.hasMoreElements();) &#123;</span><br><span class="line">			String name = (String)e.nextElement();</span><br><span class="line">        	JMenuItem menuItem = <span class="keyword">new</span> JMenuItem(name);</span><br><span class="line">        	menu.add(menuItem); </span><br><span class="line">        	menuItem.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">          		  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>&#123;</span><br><span class="line">           		     imageComponent.setIcon(<span class="keyword">new</span> ImageProxy(getCDUrl(event.getActionCommand())));</span><br><span class="line">					frame.repaint();</span><br><span class="line">           	      &#125;</span><br><span class="line">        	&#125;);</span><br><span class="line">		&#125;</span><br><span class="line"> 		</span><br><span class="line">		<span class="comment">// set up frame and menus</span></span><br><span class="line"> </span><br><span class="line">		Icon icon = <span class="keyword">new</span> ImageProxy(initialURL);</span><br><span class="line">		imageComponent = <span class="keyword">new</span> ImageComponent(icon);</span><br><span class="line">		frame.getContentPane().add(imageComponent);</span><br><span class="line">		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">		frame.setSize(<span class="number">800</span>,<span class="number">600</span>);</span><br><span class="line">		frame.setVisible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">URL <span class="title">getCDUrl</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> URL((String)cds.get(name));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用Java-API代理实现保护代理"><a href="#使用Java-API代理实现保护代理" class="headerlink" title="使用Java API代理实现保护代理"></a>使用Java API代理实现保护代理</h2><p>Java在java.lang.reflect包中有自己的代理支持，利用哦该这个包我们可以在运行时动态的创建一个代理类，实现一个或多个接口，并将方法的调用转发到我们所指定的类。因为实际的代理是在运行时创建的，所以这个技术称为动态代理。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_proxy_7.png" alt="Design_pattern_proxy_7"></p>
<p>我们不需要自己创建Proxy类，也不能往里面添加代码。我们希望处理代码应该放在InvocationHandler中。InvocationHandler的工作是响应代理的任何调用，可以认为是代理收到方法调用后实际执行请求的对象。</p>
<p>假设我们正在实现一个信息管理服务，我们希望当前用户可以更改自己的基本信息，但不是不能更改自己的客观信息，同时其他用户也不能更改当前用户的基本信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">String <span class="title">getGender</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">String <span class="title">getInterests</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getHotOrNotRating</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setInterests</span><span class="params">(String interests)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setHotOrNotRating</span><span class="params">(<span class="keyword">int</span> rating)</span></span>; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonBeanImpl</span> <span class="keyword">implements</span> <span class="title">PersonBean</span> </span>&#123;</span><br><span class="line">	String name;</span><br><span class="line">	String gender;</span><br><span class="line">	String interests;</span><br><span class="line">	<span class="keyword">int</span> rating;</span><br><span class="line">	<span class="keyword">int</span> ratingCount = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;	</span><br><span class="line">	&#125; </span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getInterests</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> interests;</span><br><span class="line">	&#125;</span><br><span class="line">   </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHotOrNotRating</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (ratingCount == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> (rating/ratingCount);</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125; </span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInterests</span><span class="params">(String interests)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.interests = interests;</span><br><span class="line">	&#125; </span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHotOrNotRating</span><span class="params">(<span class="keyword">int</span> rating)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.rating += rating;	</span><br><span class="line">		ratingCount++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时我们可以为PersonBean创建动态代理，以过滤对这个类的请求：</p>
<ol>
<li>创建InvocationHandler(如果有多种模式，需要创建多个，这里我们分为两类，操作用户是用户本人或是其他人，所以需要两个InvocationHandler)。</li>
<li>写代码创建动态代理。</li>
<li>利用适当的代理保证PersonBean对象，并将这个代理提供给客户，而不是对象本身。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OwnerInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123; </span><br><span class="line">	PersonBean person;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OwnerInvocationHandler</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.person = person;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (method.getName().startsWith(<span class="string">"get"</span>)) &#123;</span><br><span class="line">				<span class="keyword">return</span> method.invoke(person, args);</span><br><span class="line">   			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().equals(<span class="string">"setHotOrNotRating"</span>)) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException();</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().startsWith(<span class="string">"set"</span>)) &#123;</span><br><span class="line">				<span class="keyword">return</span> method.invoke(person, args);</span><br><span class="line">			&#125; </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; </span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonOwnerInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123; </span><br><span class="line">	PersonBean person;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">NonOwnerInvocationHandler</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.person = person;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (method.getName().startsWith(<span class="string">"get"</span>)) &#123;</span><br><span class="line">				<span class="keyword">return</span> method.invoke(person, args);</span><br><span class="line">   			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().equals(<span class="string">"setHotOrNotRating"</span>)) &#123;</span><br><span class="line">				<span class="keyword">return</span> method.invoke(person, args);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().startsWith(<span class="string">"set"</span>)) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException();</span><br><span class="line">			&#125; </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; </span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchMakingTestDrive</span> </span>&#123;</span><br><span class="line">	Hashtable datingDB = <span class="keyword">new</span> Hashtable();</span><br><span class="line"> 	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		MatchMakingTestDrive test = <span class="keyword">new</span> MatchMakingTestDrive();</span><br><span class="line">		test.drive();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MatchMakingTestDrive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		initializeDatabase();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		PersonBean joe = getPersonFromDatabase(<span class="string">"Joe Javabean"</span>); </span><br><span class="line">		PersonBean ownerProxy = getOwnerProxy(joe);</span><br><span class="line">		System.out.println(<span class="string">"Name is "</span> + ownerProxy.getName());</span><br><span class="line">		ownerProxy.setInterests(<span class="string">"bowling, Go"</span>);</span><br><span class="line">		System.out.println(<span class="string">"Interests set from owner proxy"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ownerProxy.setHotOrNotRating(<span class="number">10</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Can't set rating from owner proxy"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"Rating is "</span> + ownerProxy.getHotOrNotRating());</span><br><span class="line"></span><br><span class="line">		PersonBean nonOwnerProxy = getNonOwnerProxy(joe);</span><br><span class="line">		System.out.println(<span class="string">"Name is "</span> + nonOwnerProxy.getName());</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			nonOwnerProxy.setInterests(<span class="string">"bowling, Go"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Can't set interests from non owner proxy"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		nonOwnerProxy.setHotOrNotRating(<span class="number">3</span>);</span><br><span class="line">		System.out.println(<span class="string">"Rating set from non owner proxy"</span>);</span><br><span class="line">		System.out.println(<span class="string">"Rating is "</span> + nonOwnerProxy.getHotOrNotRating());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">PersonBean <span class="title">getOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line"> 		</span><br><span class="line">        <span class="keyword">return</span> (PersonBean) Proxy.newProxyInstance( </span><br><span class="line">            	person.getClass().getClassLoader(),</span><br><span class="line">            	person.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> OwnerInvocationHandler(person));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获得这个对象的代理对象</span></span><br><span class="line">	<span class="function">PersonBean <span class="title">getNonOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">return</span> (PersonBean) Proxy.newProxyInstance(</span><br><span class="line">            	person.getClass().getClassLoader(),</span><br><span class="line">            	person.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> NonOwnerInvocationHandler(person));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">PersonBean <span class="title">getPersonFromDatabase</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (PersonBean)datingDB.get(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initializeDatabase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		PersonBean joe = <span class="keyword">new</span> PersonBeanImpl();</span><br><span class="line">		joe.setName(<span class="string">"Joe Javabean"</span>);</span><br><span class="line">		joe.setInterests(<span class="string">"cars, computers, music"</span>);</span><br><span class="line">		joe.setHotOrNotRating(<span class="number">7</span>);</span><br><span class="line">		datingDB.put(joe.getName(), joe);</span><br><span class="line"></span><br><span class="line">		PersonBean kelly = <span class="keyword">new</span> PersonBeanImpl();</span><br><span class="line">		kelly.setName(<span class="string">"Kelly Klosure"</span>);</span><br><span class="line">		kelly.setInterests(<span class="string">"ebay, movies, music"</span>);</span><br><span class="line">		kelly.setHotOrNotRating(<span class="number">6</span>);</span><br><span class="line">		datingDB.put(kelly.getName(), kelly);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/05/17/WebService_Big Web Services/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Plusaber">
      <meta itemprop="description" content="Plusaber's Blog">
      <meta itemprop="image" content="/images/plusaber.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Plusaber's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/05/17/WebService_Big Web Services/" class="post-title-link" itemprop="url">Big Web Services with Java</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-05-17 00:00:00" itemprop="dateCreated datePublished" datetime="2015-05-17T00:00:00+09:00">2015-05-17</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/WebService/" itemprop="url" rel="index"><span itemprop="name">WebService</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2015/05/17/WebService_Big Web Services/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/17/WebService_Big Web Services/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Web services就是客户端通过HTTP协议向server发送请求，并获得所需要的信息或服务。Web services可以看做一种处于不同机器不同平台上的软件进行交互的一种标准方式。</p>
<p>目前主要有两种类型的Web services：<br>一种是所谓的big web services，因为其相对于第二种方式比较重量级。big web services使用XML封装请求信息以及回答，按照Simple Object Asscess Protocol，所以也称为SOAP消息，提供方法信息和作用域信息，另外使用的一项技术是WSDL(web service description language)，web服务描述语言，是一套用于描述SOAP WEB服务的XML词汇。客户端可以通过参考WSDL文档，可以确切的知道可以调用哪些RPC式方法，需要哪些参数，以及返回值数据类型。SOAP的服务都发布有WSDL文档，否则很难使用。对于很多程序语言，WSDL也是用来自动生成客户端stub必须的文档。</p>
<p>另一种是RESTful webservice，具体两种实现的区别请参考Web Service的<a href>Programmable Web及其分类</a>。这里主要介绍基于java实现big web service.</p>
<h2 id="Big-web-service的基本技术"><a href="#Big-web-service的基本技术" class="headerlink" title="Big web service的基本技术"></a>Big web service的基本技术</h2><h3 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h3><p>SOAP是Web Service的基本通信协议，是一种规范，用来定义SOAP消息的XML格式（XMLFormat）。包含在一对 SOAP 元素（SOAPElements）中的、结构正确的 XML 段就是 SOAP 消息。<br>SOAP 规范还介绍了如何将程序数据表示为 XML，以及如何使用 SOAP 进行远程过程调用 （RPC）。<br>最后SOAP规范还定义了HTTP消息是怎样传输SOAP消息的。这并不代表SOAP只能用HTTP来作为传输协议，MSMQ、SMTP、TCP/IP都可以做SOAP的传输协议。</p>
<h3 id="WSDL"><a href="#WSDL" class="headerlink" title="WSDL"></a>WSDL</h3><p>Web Services Description Language的缩写，是一个用来描述Web服务和说明如何与Web服务通信的XML语言。WSDL是Web Service的描述语言，用于描述Web Service的服务，接口绑定等，为用户提供详细的接口说明书。<br>举个例子，你要使用供应商的WebService构建应用程序。你可以向供应商索取使用Web Service的范例，然后按照范例来构建应用程序。这样可能出现意料不到的错误，比如说，你在程序中使用的客户代码的数据类型是integer，而供应商使用的数据类型是string。WSDL详细定义客户端消息的格式，需要什么样的参数，这样可以避免不必要的错误。<br>要查看 WSDL 的值，可以假设您要调用由您的一位业务伙伴提供的 SOAP 方法。您可以要求对方提供一些 SOAP 消息示例，然后编写您的应用程序以生成并使用与示例类似的消息。WSDL 通过明确的表示法指定请求消息必须包含的内容以及响应消息的样式。<br>WSDL 文件用于说明消息格式的表示法以 XML 架构标准为基础，这意味着它与编程语言无关，而且以标准为基础，因此适用于说明可从不同平台、以不同编程语言访问的 XML Web Service 接口。除说明消息内容外，WSDL 还定义了服务的位置，以及使用什么通信协议与服务进行通信。WSDL 文件定义了编写使用 XML Web Service 的程序所需的全部内容。</p>
<p>Google搜索服务的WSDL文档片断：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doGoogleSearch"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">message</span>=<span class="string">"typens:doGoogleSearch"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">output</span> <span class="attr">message</span>=<span class="string">"typens:doGoogleSearchRespnse"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">operation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一个SOAP RPC调用的HTTP请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST search/beta2 HTTP/1.1</span><br><span class="line">Host:...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0"...&gt;</span></span><br><span class="line"><span class="meta">&lt;soap:Envelop xmln:soap="UTF-8"&gt;</span></span><br><span class="line"><span class="meta">	&lt;soap:body&gt;</span></span><br><span class="line"><span class="meta">		&lt;gs:doGoogleSearch&gt;</span></span><br><span class="line"><span class="meta">			&lt;q&gt;plusaber&lt;/q&gt;</span></span><br><span class="line"><span class="meta">		&lt;/gs:doGoogleSearch&gt;</span></span><br><span class="line"><span class="meta">	&lt;/soap:Body&gt;</span></span><br><span class="line"><span class="meta">&lt;/soap:Envelope&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="UDDI"><a href="#UDDI" class="headerlink" title="UDDI"></a>UDDI</h3><p>UniversalDescription Discovery and Integration即统一描述、发现和集成协议。UDDI实现了一组可公开访问的接口，通过这些接口，网络服务可以向服务信息库注册其服务信息、服务需求者可以找到分散在世界各地的网络服务。<br>UDDI 目录条目是介绍所提供的业务和服务的 XML 文件。可以把它比喻成电话本，电话本里记录的是电话信息，而UDDI记录的是Web Service信息。你可以不把Web Service注册到UDDI。但如果要让全球的人知道你的Web Service，最好还是注册到UDDI。<br>UDDI 目录还包含若干种方法，可用于搜索构建您的应用程序所需的服务。例如，您可以搜索特定地理位置的服务提供商或者搜索特定的业务类型。之后，UDDI 目录将提供信息、联系方式、链接和技术数据，以便您确定能满足需要的服务。<br>UDDI 允许您查找提供所需的Web 服务的公司。如果您已经知道要与谁进行业务合作，但尚不了解它还能提供哪些服务，这时该如何处理呢？WS-Inspection规范允许您浏览特定服务器上提供的 XML Web Service 的集合，从中查找所需的服务。</p>
<h2 id="Big-Web-Service的Java实现"><a href="#Big-Web-Service的Java实现" class="headerlink" title="Big Web Service的Java实现"></a>Big Web Service的Java实现</h2><p>Web Service本质是一种标准，具体每种语言都提供了不同的实现。在Java领域，Big Web Service的标准是JAX-WS，实现框架有：<a href="http://cxf.apache.org/docs/a-simple-jax-ws-service.html" target="_blank" rel="noopener">CXF</a>, axis2, Java 6开始自带的Web Service引擎(自带的<a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnayl.html" target="_blank" rel="noopener">JAX-WS implementation</a>)。</p>
<h3 id="JAX-WS的不同实现框架"><a href="#JAX-WS的不同实现框架" class="headerlink" title="JAX-WS的不同实现框架"></a>JAX-WS的不同实现框架</h3><p>这里先说明一下为什么存在这些不同的实现框架，特别是Java 6开始自带的Web Service引擎与其他更复杂的框架，参考<a href="http://stackoverflow.com/questions/11566609/difference-between-jax-ws-axis2-cxf" target="_blank" rel="noopener">Difference between Jax-ws, axis2, cxf</a>：<br>The JAX-WS implementation built into the JDK really is just the basic soap stuff. If you need any of the more complex WS-* things like WS-Security, WS-RM, WS-Policy, etc…, you need to use one of the alternatives like CXF or Metro or Axis2. It can also depend on what you are trying to integrate with. For example, CXF has top notch Spring support as well as very good OSGi support.</p>
<p>CXF also has other things besides just JAX-WS. It has a compliant JAX-RS implementation as well and supports exposing services as both REST and SOAP very well. Has a W3C compliant SOAP/JMS implementation if that type of things is required. Basically, lots of stuff not available from the in-jdk JAX-WS impl.</p>
<p>Also see:<br><a href="http://stackoverflow.com/questions/1243247/difference-between-apache-cxf-and-axis/1245386#1245386" target="_blank" rel="noopener">Difference between Apache CXF and Axis</a></p>
<p>也就是Java自带的Web Service引擎提供了SOAP通信的服务，但是不支持更高级的需求，比如Web Service安全性，与Spring结合等。</p>
<h3 id="创建和使用Web-Service基本步骤"><a href="#创建和使用Web-Service基本步骤" class="headerlink" title="创建和使用Web Service基本步骤"></a>创建和使用Web Service基本步骤</h3><ol>
<li>编写服务的接口</li>
<li>编写服务接口的实现类</li>
<li>发布</li>
<li>测试或使用</li>
</ol>
<h3 id="使用JAX-WS-Java自带-实现第一个Web-Service"><a href="#使用JAX-WS-Java自带-实现第一个Web-Service" class="headerlink" title="使用JAX-WS(Java自带)实现第一个Web Service"></a>使用JAX-WS(Java自带)实现第一个Web Service</h3><p>项目结构如下：</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/WebService_1.png" alt="WebService_1"></p>
<ul>
<li><strong>编写服务接口HelloWorld</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jws;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jws.WebParam;</span><br><span class="line"><span class="keyword">import</span> javax.jws.WebService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebService</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloWorld</span> </span>&#123;  </span><br><span class="line">     </span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(@WebParam(name=<span class="string">"who"</span>)</span> String who)</span>;  </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意<code>@WebService</code>是必须要有的，用于指定这是一个Web Service服务类。</p>
<p>另外要暴露给客户端的方法需要注明为@WebMethod。<code>@WebMethod</code>是用来标注在WebService的方法即操作上的，通过它我们可以指定某一个操作的操作名、使用SOAP绑定时的Action名称，以及该方法是否允许发布为WebService。<code>@WebMethod</code>有三个属性：operationName、action和exclude。如果接口中方法不希望作为WebService访问的时候就可以通过<code>@WebMethod</code>来指定将其排除在外(<code>@WebMethod(exclude=true)</code>)。</p>
<p><code>@Oneway</code>是标注在Service接口的操作方法上的。使用<code>@Oneway</code>标注的方法表示它不需要等待服务端的返回，也不需要预留资源来处理服务端的返回。</p>
<p>因为接口在被编译为class文件的时候不能保存参数名，有时候这会影响可读性。如果需要参数名显示的可读性强一些的话，我们可以使用<code>@WebParam</code>来指定。</p>
<ul>
<li><strong>编写服务接口HelloWorld实现类</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jws;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jws.WebMethod;</span><br><span class="line"><span class="keyword">import</span> javax.jws.WebService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// endpointInterface用于指定实现的接口</span></span><br><span class="line"><span class="comment">// 同时也设定了服务的targetName和name，后面client定位这个服务时需要用到</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebService</span>(endpointInterface = <span class="string">"jws.HelloWorld"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldImpl</span> <span class="keyword">implements</span> <span class="title">HelloWorld</span> </span>&#123; </span><br><span class="line">	     </span><br><span class="line">	   <span class="meta">@Override</span>  </span><br><span class="line">	   <span class="meta">@WebMethod</span>(exclude=<span class="keyword">true</span>)  </span><br><span class="line">	   <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String who)</span> </span>&#123;  </span><br><span class="line">	      <span class="keyword">return</span><span class="string">"Hello, "</span> + who;  </span><br><span class="line">	   &#125;  </span><br><span class="line">	   </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/13417454/javax-xml-ws-webserviceexception-undefined-port-type-java-struts-soap-wsdl" target="_blank" rel="noopener">javax.xml.ws.WebServiceException: Undefined port type Java Struts SOAP WSDL</a></p>
<ul>
<li><strong>发布服务</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jws;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.ws.Endpoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deployService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Server start ……"</span>);</span><br><span class="line">        HelloWorld service = <span class="keyword">new</span> HelloWorldImpl();</span><br><span class="line">        String address = <span class="string">"http://localhost:9999/ws/hello"</span>;</span><br><span class="line">        Endpoint.publish(address, service);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        deployService();</span><br><span class="line">        System.out.println(<span class="string">"server ready ……"</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">60</span>);</span><br><span class="line">        System.out.println(<span class="string">"server exiting"</span>);</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>(可跳过)验证服务</strong></li>
</ul>
<p>打开浏览器，输入<code>http://localhost:9999/ws/hello?wsdl</code>，可以验证服务的WSDL文件(mac的safari不显示，可以用Chrome验证)。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> Published by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e. </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> Generated by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e. </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns:wsu</span>=<span class="string">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span> <span class="attr">xmlns:wsp</span>=<span class="string">"http://www.w3.org/ns/ws-policy"</span> <span class="attr">xmlns:wsp1_2</span>=<span class="string">"http://schemas.xmlsoap.org/ws/2004/09/policy"</span> <span class="attr">xmlns:wsam</span>=<span class="string">"http://www.w3.org/2007/05/addressing/metadata"</span> <span class="attr">xmlns:soap</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/soap/"</span> <span class="attr">xmlns:tns</span>=<span class="string">"http://jws/"</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span> <span class="attr">xmlns</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/"</span> <span class="attr">targetNamespace</span>=<span class="string">"http://jws/"</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplService"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">types</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">"http://jws/"</span> <span class="attr">schemaLocation</span>=<span class="string">"http://localhost:9999/ws/hello?xsd=1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">types</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHello"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHello"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHelloResponse"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHelloResponse"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">portType</span> <span class="attr">name</span>=<span class="string">"HelloWorld"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHello"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://jws/HelloWorld/sayHelloRequest"</span> <span class="attr">message</span>=<span class="string">"tns:sayHello"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://jws/HelloWorld/sayHelloResponse"</span> <span class="attr">message</span>=<span class="string">"tns:sayHelloResponse"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">operation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">portType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplPortBinding"</span> <span class="attr">type</span>=<span class="string">"tns:HelloWorld"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">soap:binding</span> <span class="attr">transport</span>=<span class="string">"http://schemas.xmlsoap.org/soap/http"</span> <span class="attr">style</span>=<span class="string">"document"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHello"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">output</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">output</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">operation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">binding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplService"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplPort"</span> <span class="attr">binding</span>=<span class="string">"tns:HelloWorldImplPortBinding"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">soap:address</span> <span class="attr">location</span>=<span class="string">"http://localhost:9999/ws/hello"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>编写客户端，调用服务</strong></li>
</ul>
<p>需要利用工具类生成并导入服务的接口类<code>HelloWorld</code>。</p>
<p>method 1: 使用Eclipse工具生成<br>method 2: 通过cxf的命令生成客户端代码。<br>进入apache-cxf-2.3.1\bin所在目录，输入命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsdl2java -p com.jaxb.client -d . http://localhost:9999/ws/hello?wsdl</span><br></pre></td></tr></table></figure>
<p>命令格式为：<code>wsdl2java –p 包名 –d 生成代码存放目录 wsdl的url</code></p>
<p>wsdl2java用法：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>param</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>-p</td>
<td>指定其wsdl的命名空间，也就是要生成代码的包名；</td>
</tr>
<tr>
<td>-d</td>
<td>指定要产生代码所在目录；</td>
</tr>
<tr>
<td>-client</td>
<td>生成客户端测试web service的代码；</td>
</tr>
<tr>
<td>-server</td>
<td>生成服务器启动web service的代码；</td>
</tr>
<tr>
<td>-impl</td>
<td>生成web service的实现代码；</td>
</tr>
<tr>
<td>-ant</td>
<td>生成build.xml文件；</td>
</tr>
<tr>
<td>-all</td>
<td>生成所有开始端点代码：types,serviceproxy, service interface, server mainline, client mainline, implementation object,and an Ant build.xml file。</td>
</tr>
</tbody>
</table>
</div>
<p>另外还需要知道服务wsdl文件中的targetNamespace和name用于定位服务。</p>
<p><code>targetNamespace=&quot;http://jws/&quot; 
name=&quot;HelloWorldImplService</code></p>
<p>将生成代码拷贝到client代码目录下或导入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.namespace.QName;</span><br><span class="line"><span class="keyword">import</span> javax.xml.ws.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jws.HelloWorld;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		URL url = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            url = <span class="keyword">new</span> URL(<span class="string">"http://localhost:9999/ws/hello?wsdl"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            java.util.logging.Logger.getLogger(HelloWorld.class.getName())</span><br><span class="line">                .log(java.util.logging.Level.INFO, </span><br><span class="line">                     <span class="string">"Can not initialize the default wsdl from &#123;0&#125;"</span>, <span class="string">"http://localhost:9000/helloWorld?wsdl"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        QName qname = <span class="keyword">new</span> QName(<span class="string">"http://jws/"</span>, <span class="string">"HelloWorldImplService"</span>);</span><br><span class="line">        </span><br><span class="line">        Service service = Service.create(url, qname);</span><br><span class="line">        </span><br><span class="line">        HelloWorld hw = service.getPort(HelloWorld.class);</span><br><span class="line">        System.out.println(hw.sayHello(<span class="string">"World"</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, World</span><br></pre></td></tr></table></figure>
<p>上面是基本的基于Java 6开始自带的Web Service引擎的helloworld实现，没有使用任何其他包，例如CFX。</p>
<h2 id="HelloWrold基于CXF的实现"><a href="#HelloWrold基于CXF的实现" class="headerlink" title="HelloWrold基于CXF的实现"></a>HelloWrold基于CXF的实现</h2><p>基本流程和上面一致。</p>
<p>使用CXF的JaxWsServerFactoryBean类进行发布。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HelloServiceImpl impl = <span class="keyword">new</span> HelloServiceImpl();</span><br><span class="line">JaxWsServerFactoryBean factoryBean = newJaxWsServerFactoryBean();</span><br><span class="line">factoryBean.setAddress(<span class="string">"http://localhost:8080/WSCXF/helloService"</span>);</span><br><span class="line">factoryBean.setServiceClass(IHelloService.class);<span class="comment">//接口类</span></span><br><span class="line">factoryBean.setServiceBean(impl);</span><br><span class="line">factoryBean.create();</span><br><span class="line">System.out.println(<span class="string">"WS发布成功！"</span>);</span><br></pre></td></tr></table></figure>
<p>这两种方法都是将服务发布到Jetty下。另外还可以利用cxf和spring整合在tomcat下进行发布。</p>
<p>客户端使用cxf的调用服务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JaxWsProxyFactoryBean soapFactoryBean = newJaxWsProxyFactoryBean();</span><br><span class="line">soapFactoryBean.setAddress(<span class="string">"http://localhost:8080/WSCXF/helloService"</span>);</span><br><span class="line">soapFactoryBean.setServiceClass(IHelloService.class);</span><br><span class="line">Object o = soapFactoryBean.create();</span><br><span class="line">IHelloService helloService = (IHelloService)o;</span><br></pre></td></tr></table></figure>
<p>可以看出Big web service的生成发布以及调用过程都是基本一致的，只是在各个步骤可以使用不同的框架和实现，不同框架提供了不同程度的安全性，整合等支持。</p>
<h2 id="CXF和Spring整合"><a href="#CXF和Spring整合" class="headerlink" title="CXF和Spring整合"></a>CXF和Spring整合</h2><p>参考<a href="http://www.mkyong.com/webservices/jax-ws/jax-ws-hello-world-example-document-style/" target="_blank" rel="noopener">JAX-WS Hello World Example – Document Style</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/05/16/WebService_Programmable Web及其分类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Plusaber">
      <meta itemprop="description" content="Plusaber's Blog">
      <meta itemprop="image" content="/images/plusaber.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Plusaber's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/05/16/WebService_Programmable Web及其分类/" class="post-title-link" itemprop="url">REST_Programmable Web及其分类</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-05-16 00:00:00" itemprop="dateCreated datePublished" datetime="2015-05-16T00:00:00+09:00">2015-05-16</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/WebService/" itemprop="url" rel="index"><span itemprop="name">WebService</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2015/05/16/WebService_Programmable Web及其分类/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/16/WebService_Programmable Web及其分类/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Programmable-Web及其分类"><a href="#Programmable-Web及其分类" class="headerlink" title="Programmable Web及其分类"></a>Programmable Web及其分类</h1><p>在编写计算机程序时，我们经常需要使用第三方库中的算法。但是有时我们需要获得由数据驱动的而且数据无法容易获得的服务，这时我们需要依赖于programmable web。这里programmable web是跟human web相对的。human web指的是传统的面向人类使用的web，如人们浏览的网站返回HTML文档显式供人类查看，而programmable web指的是面向计算机程序使用的web，比如web服务等，一般返回更加规则的结果，如XML文档，JSON文档等作为程序的输入。本质上programmable web在工作方式上跟human web是一致的，都是发送请求后，获得所需要的输出或操作。</p>
<p>programmable web是基于HTTP和XML技术的，虽然HTML,JSON等也在使用，但是使用较多的还是XML。</p>
<p>programmable web分类主要是指可以根据调用web服务的方式和形式不同的技术进行分类，如基于RPC(SOAP+WSDL), REST, REST-RPC混合等方式。到这里还是非常的抽象，要对programmable web进行分类，首先来回顾一下programmable web的一些技术。</p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>HTTP是一种基于文档的协议。客户端把文档放在信封里，然后发送给服务器。接收到请求后，服务器解析请求并作为回应，把相应文档放在信封里，然后发送给客户端。HTTP对信封格式有严格标准，但是并不关心信封里面的内容，一般是有客户端或服务端解析。</p>
<p>一个HTTP GET请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1</span><br><span class="line">Host: www.plusaber.net</span><br><span class="line">User-Ageent: Mozilla/5.0....</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>HTTP请求主要有下面几个组成部分：</p>
<p><strong>HTTP方法</strong>：表示客户端希望服务器如何处理该信封。<br><strong>路径</strong>：这里是URI里主机名(hostname)后面的部分。<br><strong>请求报头</strong>：一组key-value pairs，作为元数据。<br><strong>实体主体，也就是文档</strong>，这里GET请求是没有主体的，POST请求会将请求参数放在这里，而GET请求会请求参数以键值对形式直接放在URI中。</p>
<p>HTTP相应也是一个放在信封里的文档，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Fri....</span><br><span class="line">Server: Aparche...</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html...&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">...</span><br><span class="line">&lt;title&gt;Hello, world&lt;/title&gt;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>HTTP响应可分为三个部分：</p>
<p><strong>HTTP响应代码</strong><br><strong>响应报头</strong><br><strong>实体主体</strong></p>
<h2 id="方法信息"><a href="#方法信息" class="headerlink" title="方法信息"></a>方法信息</h2><p>HTTP是Programmable Web上所有服务所共有的。而Web服务之间的差别的形成，是由于在两个问题上的做法有所不同。只要了解一个Web服务器是如何处理这两个问题的，就可以清楚地直到该服务是否跟Web的理念保持一致。</p>
<p><strong>第一个问题是：客户端如何把自己的意图传达给服务器，也就是客户希望进行什么操作，如获取数据、删除数据还是改写数据。</strong>这种关于对数据采取什么操作的信息，称为方法信息(method information)。</p>
<p>RESTful Web Services的方式是把它放在HTTP方法中(HTTP method)，包括主要的GET, HEAD, PUT, DELETE和POST。通过这些方法足以分辨操作类型，标准化的名称是一个很好的优点。</p>
<p>RPC方式是通过提供另外的方法描述提供method information，如在URI中的参数(RPC-REST混合模式)，在SOAP信封中调用WSDS中定义的方法(SOAP-RPC)。而不关注请求时的HTTP method，RPC-REST混合模式中可能总是使用GET，尽管实际的操作可能是DELETE，SOAP-RPC可能总是使用POST(需要包含SOAP信息进行服务调用)，尽管实际的操作可能是PUT。</p>
<p>Google搜索服务的WSDL文档片断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;operation name=&quot;doGoogleSearch&quot;&gt;</span><br><span class="line">	&lt;input message=&quot;typens:doGoogleSearch&quot;&gt;</span><br><span class="line">	&lt;output message=&quot;typens:doGoogleSearchRespnse&quot;&gt;</span><br><span class="line">&lt;/operation&gt;</span><br></pre></td></tr></table></figure>
<p>一个SOAP RPC调用的HTTP请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST search/beta2 HTTP/1.1</span><br><span class="line">Host:...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot;...&gt;</span><br><span class="line">&lt;soap:Envelop xmln:soap=&quot;UTF-8&quot;&gt;</span><br><span class="line">	&lt;soap:body&gt;</span><br><span class="line">		&lt;gs:doGoogleSearch&gt;</span><br><span class="line">			&lt;q&gt;plusaber&lt;/q&gt;</span><br><span class="line">		&lt;/gs:doGoogleSearch&gt;</span><br><span class="line">	&lt;/soap:Body&gt;</span><br><span class="line">&lt;/soap:Envelope&gt;</span><br></pre></td></tr></table></figure>
<p><strong>第二个问题是：客户端如何告诉服务器对哪些数据进行操作。</strong>也就是作用域信息(scoping information)。</p>
<h2 id="作用域信息"><a href="#作用域信息" class="headerlink" title="作用域信息"></a>作用域信息</h2><p>很多Web服务器都把作用域信息放在URI路径里。<br>另一种选择是把作用域信息放在实体主体里，SOAP Web服务通常采用这种方式。</p>
<p>采用了什么样的服务设计，决定了哪些信息属于方法信息，哪些信息属于作用域信息，即使功能相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请求(GET)  http://flickr.com/photos/tags/penguin</span><br><span class="line">请求(GET)  http://api.flickr.com/services/rest/?method=flickr.photos.search&amp;tags=penguin</span><br></pre></td></tr></table></figure>
<p>两者实现的功能相同，请求也都是GET，但是后者在uri参数中制定了调用的方法名flickr.photos.search，令HTTP的GET方法失去了原本用意，也就是实际上的操作并不不受GET或POST影响。前一个例子中Google SOAP API中也是如此，在SOAP信封中制定了调用的方法甚至参数。</p>
<h2 id="相互竞争的服务架构"><a href="#相互竞争的服务架构" class="headerlink" title="相互竞争的服务架构"></a>相互竞争的服务架构</h2><p>不同Web服务会有不同做法，目前主要有三种常见的Web服务架构：REST式架构、RPC式架构和REST-RPC混合架构。</p>
<p>RPC式架构通过一个复杂的、编程语言式的接口，来暴露其内部算法。而ROA则通过一个简单的、文档处理接口，来暴露其内部数据。</p>
<h3 id="REST式、面向资源的机构-Resource-Oriented-Architectures"><a href="#REST式、面向资源的机构-Resource-Oriented-Architectures" class="headerlink" title="REST式、面向资源的机构(Resource-Oriented Architectures)"></a>REST式、面向资源的机构(Resource-Oriented Architectures)</h3><p>REST式架构意味着，方法信息都在HTTP方法里；面向资源的架构(ROA)意味着，作用域信息都在URI里，二者结合起来可以非常强大。一个面向资源的REST式Web服务，通过HTTP请求第一行就能基本了解客户端需要做什么了。如果HTTP方法跟方法信息对不上，那么服务就不算事RESTful的；如果作用域信息不放在URI里，那么服务就不是面向资源的。</p>
<h3 id="RPC式架构-RPC-Style-Architectures"><a href="#RPC式架构-RPC-Style-Architectures" class="headerlink" title="RPC式架构(RPC-Style Architectures)"></a>RPC式架构(RPC-Style Architectures)</h3><p>RPC式Web服务通常从客户端收到一个包括方法信息和作用域信息的信封，然后发回回复信封。一种常用的信封格式是SOAP，进一步封装杂HTTP信封中。SOAP信封内容随着调用方法和参数不同有所变化，但是HTTP信封格式总是不变的，同样的uri，同样的HTTP method(一般总是POST)。SOAP-RPC服务为采用HTTP的很多特性，只暴露一个URI，并且只支持一种HTTP方法(POST方法)。而REST服务为不同的作用域信息暴露不同的URI。</p>
<p>除了SOAP RPC，更宽泛的是XML-RPC，SOAP其实就是基于XML，不过多了一系列规范和相应的技术栈，包括WSDL,UDDI.</p>
<h3 id="REST-RPC混合架构"><a href="#REST-RPC混合架构" class="headerlink" title="REST-RPC混合架构"></a>REST-RPC混合架构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://api.flickr.com/services/rest/?method=flickr.photos.search&amp;tags=penguin</span><br></pre></td></tr></table></figure>
<p>这里的服务调用将作用域信息放在URI中，有些类似于REST，但是不同的是其将方法信息也放在URI中了，所以本质上是一个RPC式服务，只是将URI当做信封格式来用。</p>
<p>许多只读的Web服务，尽管起初是按照RPC风格设计的，但都可以被认为是完全REST式和面向资源的。但是如果服务允许DELETE等操作的话，就会出现客户端所使用的HTTP方法与正在想执行的操作不一致的情况，就失去了REST的特征，所以称为REST-RPC混合服务。</p>
<h2 id="Programmable-Web涉及的技术"><a href="#Programmable-Web涉及的技术" class="headerlink" title="Programmable Web涉及的技术"></a>Programmable Web涉及的技术</h2><h3 id="HTTP-1"><a href="#HTTP-1" class="headerlink" title="HTTP"></a>HTTP</h3><p>所有Web服务都用HTTP，只是使用方式有所不同。</p>
<h3 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h3><p>同样的，所有Web服务都用HTTP，但使用方式有所不同。一个REST服务为客户端可能操作的每一个数据暴露一个URI；一个REST-RPC混合服务为客户端可行进行的每个操作暴露一个URI；一个RPC服务为每个远程处理暴露一个相同的URI，即服务的端点(endpoint)。</p>
<h3 id="XML-RPC"><a href="#XML-RPC" class="headerlink" title="XML-RPC"></a>XML-RPC</h3><p>用XML表达函数调用及其返回值，专门用于RPC式Web服务，现在已经逐渐被更完善的SOAP技术栈所替代。</p>
<h3 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h3><p>基于XML的信封格式，同样是为RPC提供方法信息和作用域信息。</p>
<h3 id="WSDL"><a href="#WSDL" class="headerlink" title="WSDL"></a>WSDL</h3><p>WSDL(web service description language)，web服务描述语言，是一套用于描述SOAP WEB服务的XML词汇。客户端可以通过参考WSDL文档，可以确切的知道可以调用哪些RPC式方法，需要哪些参数，以及返回值数据类型。SOAP的服务都发布有WSDL文档，否则很难使用。</p>
<h3 id="WADL"><a href="#WADL" class="headerlink" title="WADL"></a>WADL</h3><p>WADL(web applicaiotn description language), web应用描述语言，是一套用于描述REST式服务的XML词汇。提供的功能与WSDL类似，但是由于REST式服务接口比较简单，其必要性没有像WSDL至于SOAP-RPC那么大。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/05/01/Design Pattern_State pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Plusaber">
      <meta itemprop="description" content="Plusaber's Blog">
      <meta itemprop="image" content="/images/plusaber.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Plusaber's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2015/05/01/Design Pattern_State pattern/" class="post-title-link" itemprop="url">State pattern</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-05-01 00:00:00" itemprop="dateCreated datePublished" datetime="2015-05-01T00:00:00+09:00">2015-05-01</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Design-Pattern/" itemprop="url" rel="index"><span itemprop="name">Design Pattern</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2015/05/01/Design Pattern_State pattern/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/01/Design Pattern_State pattern/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="State-pattern"><a href="#State-pattern" class="headerlink" title="State pattern"></a>State pattern</h1><h2 id="问题定义"><a href="#问题定义" class="headerlink" title="问题定义"></a>问题定义</h2><p>假设我们需要制造一台糖果机，其操作如下:</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_state_1.png" alt="Design_pattern_state_1"></p>
<p>我们可以分清楚各个状态以及状态的转换，当做一个简单的状态机来实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD_OUT = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NO_QUARTER = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> HAS_QUARTER = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD = <span class="number">3</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">int</span> state = SOLD_OUT;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.count = count;</span><br><span class="line">		<span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			state = NO_QUARTER;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (state == HAS_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You can't insert another quarter"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</span><br><span class="line">			state = HAS_QUARTER;</span><br><span class="line">			System.out.println(<span class="string">"You inserted a quarter"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You can't insert a quarter, the machine is sold out"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</span><br><span class="line">        	System.out.println(<span class="string">"Please wait, we're already giving you a gumball"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (state == HAS_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Quarter returned"</span>);</span><br><span class="line">			state = NO_QUARTER;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Sorry, you already turned the crank"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</span><br><span class="line">        	System.out.println(<span class="string">"You can't eject, you haven't inserted a quarter yet"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (state == SOLD) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Turning twice doesn't get you another gumball!"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You turned but there's no quarter"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You turned, but there are no gumballs"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You turned..."</span>);</span><br><span class="line">			state = SOLD;</span><br><span class="line">			dispense();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (state == SOLD) &#123;</span><br><span class="line">			System.out.println(<span class="string">"A gumball comes rolling out the slot"</span>);</span><br><span class="line">			count = count - <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">				System.out.println(<span class="string">"Oops, out of gumballs!"</span>);</span><br><span class="line">				state = SOLD_OUT;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				state = NO_QUARTER;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"You need to pay first"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</span><br><span class="line">			System.out.println(<span class="string">"No gumball dispensed"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</span><br><span class="line">			System.out.println(<span class="string">"No gumball dispensed"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> numGumBalls)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.count = numGumBalls;</span><br><span class="line">		state = NO_QUARTER;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</span><br><span class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004\n"</span>);</span><br><span class="line">		result.append(<span class="string">"Inventory: "</span> + count + <span class="string">" gumball"</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</span><br><span class="line">			result.append(<span class="string">"s"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		result.append(<span class="string">"\nMachine is "</span>);</span><br><span class="line">		<span class="keyword">if</span> (state == SOLD_OUT) &#123;</span><br><span class="line">			result.append(<span class="string">"sold out"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</span><br><span class="line">			result.append(<span class="string">"waiting for quarter"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</span><br><span class="line">			result.append(<span class="string">"waiting for turn of crank"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</span><br><span class="line">			result.append(<span class="string">"delivering a gumball"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		result.append(<span class="string">"\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> result.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		GumballMachine gumballMachine = <span class="keyword">new</span> GumballMachine(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.ejectQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.ejectQuarter();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当需要增加功能时，这份代码将十分难以修改和扩展，比如现在我们需要当曲柄被转动时，有10%的记录掉下两颗糖果。</p>
<p>更好的设计是：</p>
<ol>
<li>定义一个state接口。在这个接口内，糖果机的每个动作都有一个对应的方法。</li>
<li>然后为机器的每个状态实现状态类。这些类将入则在对应状态下进行机器的行为。</li>
<li>将动作委托到状态类。</li>
</ol>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_state_2.png" alt="Design_pattern_state_2"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    GumballMachine gumballMachine;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You inserted a quarter"</span>);</span><br><span class="line">		gumballMachine.setState(gumballMachine.getHasQuarterState());</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You turned, but there's no quarter"</span>);</span><br><span class="line">	 &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You need to pay first"</span>);</span><br><span class="line">	&#125; </span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"waiting for quarter"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HasQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">	GumballMachine gumballMachine;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HasQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You can't insert another quarter"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Quarter returned"</span>);</span><br><span class="line">		gumballMachine.setState(gumballMachine.getNoQuarterState());</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You turned..."</span>);</span><br><span class="line">		gumballMachine.setState(gumballMachine.getSoldState());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"No gumball dispensed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"waiting for turn of crank"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoldState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    GumballMachine gumballMachine;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SoldState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Please wait, we're already giving you a gumball"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Sorry, you already turned the crank"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Turning twice doesn't get you another gumball!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		gumballMachine.releaseBall();</span><br><span class="line">		<span class="keyword">if</span> (gumballMachine.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			gumballMachine.setState(gumballMachine.getNoQuarterState());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"Oops, out of gumballs!"</span>);</span><br><span class="line">			gumballMachine.setState(gumballMachine.getSoldOutState());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"dispensing a gumball"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoldOutState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    GumballMachine gumballMachine;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SoldOutState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You can't insert a quarter, the machine is sold out"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You can't eject, you haven't inserted a quarter yet"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"You turned, but there are no gumballs"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"No gumball dispensed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"sold out"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	State soldOutState;</span><br><span class="line">	State noQuarterState;</span><br><span class="line">	State hasQuarterState;</span><br><span class="line">	State soldState;</span><br><span class="line"> </span><br><span class="line">	State state = soldOutState;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> numberGumballs)</span> </span>&#123;</span><br><span class="line">		soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</span><br><span class="line">		noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</span><br><span class="line">		hasQuarterState = <span class="keyword">new</span> HasQuarterState(<span class="keyword">this</span>);</span><br><span class="line">		soldState = <span class="keyword">new</span> SoldState(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.count = numberGumballs;</span><br><span class="line"> 		<span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			state = noQuarterState;</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.insertQuarter();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.ejectQuarter();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.turnCrank();</span><br><span class="line">		state.dispense();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</span><br><span class="line">			count = count - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> count;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.count = count;</span><br><span class="line">		state = noQuarterState;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldOutState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soldOutState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoQuarterState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> noQuarterState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasQuarterState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hasQuarterState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soldState;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</span><br><span class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004"</span>);</span><br><span class="line">		result.append(<span class="string">"\nInventory: "</span> + count + <span class="string">" gumball"</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</span><br><span class="line">			result.append(<span class="string">"s"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		result.append(<span class="string">"\n"</span>);</span><br><span class="line">		result.append(<span class="string">"Machine is "</span> + state + <span class="string">"\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> result.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		GumballMachine gumballMachine = <span class="keyword">new</span> GumballMachine(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="定义状态模式"><a href="#定义状态模式" class="headerlink" title="定义状态模式"></a>定义状态模式</h2><p>状态模式允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它的类。</p>
<p><img src="https://plusaberblog.s3-ap-northeast-1.amazonaws.com/image/Design_pattern_state_3.png" alt="Design_pattern_state_3"></p>
<p>状态模式跟策略模式形式上很相似，但是，意图不同！</p>
<p>状态模式将一群行为封装在状态对象中，运行过程中当前状态在状态对象集合中游走改变，但是客户端对于状态对象完全不了解。状态模式一般是用来避免在context中放置许多条件判断的替代方案，以便于扩展。</p>
<p>而策略模式中，通常是客户主动指定所需要的策略对象，以满足所需要的行为。策略模式是除继承之外一种弹性替代方案，可以避免被父类的行为困住，我们可以通过组合不同的对象来改变行为。</p>
<h2 id="解决扩展问题"><a href="#解决扩展问题" class="headerlink" title="解决扩展问题"></a>解决扩展问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	State soldOutState;</span><br><span class="line">	State noQuarterState;</span><br><span class="line">	State hasQuarterState;</span><br><span class="line">	State soldState;</span><br><span class="line">	State winnerState;</span><br><span class="line"> </span><br><span class="line">	State state = soldOutState;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> numberGumballs)</span> </span>&#123;</span><br><span class="line">		soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</span><br><span class="line">		noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</span><br><span class="line">		hasQuarterState = <span class="keyword">new</span> HasQuarterState(<span class="keyword">this</span>);</span><br><span class="line">		soldState = <span class="keyword">new</span> SoldState(<span class="keyword">this</span>);</span><br><span class="line">		winnerState = <span class="keyword">new</span> WinnerState(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.count = numberGumballs;</span><br><span class="line"> 		<span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			state = noQuarterState;</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.insertQuarter();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.ejectQuarter();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		state.turnCrank();</span><br><span class="line">		state.dispense();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</span><br><span class="line">			count = count - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> count;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.count = count;</span><br><span class="line">		state = noQuarterState;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldOutState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soldOutState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoQuarterState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> noQuarterState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasQuarterState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hasQuarterState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> soldState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getWinnerState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> winnerState;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</span><br><span class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004"</span>);</span><br><span class="line">		result.append(<span class="string">"\nInventory: "</span> + count + <span class="string">" gumball"</span>);</span><br><span class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</span><br><span class="line">			result.append(<span class="string">"s"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		result.append(<span class="string">"\n"</span>);</span><br><span class="line">		result.append(<span class="string">"Machine is "</span> + state + <span class="string">"\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> result.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WinnerState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    GumballMachine gumballMachine;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WinnerState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Please wait, we're already giving you a Gumball"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Please wait, we're already giving you a Gumball"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Turning again doesn't get you another gumball!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"YOU'RE A WINNER! You get two gumballs for your quarter"</span>);</span><br><span class="line">		gumballMachine.releaseBall();</span><br><span class="line">		<span class="keyword">if</span> (gumballMachine.getCount() == <span class="number">0</span>) &#123;</span><br><span class="line">			gumballMachine.setState(gumballMachine.getSoldOutState());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			gumballMachine.releaseBall();</span><br><span class="line">			<span class="keyword">if</span> (gumballMachine.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				gumballMachine.setState(gumballMachine.getNoQuarterState());</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	System.out.println(<span class="string">"Oops, out of gumballs!"</span>);</span><br><span class="line">				gumballMachine.setState(gumballMachine.getSoldOutState());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"despensing two gumballs for your quarter, because YOU'RE A WINNER!"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> headfirst.state.gumballstatewinner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		GumballMachine gumballMachine = </span><br><span class="line">			<span class="keyword">new</span> GumballMachine(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line"></span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line">		gumballMachine.insertQuarter();</span><br><span class="line">		gumballMachine.turnCrank();</span><br><span class="line"></span><br><span class="line">		System.out.println(gumballMachine);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/plusaber.jpg" alt="Plusaber">
            
              <p class="site-author-name" itemprop="name">Plusaber</p>
              <div class="site-description motion-element" itemprop="description">Plusaber's Blog</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">82</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jp.linkedin.com/in/zebangchen" title="https://jp.linkedin.com/in/zebangchen" rel="noopener" target="_blank">LinkedIn</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://indeed.com" title="https://indeed.com" rel="noopener" target="_blank">Indeed</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://baito.indeed.com" title="https://baito.indeed.com" rel="noopener" target="_blank">Baito</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.kaggle.com" title="https://www.kaggle.com" rel="noopener" target="_blank">Kaggle</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2014 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Plusaber</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.1.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.1"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://plusaber.disqus.com/count.js" async></script>







  




  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  

  

</body>
</html>
