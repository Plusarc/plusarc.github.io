<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="google88d81a02a91db82f" />










  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Plusaber&apos;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Plusaber's Blog">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="Plusaber's Blog">
<meta property="og:description" content="Plusaber&apos;s Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Plusaber's Blog">
<meta name="twitter:description" content="Plusaber&apos;s Blog">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/6/"/>


  <title> Plusaber's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-hk">

  


<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-79158075-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Plusaber's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/11/System Design_大型网站架构模式及核心要素/" itemprop="url">
                  System Design_大型网站架构模式及核心要素
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-11-11T00:00:00+09:00" content="2015-11-11">
              2015-11-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-design/" itemprop="url" rel="index">
                    <span itemprop="name">System design</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/11/System Design_大型网站架构模式及核心要素/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/11/System Design_大型网站架构模式及核心要素/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="大型网站架构模式"><a href="#大型网站架构模式" class="headerlink" title="大型网站架构模式"></a>大型网站架构模式</h1><p>所谓模式就是描述了在我们周围不断重复发生的问题以及该问题解决方案的核心，这样我们可以一次又一次使用该方案而不必重复解决问题。模式的关键在于模式的可重复性，问题与场景的可重复性带来解决方案的可重复使用。</p>
<p>为了解决大型网站面临的高并发访问、海量数据处理、高可靠运行等一系列问题与挑战，许多公司在实践中提出了许多解决方案，以实现网站高性能、高可用、易伸缩、可扩展、安全等技术架构目标。</p>
<h2 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h2><p>分层是企业应用系统常用的架构模式，将系统在横向维度切分为几个部分（垂直的分为几层），然后通过上层对下层的依赖和调用组成一个完整的系统，如分割为应用层、服务层、数据层，应用层可细分问u视图层、业务逻辑层。服务层可以细分为数据接口层、逻辑处理层。</p>
<p>不同层可以部署在不同的服务器上，实现低耦合，可伸缩。</p>
<h2 id="分割"><a href="#分割" class="headerlink" title="分割"></a>分割</h2><p>水平分割，例如按照功能将系统分割，包装为高内聚低耦合的模块单元，一方面有助于软件的开发和维护，同样便于不同模块的分布式部署，提高网站的并发处理能力和功能扩张能力。</p>
<h2 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h2><p>对于大型网站，分层和分割的一个主要目的是为了切分后的模块便于分布式部署，可通过增加机器提高并发能力。但分布式需要通过网络，会带来性能的影响，多个服务器也意味着机器出现问题的概率变大，降低网站的可用性。另外一个问题是在分布式的环境中保持数据一致性。</p>
<p>几种分布式方案：</p>
<ol>
<li>分布式应用和服务：将分层和分割后的应用和服务分布式部署，</li>
<li>分布式静态资源：将网站的静态资源独立分布式部署。</li>
<li>分布式数据和存储：分布式数据库，NoSQL等。</li>
<li>分布式计算</li>
</ol>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><p>使用分布式虽然已经将分层和分割后的模块独立部署，但是对于用户访问集中的模块，还需要将独立部署的服务器集群化，即多台服务器部署相同服务，通过负载均衡设备共同对外提供服务。通过添加新服务器可以提高服务能力，也就是具有可伸缩性，另外还可以通过失效转移等机制保证可用性。</p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><ul>
<li><strong>CDN</strong>：内容分发网络，部署在离终端用户最近的网络服务提供商，缓存网站一些静态资源(变化较少的资源)或者热点内容。</li>
<li><strong>反向代理</strong>：反向代理属于网站前端架构的一部分，部署在网站的前端，当用户请求到达网站的数据中心时，最先访问的就是反向代理服务器，这里缓存网站的静态和热点资源，无需将请求转发给应用服务器就可以返回给用户。</li>
<li><strong>本地缓存</strong>：在应用服务器本地缓存热点数据，减少访问文件和数据库。</li>
<li><strong>分布式缓存</strong>：本地缓存一般不够大，另外将数据缓存在一个专门的分布式缓存集群中，通过网络通信访问缓存数据。</li>
</ul>
<h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><p>降低软件耦合性，前面分层、分割、分布也是同样的目标。通过异步，业务之间的消息传递不是同步调用，而是将一个业务操作分成多个阶段，每个阶段之间通过共享数据的方式异步执行协作。</p>
<p>在单一服务器内部可通过多线程共享内存队列的方式实现异步：在分布式系统中，多个服务器可以通过分布式消息队列实现异步。</p>
<p>异步架构是典型的生产者消费者模式，两者不存在直接调用，只要保持数据结构不变，批次功能实现可以随意变化而不互相影响，这对网站扩展新功能非常便利。另外，使用异步消息队列还有如下特性。</p>
<p><strong>提高系统可用性</strong>：消费者服务器发生故障，数据会在消息队列服务器中堆积，生产者可以继续处理业务请求，系统整体无故障。消费者服务器恢复正常后，继续处理消息队列中的数据。</p>
<p><strong>加快网站相应速度</strong>：处在业务处理前端的生产者服务器可以在处理完业务请求后，将数据写入消息队列后返回，不需要同步等待消费者服务器处理就可以返回，减少相应延迟。</p>
<p><strong>消除并发访问高峰</strong>：用户访问存在突然的高峰，如果同时同步处理所有访问，会导致网站负载过重，响应延迟。使用消息队列将突然增加的访问请求数据放入消息队列中，等待消费者服务器依次处理，就不会对整个网站负载造成太大压力。</p>
<h2 id="冗余"><a href="#冗余" class="headerlink" title="冗余"></a>冗余</h2><p>要保证网站的可用性，需要一定程度的服务器冗余运行，数据冗余备份，这样当某台服务器宕机时，可以将其上的服务和数据访问转移到其他机器上。数据库除了冷备份外，为了保证在线业务高可用，也需要对数据库进行主从分离，实时同步实现热备份。</p>
<h2 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h2><h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><h1 id="大型网站核心要素"><a href="#大型网站核心要素" class="headerlink" title="大型网站核心要素"></a>大型网站核心要素</h1><p>除了系统的功能需求外，软件架构还需要关注可能、可用性、伸缩性、扩展性、安全性这个5个架构要素，以及平衡这5个要素之间的关系以实现需求和架构目标。</p>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><p>性能是网站的一个重要指标，用户无法忍受一个相应缓慢的网站。</p>
<p>性能的问题无处不在，所以优化的方面也很多：</p>
<ul>
<li>在浏览器端，可以通过浏览器缓存、页面压缩、减少cookie传输、JavaScript实现可以在本地实现的功能，减少访问次数</li>
<li>CDN，反向代理服务器缓存热点文件。</li>
<li>应用服务器端，可以使用服务器本地缓存和分布式缓存，通过缓存在内存的热点数据，减少访问数据库，加快请求处理过程。</li>
<li>异步将用户请求发送到消息队列等待处理，直接返回相应给用户。</li>
<li>在高并发请求的情况下，可以将多台应用服务器组成一个集群共同对外服务，提高整体处理能力。</li>
<li>代码层面，使用合适的数据结构、高效算法，以及多线程、改善内存管理等手段优化性能。</li>
<li>数据库服务器端，索引、索引、sql优化。</li>
<li>NoSQL，Hadoop，分布式计算和存储。</li>
</ul>
<p>衡量网站性能有一系列指标，如相应时间、TPS等，可以测试这些指标确定系统是否达到目标。</p>
<h2 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h2><p>高可用架构设计的前提是必然出现服务器宕机，设计目标是服务器宕机时，服务依然可用。</p>
<p>实现高可用的主要手段是冗余，应用部署在多台服务器上同时提供服务，数据存储在多台服务器上相互备份，任何一台机器宕机不会影响整体服务，也不会导致数据丢失。</p>
<p>对于应用服务器，可以通过负载均衡服务器组成一个集群共同对外提供服务，一台机器宕机时可以将服务转移到其他机器上，前提是服务器不在本地保存服务的会话信息。</p>
<p>对于存储服务器，需要实现实时备份。</p>
<h2 id="伸缩性"><a href="#伸缩性" class="headerlink" title="伸缩性"></a>伸缩性</h2><p>所谓伸缩性是指能否通过不断增加机器来缓解上升用户的并发访问压力和不断增长的数据存储需求。加入新的服务器后是否可以能提供和原来的服务器无差别的服务，集群中可容纳的总得服务器数量是否有限制。</p>
<p>对于应用服务器集群，只要服务器上不保存数据，所有服务器都是对等的，通过使用合适的负载均衡就可以向集群中不断加入服务器。</p>
<p>对于缓存服务器集群，加入新的服务其可能会导致缓存路由失效，进而导致集群中大部分缓存数据都无法访问。如果应用严重依赖缓存，可能对网站造成严重影响甚至数据库服务崩溃。需要改进缓存路由算法保证缓存数据的可访问性，一个解决方法是一致性hash算法。</p>
<p>关系数据库虽然支持数据复制，主从热备等机制，但是很难做到大规模集群的可伸缩性，因此关系数据库的集群伸缩方案必须在数据库之外实现，通过路由分区等手段将部署多个数据的服务器组成一个集群。</p>
<p>至于大部分NoSQL数据库产品，由于其就是为海量数据而生，所以对伸缩性支持都非常好，可以做到在较少操作下实现集群规模的线性伸缩。</p>
<h2 id="扩展性"><a href="#扩展性" class="headerlink" title="扩展性"></a>扩展性</h2><p>网站的扩展性架构直接关注网站的功能需求。网站快速发展，功能不断扩展，如何设计网站的架构使其能够快速相应需求变化，是网站可扩展的主要目的。</p>
<p>衡量网站架构扩展性的好坏的主要标准就是在网站增加新的业务产品时，是否可以实现对现有产品透明无影响，不需要改动或很少改动既有业务功能就可以上线新功能。不同产品之间是否很少耦合，一个产品改动对其他产品无影响。</p>
<p>网站可伸缩架构的主要手段是事件驱动和分布式服务。</p>
<p>事件驱动架构在网站使用消息队列实现，将用户请求和其他业务时间构造消息发布到消息队列，消息的处理作为消费者从消息队列中获取消息进行处理。通过这种方式将消息产生和消息处理分离开来，可以透明地增加新的消息生产者任务或者新的消息消费者任务。</p>
<p>分布式服务则是将业务和可复用的服务分离开来，通过分布式服务框架调用。新增产品可以调用可复用的服务实现自身的业务逻辑，而对现有产品没有任何影响。可复用服务升级变更时，也可以通过提供多版本服务对应用实现透明升级，不需要强制应用同步变更。</p>
<h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2><p>安全架构目的是保证网站不受恶意访问和攻击，保护网站的重要数据不被窃取。</p>
<p>衡量网站安全架构的标准就是针对现存和潜在的各种攻击和窃密手段，是否有可靠的应对策略。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/08/Leetcode_Meeting Rooms/" itemprop="url">
                  Meeting Rooms
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-11-08T00:00:00+09:00" content="2015-11-08">
              2015-11-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/08/Leetcode_Meeting Rooms/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/08/Leetcode_Meeting Rooms/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Meeting-Rooms"><a href="#Meeting-Rooms" class="headerlink" title="Meeting Rooms"></a><a href="">Meeting Rooms</a></h1><p>Lock题目，参考：<br><a href="http://segmentfault.com/a/1190000003894670" target="_blank" rel="external">[Leetcode] Meeting Rooms 会议室.</a><br><a href="https://tonycao.gitbooks.io/leetcode-locked/content/LeetCode%20Locked/c1.6.html" target="_blank" rel="external">Leetcode_locked</a></p>
<h2 id="Meeting-Rooms-I"><a href="#Meeting-Rooms-I" class="headerlink" title="Meeting Rooms I"></a>Meeting Rooms I</h2><blockquote>
<p>Given an array of meeting time intervals consisting of start and end times <code>[[s1,e1],[s2,e2],...] (si &lt; ei)</code>, determine if a person could attend all meetings.</p>
<p>For example, Given <code>[[0, 30],[5, 10],[15, 20]]</code>, return false.</p>
</blockquote>
<h3 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h3><p>这题和Merge Intervals很像，我们按开始时间把这些Interval都给排序后，就挨个检查是否有冲突就行了。有冲突的定义是开始时间小于之前最晚的结束时间。这里之前最晚的结束时间不一定是上一个的结束时间，所以我们更新的时候要取最大值。</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canAttendMeetings</span><span class="params">(Interval[] intervals)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(intervals == <span class="keyword">null</span> || intervals.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        Arrays.sort(intervals, <span class="keyword">new</span> Comparator&lt;Interval&gt;()&#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Interval i1, Interval i2)</span></span>&#123;</div><div class="line">                <span class="keyword">return</span> i1.start - i2.start;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">int</span> end = intervals[<span class="number">0</span>].end;</div><div class="line">        <span class="comment">// 检查每一个Interval</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; intervals.length; i++)&#123;</div><div class="line">            <span class="comment">// 如果Interval的开始时间小于之前最晚的结束时间，就返回假</span></div><div class="line">            <span class="keyword">if</span>(intervals[i].start &lt; end) <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            end = Math.max(end, intervals[i].end);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Meeting-Rooms-II"><a href="#Meeting-Rooms-II" class="headerlink" title="Meeting Rooms II"></a>Meeting Rooms II</h2><blockquote>
<p>Given an array of meeting time intervals consisting of start and end times <code>[[s1,e1],[s2,e2],...] (si &lt; ei)</code>, find the minimum number of conference rooms required.</p>
<p>For example, Given <code>[[0, 30],[5, 10],[15, 20]]</code>, return <code>2</code>.</p>
</blockquote>
<h3 id="Method-1"><a href="#Method-1" class="headerlink" title="Method"></a>Method</h3><p>这题的思路和<a href="http://www.geeksforgeeks.org/rearrange-a-string-so-that-all-same-characters-become-at-least-d-distance-away/" target="_blank" rel="external">Rearrange array to certain distance</a>很像，我们要用贪心法，即从第一个时间段开始，选择下一个最近不冲突的时间段，再选择下一个最近不冲突的时间段，直到没有更多。然后如果有剩余时间段，开始为第二个房间安排，选择最早的时间段，再选择下一个最近不冲突的时间段，直到没有更多，如果还有剩余时间段，则开辟第三个房间，以此类推。这里的技巧是我们不一定要遍历这么多遍，我们实际上可以一次遍历的时候就记录下，比如第一个时间段我们放入房间1，然后第二个时间段，如果和房间1的结束时间不冲突，就放入房间1，否则开辟一个房间2。然后第三个时间段，如果和房间1或者房间2的结束时间不冲突，就放入房间1或者2，否则开辟一个房间3，依次类推，最后统计开辟了多少房间。对于每个房间，我们只要记录其结束时间就行了，这里我们查找不冲突房间时，只要找结束时间最早的那个房间。<br>这里还有一个技巧，如果我们把这些房间当作List来管理，每次查询需要O(N)时间，如果我们用堆来管理，可以用logN时间找到时间最早结束的房间。</p>
<h3 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minMeetingRooms</span><span class="params">(Interval[] intervals)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(intervals == <span class="keyword">null</span> || intervals.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        Arrays.sort(intervals, <span class="keyword">new</span> Comparator&lt;Interval&gt;()&#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Interval i1, Interval i2)</span></span>&#123;</div><div class="line">                <span class="keyword">return</span> i1.start - i2.start;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// 用堆来管理房间的结束时间</span></div><div class="line">        PriorityQueue&lt;Integer&gt; endTimes = <span class="keyword">new</span> PriorityQueue&lt;Integer&gt;();</div><div class="line">        endTimes.offer(intervals[<span class="number">0</span>].end);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; intervals.length; i++)&#123;</div><div class="line">            <span class="comment">// 如果当前时间段的开始时间大于最早结束的时间，则可以更新这个最早的结束时间为当前时间段的结束时间，如果小于的话，就加入一个新的结束时间，表示新的房间</span></div><div class="line">            <span class="keyword">if</span>(intervals[i].start &gt;= endTimes.peek())&#123;</div><div class="line">                endTimes.poll();</div><div class="line">            &#125;</div><div class="line">            endTimes.offer(intervals[i].end);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 有多少结束时间就有多少房间</span></div><div class="line">        <span class="keyword">return</span> endTimes.size();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/05/System Design_大型网站架构发展c1/" itemprop="url">
                  System Design_大型网站架构发展
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-11-05T00:00:00+09:00" content="2015-11-05">
              2015-11-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-design/" itemprop="url" rel="index">
                    <span itemprop="name">System design</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/05/System Design_大型网站架构发展c1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/05/System Design_大型网站架构发展c1/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="大型网站架构发展"><a href="#大型网站架构发展" class="headerlink" title="大型网站架构发展"></a>大型网站架构发展</h1><p>大型网站的技术挑战主要来自于庞大的用户，高并发的访问和海量的数据，任何简单的业务一旦需要处理以P计的数据和数亿的用户，就会变得很棘手，这也是大型网站架构需要解决的问题。</p>
<h2 id="初始阶段的网站架构"><a href="#初始阶段的网站架构" class="headerlink" title="初始阶段的网站架构"></a>初始阶段的网站架构</h2><p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_1.png" alt="System_design_c1_1"></p>
<p>由于用户量并不大，可以直接将应用程序、数据库、文件等所有资源放在一台服务器上。</p>
<h2 id="应用服务和数据服务分离"><a href="#应用服务和数据服务分离" class="headerlink" title="应用服务和数据服务分离"></a>应用服务和数据服务分离</h2><p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_2.png" alt="System_design_c1_"></p>
<p>需要将应用和数据分离，应用服务器需要处理大量的业务逻辑，需要强大的计算能力，数据库需要快速磁盘检索和数据缓存，所以需要更快的硬盘和更大的内存，文件服务器需要存储大量文件以及文件检索，需要更大的硬盘和内存。这样也方便扩展增加服务器。</p>
<h2 id="使用缓存改善网站性能"><a href="#使用缓存改善网站性能" class="headerlink" title="使用缓存改善网站性能"></a>使用缓存改善网站性能</h2><p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_3.png" alt="System_design_c1_3"></p>
<p>80%的业务集中在20%的数据上，如果将热门的数据缓存在内存中，可以很大的改善网站的相应速度。缓存可以分为两种，本地缓存和专门的分布式缓存服务器，考虑到扩展性，一般使用远程分布式缓存，以集群的方式部署大内存的服务器作为专门的缓存服务器。</p>
<h2 id="使用应用服务器集群改善网站的并发处理能力。"><a href="#使用应用服务器集群改善网站的并发处理能力。" class="headerlink" title="使用应用服务器集群改善网站的并发处理能力。"></a>使用应用服务器集群改善网站的并发处理能力。</h2><p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_4.png" alt=""></p>
<p>使用集群是完整解决高并发、海量数据的常用手段，也就是横向扩展(通过增加机器的方式扩展，与之相对的是纵向扩展，也就是通过增强一台机器的性能进行扩展)。对于大型网站而言，不管多强大的服务器，都无法满足持续增长的业务需求，这种情况下，更恰当的做法是增加一台服务器分担原有服务器的压力。</p>
<p>通过这种方式可以持续增加服务器不断改善系统性能，从而实现系统的可伸缩性。应用服务器实现集群也是网站可伸缩性集群架构设计中较简单成熟的一种。</p>
<h2 id="数据库读写分离"><a href="#数据库读写分离" class="headerlink" title="数据库读写分离"></a>数据库读写分离</h2><p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_5.png" alt=""></p>
<p>网站使用缓存后，可以很大程度减轻数据库的压力，但随着用户的进一步增加，数据库仍会因为负载压力过高成为网站的瓶颈，需要数据库读写分离来减轻负载。</p>
<p>应用服务其在写数据时，访问主数据库，主数据库通过主从复制将数据同步到从数据库，这样当应用服务器读数据的时候，就可以通过从数据库获得数据，</p>
<h2 id="使用反向代理和CDN加速网站响应"><a href="#使用反向代理和CDN加速网站响应" class="headerlink" title="使用反向代理和CDN加速网站响应"></a>使用反向代理和CDN加速网站响应</h2><p>CDN和反向代理的基本原理都是缓存，区别在于CDB部署在网络提供商的机房，反向代理则部署在网站的中心机房，当用户到达中心机房后，首先访问反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接诶返回给用户。</p>
<p>一方面可以加快访问速度，也可以减轻后端服务器的压力。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_6.png" alt=""></p>
<h2 id="使用分布式文件系统和分布式数据库系统"><a href="#使用分布式文件系统和分布式数据库系统" class="headerlink" title="使用分布式文件系统和分布式数据库系统"></a>使用分布式文件系统和分布式数据库系统</h2><p>分布式数据库系统是网站数据库拆分的最后手段，只有在单表数据规模¥非常大是才使用。一般网站更常用的数据库拆分手段是<strong>业务分库</strong>，将不同业务的数据库部署到不同的数据库服务器上。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_7.png" alt=""></p>
<h2 id="使用NoSQL和搜索引擎"><a href="#使用NoSQL和搜索引擎" class="headerlink" title="使用NoSQL和搜索引擎"></a>使用NoSQL和搜索引擎</h2><p>随着网站业务越累越复杂，对数据存储和检索的需求也越来越复杂，网站需要使用一些非关系数据库技术如NoSQL和非数据库查询技术如搜索引擎。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_8.png" alt=""></p>
<p>NoSQL和搜索引擎都对可伸缩的分布式特性具有很好的支持。应用服务器则通过一个统一的数据访问模块访问各种数据，减轻应用程序管理多数据源的问题。</p>
<h2 id="业务拆分"><a href="#业务拆分" class="headerlink" title="业务拆分"></a>业务拆分</h2><p>大型网站为了应对日益复杂的业务场景，通过分而治之的手段将整个网站业务分成不同的产品线，如首页，支付，订单，卖家，买家等，分到不同的业务团队负责。</p>
<p>具体到技术上，也会根据产品线划分，将一个网站拆分成许多不同的应用，每个应用独立部署，应用之间可以通过超链接建立关系，也可以通过消息队列进行数据分发，最常用的还是通过访问同一个存储系统来构成一个关联的完整系统。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_9.png" alt=""></p>
<h2 id="分布式服务"><a href="#分布式服务" class="headerlink" title="分布式服务"></a>分布式服务</h2><p>随着业务拆分越累越小，存储系统越来越大，应用系统的整体复杂度呈指数增加，部署维护困难。由于所有的应用要和所有数据库系统连接，这些连接是服务器规模的平方，会导致数据库资源不够。</p>
<p>由于很多子应用系统都需要进行很多相同的业务操作，如用户管理，商品管理等，可以将这些公用的服务提取出来，独立部署，有这些可复用的业务连接数据库，并对外提供公共服务。应用系统只需要通过分布式服务调用公共业务服务完成具体业务操作。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/System_design_c1_10.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/02/Leetcode_Shortest Word Distance/" itemprop="url">
                  Shortest Word Distance
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-11-02T00:00:00+09:00" content="2015-11-02">
              2015-11-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/02/Leetcode_Shortest Word Distance/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/02/Leetcode_Shortest Word Distance/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Shortest-Word-Distance"><a href="#Shortest-Word-Distance" class="headerlink" title="Shortest Word Distance"></a>Shortest Word Distance</h1><h2 id="Shortest-Word-Distance-1"><a href="#Shortest-Word-Distance-1" class="headerlink" title="Shortest Word Distance"></a><a href="http://segmentfault.com/a/1190000003906667" target="_blank" rel="external">Shortest Word Distance</a></h2><blockquote>
<p>Given a list of words and two words word1 and word2, return the shortest distance between these two words in the list.</p>
<p>For example, Assume that words = [“practice”, “makes”, “perfect”, “coding”, “makes”].</p>
<p>Given word1 = “coding”, word2 = “practice”, return 3. Given word1 = “makes”, word2 = “coding”, return 1.</p>
<p>Note: You may assume that word1 does not equal to word2, and word1 and word2 are both in the list.</p>
</blockquote>
<h2 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h2><p><a href="http://segmentfault.com/a/1190000003906667" target="_blank" rel="external">Shortest Word Distance</a><br><a href="http://blog.csdn.net/crazy__chen/article/details/47859737" target="_blank" rel="external">Shortest Word Distance</a></p>
<p>双指针法.<br>一个指针指向word1上次出现的位置，一个指针指向word2上次出现的位置。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">shortestDistance</span><span class="params">(String[] words, String word1, String word2)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (words == <span class="keyword">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> idx1 = -<span class="number">1</span>, idx2 = -<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> diff = words.length;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (words[i].equals(word1)) &#123;</div><div class="line">                idx1 = i;                </div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (words[i].equals(word2)) &#123;</div><div class="line">                idx2 = i;                </div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(idx1!=-<span class="number">1</span>&amp;&amp;idx2!=-<span class="number">1</span>)&#123;</div><div class="line">                diff = Math.min(diff,Math.abs(idx1-idx2));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> diff;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Shortest-Word-Distance-II"><a href="#Shortest-Word-Distance-II" class="headerlink" title="Shortest Word Distance II"></a><a href="">Shortest Word Distance II</a></h2><blockquote>
<p>This is a follow up of Shortest Word Distance. The only difference is now you are given the list of words and your method will be called repeatedly many times with different parameters. How would you optimize<br>it?</p>
<p>Design a class which receives a list of words in the constructor, and implements a method that takes two<br>words word1 and word2 and return the shortest distance between these two words in the list.</p>
<p>For example,<br>Assume that words = [“practice”, “makes”, “perfect”, “coding”, “makes”] .<br>Given word1 = “coding” , word2 = “practice” , return 3. Given word1 = “makes” , word2 =<br>“coding” , return 1.</p>
<p>Note: You may assume that word1 does not equal to word2, and word1 and word2 are both in the list.</p>
</blockquote>
<h2 id="Method-1"><a href="#Method-1" class="headerlink" title="Method"></a>Method</h2><p><a href="http://blog.csdn.net/crazy__chen/article/details/47859865" target="_blank" rel="external">Shortest Word Distance II</a></p>
<p>在构造函数，使用hashMap来记录每个单词的位置.</p>
<p>在计算最短距离的函数中，两个列表是已排序的，因此可使用类似MergeSort的思路求解最短距离。 </p>
<h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordDistance</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> HashMap&lt;String, List&lt;Integer&gt;&gt; indexer = <span class="keyword">new</span> HashMap&lt;String, List&lt;Integer&gt;&gt;();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WordDistance</span><span class="params">(String[] words)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (words == <span class="keyword">null</span>) <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (indexer.containsKey(words[i])) &#123;</div><div class="line">                indexer.get(words[i]).add(i);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                List&lt;Integer&gt; positions = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</div><div class="line">                positions.add(i);</div><div class="line">                indexer.put(words[i], positions);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">shortest</span><span class="params">(String word1, String word2)</span> </span>&#123;</div><div class="line">        List&lt;Integer&gt; posList1 = indexer.get(word1);</div><div class="line">        List&lt;Integer&gt; posList2 = indexer.get(word2);</div><div class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> diff = Integer.MAX_VALUE;</div><div class="line">        <span class="keyword">while</span> (i &lt; posList1.size() &amp;&amp; j &lt; posList2.size()) &#123;</div><div class="line">            <span class="keyword">int</span> pos1 = posList1.get(i), pos2 = posList2.get(j);</div><div class="line">            <span class="keyword">if</span> (pos1 &lt; pos2) &#123;</div><div class="line">                diff = Math.min(diff, pos2 - pos1);</div><div class="line">                i++;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                diff = Math.min(diff, pos1 - pos2);</div><div class="line">                j++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> diff;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Shortest-Word-Distance-III"><a href="#Shortest-Word-Distance-III" class="headerlink" title="Shortest Word Distance III"></a><a href="">Shortest Word Distance III</a></h2><blockquote>
<p>This is a follow up of Shortest Word Distance. The only difference is now word1 could be the same as word2.</p>
<p>Given a list of words and two words word1 and word2, return the shortest distance between these two words in the list.</p>
<p>word1 and word2 may be the same and they represent two individual words in the list.</p>
<p>For example,<br>Assume that words = [“practice”, “makes”, “perfect”, “coding”, “makes”].</p>
<p>Given word1 = “makes”, word2 = “coding”, return 1.<br>Given word1 = “makes”, word2 = “makes”, return 3.</p>
<p>Note:<br>You may assume word1 and word2 are both in the list.</p>
</blockquote>
<h2 id="Method-2"><a href="#Method-2" class="headerlink" title="Method"></a>Method</h2><p>解法基本与I相同，需要加一个是否是同一位置的判断。 </p>
<h2 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">shortestWordDistance</span><span class="params">(String[] words, String word1, String word2)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p1 = -<span class="number">1</span>, p2 = -<span class="number">1</span>, distance = words.length;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;words.length; i++)&#123;</div><div class="line">            <span class="keyword">if</span>(words[i].equals(word1))&#123;</div><div class="line">                p1 = i;</div><div class="line">                <span class="keyword">if</span>(p1 != -<span class="number">1</span> &amp;&amp; p2 != -<span class="number">1</span>)&#123;</div><div class="line">                    distance = (p1!=p2) ? Math.min(distance, Math.abs(p1-p2)): distance;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(words[i].equals(word2))&#123;</div><div class="line">                p2 = i;</div><div class="line">                <span class="keyword">if</span>(p1 != -<span class="number">1</span> &amp;&amp; p2 != -<span class="number">1</span>)&#123;</div><div class="line">                    distance = (p1!=p2) ? Math.min(distance, Math.abs(p1-p2)): distance;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> distance;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/27/Leetcode_The Skyline Problem/" itemprop="url">
                  The Skyline Problem
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-10-27T00:00:00+09:00" content="2015-10-27">
              2015-10-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/27/Leetcode_The Skyline Problem/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/27/Leetcode_The Skyline Problem/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="The-Skyline-Problem"><a href="#The-Skyline-Problem" class="headerlink" title="The Skyline Problem"></a><a href="https://leetcode.com/problems/the-skyline-problem/" target="_blank" rel="external">The Skyline Problem</a></h1><blockquote>
<p>A city’s skyline is the outer contour of the silhouette formed by all the buildings in that city when viewed from a distance. Now suppose you are <strong>given the locations and height of all the buildings</strong> as shown on a cityscape photo (Figure A), write a program to <strong>output the skyline</strong> formed by these buildings collectively (Figure B).</p>
<p><img src="https://leetcode.com/static/images/problemset/skyline1.jpg" alt="">  <img src="https://leetcode.com/static/images/problemset/skyline2.jpg" alt=""></p>
<p>The geometric information of each building is represented by a triplet of integers <code>[Li, Ri, Hi]</code>, where <code>Li</code> and <code>Ri</code> are the x coordinates of the left and right edge of the ith building, respectively, and <code>Hi</code> is its height. It is guaranteed that <code>0 ≤ Li, Ri ≤ INT_MAX, 0 &lt; Hi ≤ INT_MAX</code>, and <code>Ri - Li &gt; 0</code>. You may assume all buildings are perfect rectangles grounded on an absolutely flat surface at height 0.</p>
</blockquote>
<p>For instance, the dimensions of all buildings in Figure A are recorded as: <code>[ [2 9 10], [3 7 15], [5 12 12], [15 20 10], [19 24 8] ]</code> .</p>
<p>The output is a list of “key points” (red dots in Figure B) in the format of <code>[ [x1,y1], [x2, y2], [x3, y3], ... ]</code> that uniquely defines a skyline. A key point is the left endpoint of a horizontal line segment. Note that the last key point, where the rightmost building ends, is merely used to mark the termination of the skyline, and always has zero height. Also, the ground in between any two adjacent buildings should be considered part of the skyline contour.</p>
<p>For instance, the skyline in Figure B should be represented as:<code>[ [2 10], [3 15], [7 12], [12 0], [15 10], [20 8], [24, 0] ]</code>.</p>
<p>Notes:</p>
<p>The number of buildings in any input list is guaranteed to be in the range <code>[0, 10000]</code>.<br>The input list is already sorted in ascending order by the left x position <code>Li</code>.<br>The output list must be sorted by the x position.<br>There must be no consecutive horizontal lines of equal height in the output skyline. For instance, <code>[...[2 3], [4 5], [7 5], [11 5], [12 7]...]</code> is not acceptable; the three lines of height 5 should be merged into one in the final output as such: <code>[...[2 3], [4 5], [12 7], ...]</code></p>
<h2 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h2><p><a href="http://segmentfault.com/a/1190000003786782" target="_blank" rel="external">The Skyline Problem</a><br>如果按照一个矩形一个矩形来处理将会非常麻烦，我们可以把这些矩形拆成两个点，一个左上顶点，一个右上顶点。将所有顶点按照横坐标排序后，我们开始遍历这些点。遍历时，通过一个堆来得知当前图形的最高位置。堆顶是所有顶点中最高的点，只要这个点没被移出堆，说明这个最高的矩形还没结束。对于左顶点，我们将其加入堆中。对于右顶点，我们找出堆中其相应的左顶点，然后移出这个左顶点，同时也意味这这个矩形的结束。具体代码中，为了在排序后的顶点列表中区分左右顶点，左顶点的值是正数，而右顶点值则存的是负数。</p>
<p>注意</p>
<p>堆中先加入一个零点高度，帮助我们在只有最矮的建筑物时选择最低值.</p>
<p>最核心的思想：扫描到左边界的时候，将高度加入到大顶堆，cur的值去peek即为当前的最大值，当cur和pre不同的时候，将坐标加入结果队列即可，当为右边界时（高度为负值），证明该矩形已经到头，在堆中去掉其高度值，如果此时队列为空，则证明此处非连续，即此时应加入的高度为0，如果不为空，则更新相应当前最高即可。</p>
<p><a href="http://codechen.blogspot.jp/2015/06/leetcode-skyline-problem.html" target="_blank" rel="external">[LeetCode] The Skyline Problem</a></p>
<p><strong>Thinking:</strong><br>(1) 自建一个名为Height的数据结构，保存一个building的index和height。约定，当height为负数时表示这个高度为height的building起始于index；height为正时表示这个高度为height的building终止于index。</p>
<p>(2) 对building数组进行处理，每一行[ Li, Ri, Hi ]，根据Height的定义，转换为两个Height的对象，即，Height(Li, -Hi) 和 Height(Ri, Hi)。 将这两个对象存入heights这个List中。</p>
<p>(3) 写个Comparator对heights进行升序排序，首先按照index的大小排序，若index相等，则按height大小排序，以保证一栋建筑物的起始节点一定在终止节点之前。</p>
<p>(4) 将heights转换为结果。使用PriorityQueue对高度值进行暂存。遍历heights，遇到高度为负值的对象时，表示建筑物的起始节点，此时应将这个高度加入PriorityQueue。遇到高度为正值的对象时，表示建筑物的终止节点，此时应将这个高度从PriorityQueue中除去。且在遍历的过程中检查，当前的PriorityQueue的peek()是否与上一个iteration的peek()值（prev）相同，若否，则应在结果中加入[当前对象的index, 当前PriorityQueue的peek()]，并更新prev的值。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getSkyline(<span class="keyword">int</span>[][] buildings) &#123;</div><div class="line">        List&lt;<span class="keyword">int</span>[]&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;<span class="keyword">int</span>[]&gt; height = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="comment">// 拆解矩形，构建顶点的列表</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span>[] b:buildings) &#123;</div><div class="line">            <span class="comment">// 左顶点存为负数</span></div><div class="line">            height.add(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;b[<span class="number">0</span>], -b[<span class="number">2</span>]&#125;);</div><div class="line">            <span class="comment">// 右顶点存为正数</span></div><div class="line">            height.add(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;b[<span class="number">1</span>], b[<span class="number">2</span>]&#125;);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 根据横坐标对列表排序，相同横坐标的点纵坐标小的排在前面</span></div><div class="line">        Collections.sort(height, <span class="keyword">new</span> Comparator&lt;<span class="keyword">int</span>[]&gt;()&#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span>[] a, <span class="keyword">int</span>[] b)</span></span>&#123;</div><div class="line">                <span class="keyword">if</span>(a[<span class="number">0</span>] != b[<span class="number">0</span>])&#123;</div><div class="line">                    <span class="keyword">return</span> a[<span class="number">0</span>] - b[<span class="number">0</span>];</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">return</span> a[<span class="number">1</span>] - b[<span class="number">1</span>];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// 构建堆，按照纵坐标来判断大小</span></div><div class="line">        Queue&lt;Integer&gt; pq = <span class="keyword">new</span> PriorityQueue&lt;Integer&gt;(<span class="number">11</span>, <span class="keyword">new</span> Comparator&lt;Integer&gt;()&#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer i1, Integer i2)</span></span>&#123;</div><div class="line">                <span class="keyword">return</span> i2 - i1;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="comment">// 将地平线值0先加入堆中</span></div><div class="line">        pq.offer(<span class="number">0</span>);</div><div class="line">        <span class="comment">// prev用于记录上次keypoint的高度</span></div><div class="line">        <span class="keyword">int</span> prev = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span>[] h:height) &#123;</div><div class="line">            <span class="comment">// 将左顶点加入堆中</span></div><div class="line">            <span class="keyword">if</span>(h[<span class="number">1</span>] &lt; <span class="number">0</span>) &#123;</div><div class="line">                pq.offer(-h[<span class="number">1</span>]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 将右顶点对应的左顶点移去</span></div><div class="line">                pq.remove(h[<span class="number">1</span>]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">int</span> cur = pq.peek();</div><div class="line">            <span class="comment">// 如果堆的新顶部和上个keypoint高度不一样，则加入一个新的keypoint</span></div><div class="line">            <span class="keyword">if</span>(prev != cur) &#123;</div><div class="line">                result.add(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;h[<span class="number">0</span>], cur&#125;);</div><div class="line">                prev = cur;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/66/">66</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/plusaber.jpg"
               alt="Plusaber" />
          <p class="site-author-name" itemprop="name">Plusaber</p>
          <p class="site-description motion-element" itemprop="description">Plusaber's Blog</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">328</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分類</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">標籤</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.kaggle.com" title="Kaggle" target="_blank">Kaggle</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.algolia.com" title="Algolia" target="_blank">Algolia</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://jp.linkedin.com/in/zebangchen" title="LinkedIn" target="_blank">LinkedIn</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://portal.qiniu.com" title="Qiniu" target="_blank">Qiniu</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Plusaber</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'plusaber';
      var disqus_identifier = 'page/6/index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  

  

  


</body>
</html>
