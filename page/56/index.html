<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="google88d81a02a91db82f" />










  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Plusaber&apos;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Plusaber's Blog">
<meta property="og:url" content="http://yoursite.com/page/56/index.html">
<meta property="og:site_name" content="Plusaber's Blog">
<meta property="og:description" content="Plusaber&apos;s Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Plusaber's Blog">
<meta name="twitter:description" content="Plusaber&apos;s Blog">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/56/"/>


  <title> Plusaber's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-hk">

  


<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-79158075-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Plusaber's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/26/Design Pattern_Proxy pattern/" itemprop="url">
                  Proxy pattern
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-05-26T00:00:00+09:00" content="2015-05-26">
              2015-05-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Design-Pattern/" itemprop="url" rel="index">
                    <span itemprop="name">Design Pattern</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/26/Design Pattern_Proxy pattern/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/26/Design Pattern_Proxy pattern/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Proxy-pattern"><a href="#Proxy-pattern" class="headerlink" title="Proxy pattern"></a>Proxy pattern</h1><p>代理模式为另一个对象提供一个代理对象以控制对这个对象的访问，被代理的对象可以是远程对象、创建开销大的对象或者需要安全控制的对象。</p>
<h2 id="远程代理"><a href="#远程代理" class="headerlink" title="远程代理"></a>远程代理</h2><p>远程代理即是我们希望通过调用一个本地对象，然后其能将每个请求转发到远程对象上进行。换句话说，客户对象意味它调用的是远程服务上的方法，实际上是代理对象假装有客户要调用的方法，真正执行方法的在远程的对象。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_1.png" alt="Design_pattern_proxy_1"></p>
<p>通过Java RMI我们可以简单实现远程调用，而无需处理细节的网络通信。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_2.png" alt="Design_pattern_proxy_2"></p>
<p>使用Java RMI的具体步骤为：</p>
<ol>
<li>创建远程接口</li>
<li>实现远程接口的类Impl（main方法需要注册到RMI中）</li>
<li>使用Java rmic生成Impl的stud和skeleton，也就是客户和服务的辅助类。</li>
<li>在远程机器上启动RMI registry(倾听Impl的注册)</li>
<li>运行主方法(可以是启动类)将Impl注册到RMI服务上。</li>
<li>客户端调用Naming方法取得stub对象。</li>
<li>客户调用哦该stub方法，就像stub就是真正的服务对象一样。</li>
</ol>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_3.png" alt="Design_pattern_proxy_3"></p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_4.png" alt="Design_pattern_proxy_4"></p>
<p>服务端实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GumballMachineRemote</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</div><div class="line">    <span class="keyword">transient</span> GumballMachine gumballMachine;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You inserted a quarter"</span>);</div><div class="line">		gumballMachine.setState(gumballMachine.getHasQuarterState());</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You turned, but there's no quarter"</span>);</div><div class="line">	 &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You need to pay first"</span>);</div><div class="line">	&#125; </div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"waiting for quarter"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span></span></div><div class="line">		<span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">GumballMachineRemote</span> </div><div class="line">&#123;</div><div class="line">	State soldOutState;</div><div class="line">	State noQuarterState;</div><div class="line">	State hasQuarterState;</div><div class="line">	State soldState;</div><div class="line">	State winnerState;</div><div class="line"> </div><div class="line">	State state = soldOutState;</div><div class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"> 	String location;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(String location, <span class="keyword">int</span> numberGumballs)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">		soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</div><div class="line">		noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</div><div class="line">		hasQuarterState = <span class="keyword">new</span> HasQuarterState(<span class="keyword">this</span>);</div><div class="line">		soldState = <span class="keyword">new</span> SoldState(<span class="keyword">this</span>);</div><div class="line">		winnerState = <span class="keyword">new</span> WinnerState(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">		<span class="keyword">this</span>.count = numberGumballs;</div><div class="line"> 		<span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</div><div class="line">			state = noQuarterState;</div><div class="line">		&#125; </div><div class="line">		<span class="keyword">this</span>.location = location;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.insertQuarter();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.ejectQuarter();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.turnCrank();</div><div class="line">		state.dispense();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.state = state;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</div><div class="line">			count = count - <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.count = count;</div><div class="line">		state = noQuarterState;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> count;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> location;</div><div class="line">    &#125;</div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldOutState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> soldOutState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoQuarterState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> noQuarterState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasQuarterState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> hasQuarterState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> soldState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getWinnerState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> winnerState;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</div><div class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</div><div class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004"</span>);</div><div class="line">		result.append(<span class="string">"\nInventory: "</span> + count + <span class="string">" gumball"</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</div><div class="line">			result.append(<span class="string">"s"</span>);</div><div class="line">		&#125;</div><div class="line">		result.append(<span class="string">"\n"</span>);</div><div class="line">		result.append(<span class="string">"Machine is "</span> + state + <span class="string">"\n"</span>);</div><div class="line">		<span class="keyword">return</span> result.toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在RMI registry中注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		GumballMachineRemote gumballMachine = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">int</span> count;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">2</span>) &#123;</div><div class="line">			System.out.println(<span class="string">"GumballMachine &lt;name&gt; &lt;inventory&gt;"</span>);</div><div class="line"> 			System.exit(<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			count = Integer.parseInt(args[<span class="number">1</span>]);</div><div class="line"></div><div class="line">			gumballMachine = </div><div class="line">				<span class="keyword">new</span> GumballMachine(args[<span class="number">0</span>], count);</div><div class="line">			Naming.rebind(<span class="string">"//"</span> + args[<span class="number">0</span>] + <span class="string">"/gumballmachine"</span>, gumballMachine);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitor</span> </span>&#123;</div><div class="line">	GumballMachineRemote machine;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMonitor</span><span class="params">(GumballMachineRemote machine)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.machine = machine;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">report</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			System.out.println(<span class="string">"Gumball Machine: "</span> + machine.getLocation());</div><div class="line">			System.out.println(<span class="string">"Current inventory: "</span> + machine.getCount() + <span class="string">" gumballs"</span>);</div><div class="line">			System.out.println(<span class="string">"Current state: "</span> + machine.getState());</div><div class="line">		&#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitorTestDrive</span> </span>&#123;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		String[] location = &#123;<span class="string">"rmi://santafe.mightygumball.com/gumballmachine"</span>,</div><div class="line">		                     <span class="string">"rmi://boulder.mightygumball.com/gumballmachine"</span>,</div><div class="line">		                     <span class="string">"rmi://seattle.mightygumball.com/gumballmachine"</span>&#125;; </div><div class="line"> </div><div class="line">		GumballMonitor[] monitor = <span class="keyword">new</span> GumballMonitor[location.length];</div><div class="line"> </div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i &lt; location.length; i++) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">           		GumballMachineRemote machine = </div><div class="line">						(GumballMachineRemote) Naming.lookup(location[i]);</div><div class="line">           		monitor[i] = <span class="keyword">new</span> GumballMonitor(machine);</div><div class="line">				System.out.println(monitor[i]);</div><div class="line">        	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            	e.printStackTrace();</div><div class="line">        	&#125;</div><div class="line">		&#125;</div><div class="line"> </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; monitor.length; i++) &#123;</div><div class="line">			monitor[i].report();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="虚拟代理"><a href="#虚拟代理" class="headerlink" title="虚拟代理"></a>虚拟代理</h2><p>远程代理可以作为另一个JVM上对象的本地代表。调用代理的方法，会被代理利用网络转发到远程执行，并且结果会通过网络返回给代理，再有代理将结果转给客户。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_5.png" alt="Design_pattern_proxy_5"></p>
<p>而虚拟代理通常作为创建开销大的对象的代表。虚拟代理经常直到我们真正需要一个对象的时候才创建它。当对象在创建前和创建中时，由虚拟代理来扮演对象的替身。对象创建后，代理就会将请求委托给对象。</p>
<p>比如我们需要创建一个CD封面对象，这个封面图片需要从网上下载。在下外完成前，我们最好也显式一些内容，这时我们就可以使用虚拟代理。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_6.png" alt="Design_pattern_proxy_6"></p>
<ul>
<li>ImageProxy首先创建一个ImageIcon，然后开始从网络上加载图像。</li>
<li>在加载过程中，ImageProxy显式”加载中…”</li>
<li>当图像加载完毕，ImageProxy把所有方法掉用委托给真正的ImageIcon。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageProxy</span> <span class="keyword">implements</span> <span class="title">Icon</span> </span>&#123;</div><div class="line">	ImageIcon imageIcon;</div><div class="line">	URL imageURL;</div><div class="line">	Thread retrievalThread;</div><div class="line">	<span class="keyword">boolean</span> retrieving = <span class="keyword">false</span>;</div><div class="line">     </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ImageProxy</span><span class="params">(URL url)</span> </span>&#123; imageURL = url; &#125;</div><div class="line">     </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIconWidth</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> imageIcon.getIconWidth();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="number">800</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIconHeight</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> imageIcon.getIconHeight();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="number">600</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">     </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paintIcon</span><span class="params">(<span class="keyword">final</span> Component c, Graphics  g, <span class="keyword">int</span> x,  <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</div><div class="line">			imageIcon.paintIcon(c, g, x, y);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			g.drawString(<span class="string">"Loading CD cover, please wait..."</span>, x+<span class="number">300</span>, y+<span class="number">190</span>);</div><div class="line">			<span class="keyword">if</span> (!retrieving) &#123;</div><div class="line">				retrieving = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">				retrievalThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">					<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">						<span class="keyword">try</span> &#123;</div><div class="line">							imageIcon = <span class="keyword">new</span> ImageIcon(imageURL, <span class="string">"CD Cover"</span>);</div><div class="line">							c.repaint();</div><div class="line">						&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">							e.printStackTrace();</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">				&#125;);</div><div class="line">				retrievalThread.start();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageComponent</span> <span class="keyword">extends</span> <span class="title">JComponent</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Icon icon;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ImageComponent</span><span class="params">(Icon icon)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.icon = icon;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIcon</span><span class="params">(Icon icon)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.icon = icon;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paintComponent</span><span class="params">(Graphics g)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.paintComponent(g);</div><div class="line">		<span class="keyword">int</span> w = icon.getIconWidth();</div><div class="line">		<span class="keyword">int</span> h = icon.getIconHeight();</div><div class="line">		<span class="keyword">int</span> x = (<span class="number">800</span> - w)/<span class="number">2</span>;</div><div class="line">		<span class="keyword">int</span> y = (<span class="number">600</span> - h)/<span class="number">2</span>;</div><div class="line">		icon.paintIcon(<span class="keyword">this</span>, g, x, y);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageProxyTestDrive</span> </span>&#123;</div><div class="line">	ImageComponent imageComponent;</div><div class="line">	JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"CD Cover Viewer"</span>);</div><div class="line">    JMenuBar menuBar;</div><div class="line">    JMenu menu;</div><div class="line">	Hashtable cds = <span class="keyword">new</span> Hashtable();</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		ImageProxyTestDrive testDrive = <span class="keyword">new</span> ImageProxyTestDrive();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ImageProxyTestDrive</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</div><div class="line">		cds.put(<span class="string">"Ambient: Music for Airports"</span>,<span class="string">"http://images.amazon.com/images/P/B000003S2K.01.LZZZZZZZ.jpg"</span>);</div><div class="line">        cds.put(<span class="string">"Buddha Bar"</span>,<span class="string">"http://images.amazon.com/images/P/B00009XBYK.01.LZZZZZZZ.jpg"</span>);</div><div class="line">        cds.put(<span class="string">"Ima"</span>,<span class="string">"http://images.amazon.com/images/P/B000005IRM.01.LZZZZZZZ.jpg"</span>);</div><div class="line">        cds.put(<span class="string">"Karma"</span>,<span class="string">"http://images.amazon.com/images/P/B000005DCB.01.LZZZZZZZ.gif"</span>);</div><div class="line">        cds.put(<span class="string">"MCMXC A.D."</span>,<span class="string">"http://images.amazon.com/images/P/B000002URV.01.LZZZZZZZ.jpg"</span>);</div><div class="line">        cds.put(<span class="string">"Northern Exposure"</span>,<span class="string">"http://images.amazon.com/images/P/B000003SFN.01.LZZZZZZZ.jpg"</span>);</div><div class="line">        cds.put(<span class="string">"Selected Ambient Works, Vol. 2"</span>,<span class="string">"http://images.amazon.com/images/P/B000002MNZ.01.LZZZZZZZ.jpg"</span>);</div><div class="line"></div><div class="line">		URL initialURL = <span class="keyword">new</span> URL((String)cds.get(<span class="string">"Selected Ambient Works, Vol. 2"</span>));</div><div class="line">		menuBar = <span class="keyword">new</span> JMenuBar();</div><div class="line">		menu = <span class="keyword">new</span> JMenu(<span class="string">"Favorite CDs"</span>);</div><div class="line">        menuBar.add(menu);</div><div class="line">        frame.setJMenuBar(menuBar);</div><div class="line"></div><div class="line">		<span class="keyword">for</span>(Enumeration e = cds.keys(); e.hasMoreElements();) &#123;</div><div class="line">			String name = (String)e.nextElement();</div><div class="line">        	JMenuItem menuItem = <span class="keyword">new</span> JMenuItem(name);</div><div class="line">        	menu.add(menuItem); </div><div class="line">        	menuItem.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</div><div class="line">          		  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>&#123;</div><div class="line">           		     imageComponent.setIcon(<span class="keyword">new</span> ImageProxy(getCDUrl(event.getActionCommand())));</div><div class="line">					frame.repaint();</div><div class="line">           	      &#125;</div><div class="line">        	&#125;);</div><div class="line">		&#125;</div><div class="line"> 		</div><div class="line">		<span class="comment">// set up frame and menus</span></div><div class="line"> </div><div class="line">		Icon icon = <span class="keyword">new</span> ImageProxy(initialURL);</div><div class="line">		imageComponent = <span class="keyword">new</span> ImageComponent(icon);</div><div class="line">		frame.getContentPane().add(imageComponent);</div><div class="line">		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">		frame.setSize(<span class="number">800</span>,<span class="number">600</span>);</div><div class="line">		frame.setVisible(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function">URL <span class="title">getCDUrl</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">new</span> URL((String)cds.get(name));</div><div class="line">		&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用Java-API代理实现保护代理"><a href="#使用Java-API代理实现保护代理" class="headerlink" title="使用Java API代理实现保护代理"></a>使用Java API代理实现保护代理</h2><p>Java在java.lang.reflect包中有自己的代理支持，利用哦该这个包我们可以在运行时动态的创建一个代理类，实现一个或多个接口，并将方法的调用转发到我们所指定的类。因为实际的代理是在运行时创建的，所以这个技术称为动态代理。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_proxy_7.png" alt="Design_pattern_proxy_7"></p>
<p>我们不需要自己创建Proxy类，也不能往里面添加代码。我们希望处理代码应该放在InvocationHandler中。InvocationHandler的工作是响应代理的任何调用，可以认为是代理收到方法调用后实际执行请求的对象。</p>
<p>假设我们正在实现一个信息管理服务，我们希望当前用户可以更改自己的基本信息，但不是不能更改自己的客观信息，同时其他用户也不能更改当前用户的基本信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonBean</span> </span>&#123;</div><div class="line"> </div><div class="line">	<span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">String <span class="title">getGender</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">String <span class="title">getInterests</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getHotOrNotRating</span><span class="params">()</span></span>;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setInterests</span><span class="params">(String interests)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setHotOrNotRating</span><span class="params">(<span class="keyword">int</span> rating)</span></span>; </div><div class="line"> </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonBeanImpl</span> <span class="keyword">implements</span> <span class="title">PersonBean</span> </span>&#123;</div><div class="line">	String name;</div><div class="line">	String gender;</div><div class="line">	String interests;</div><div class="line">	<span class="keyword">int</span> rating;</div><div class="line">	<span class="keyword">int</span> ratingCount = <span class="number">0</span>;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;	</div><div class="line">	&#125; </div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> gender;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getInterests</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> interests;</div><div class="line">	&#125;</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHotOrNotRating</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (ratingCount == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">return</span> (rating/ratingCount);</div><div class="line">	&#125;</div><div class="line">  </div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.gender = gender;</div><div class="line">	&#125; </div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInterests</span><span class="params">(String interests)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.interests = interests;</div><div class="line">	&#125; </div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHotOrNotRating</span><span class="params">(<span class="keyword">int</span> rating)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.rating += rating;	</div><div class="line">		ratingCount++;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这时我们可以为PersonBean创建动态代理，以过滤对这个类的请求：</p>
<ol>
<li>创建InvocationHandler(如果有多种模式，需要创建多个，这里我们分为两类，操作用户是用户本人或是其他人，所以需要两个InvocationHandler)。</li>
<li>写代码创建动态代理。</li>
<li>利用适当的代理保证PersonBean对象，并将这个代理提供给客户，而不是对象本身。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OwnerInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123; </div><div class="line">	PersonBean person;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OwnerInvocationHandler</span><span class="params">(PersonBean person)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.person = person;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span></div><div class="line">			<span class="keyword">throws</span> IllegalAccessException &#123;</div><div class="line">  </div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (method.getName().startsWith(<span class="string">"get"</span>)) &#123;</div><div class="line">				<span class="keyword">return</span> method.invoke(person, args);</div><div class="line">   			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().equals(<span class="string">"setHotOrNotRating"</span>)) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException();</div><div class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().startsWith(<span class="string">"set"</span>)) &#123;</div><div class="line">				<span class="keyword">return</span> method.invoke(person, args);</div><div class="line">			&#125; </div><div class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; </div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonOwnerInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123; </div><div class="line">	PersonBean person;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">NonOwnerInvocationHandler</span><span class="params">(PersonBean person)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.person = person;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span></div><div class="line">			<span class="keyword">throws</span> IllegalAccessException &#123;</div><div class="line">  </div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (method.getName().startsWith(<span class="string">"get"</span>)) &#123;</div><div class="line">				<span class="keyword">return</span> method.invoke(person, args);</div><div class="line">   			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().equals(<span class="string">"setHotOrNotRating"</span>)) &#123;</div><div class="line">				<span class="keyword">return</span> method.invoke(person, args);</div><div class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.getName().startsWith(<span class="string">"set"</span>)) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException();</div><div class="line">			&#125; </div><div class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; </div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchMakingTestDrive</span> </span>&#123;</div><div class="line">	Hashtable datingDB = <span class="keyword">new</span> Hashtable();</div><div class="line"> 	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		MatchMakingTestDrive test = <span class="keyword">new</span> MatchMakingTestDrive();</div><div class="line">		test.drive();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MatchMakingTestDrive</span><span class="params">()</span> </span>&#123;</div><div class="line">		initializeDatabase();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drive</span><span class="params">()</span> </span>&#123;</div><div class="line">		PersonBean joe = getPersonFromDatabase(<span class="string">"Joe Javabean"</span>); </div><div class="line">		PersonBean ownerProxy = getOwnerProxy(joe);</div><div class="line">		System.out.println(<span class="string">"Name is "</span> + ownerProxy.getName());</div><div class="line">		ownerProxy.setInterests(<span class="string">"bowling, Go"</span>);</div><div class="line">		System.out.println(<span class="string">"Interests set from owner proxy"</span>);</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			ownerProxy.setHotOrNotRating(<span class="number">10</span>);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			System.out.println(<span class="string">"Can't set rating from owner proxy"</span>);</div><div class="line">		&#125;</div><div class="line">		System.out.println(<span class="string">"Rating is "</span> + ownerProxy.getHotOrNotRating());</div><div class="line"></div><div class="line">		PersonBean nonOwnerProxy = getNonOwnerProxy(joe);</div><div class="line">		System.out.println(<span class="string">"Name is "</span> + nonOwnerProxy.getName());</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			nonOwnerProxy.setInterests(<span class="string">"bowling, Go"</span>);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			System.out.println(<span class="string">"Can't set interests from non owner proxy"</span>);</div><div class="line">		&#125;</div><div class="line">		nonOwnerProxy.setHotOrNotRating(<span class="number">3</span>);</div><div class="line">		System.out.println(<span class="string">"Rating set from non owner proxy"</span>);</div><div class="line">		System.out.println(<span class="string">"Rating is "</span> + nonOwnerProxy.getHotOrNotRating());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function">PersonBean <span class="title">getOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</div><div class="line"> 		</div><div class="line">        <span class="keyword">return</span> (PersonBean) Proxy.newProxyInstance( </div><div class="line">            	person.getClass().getClassLoader(),</div><div class="line">            	person.getClass().getInterfaces(),</div><div class="line">                <span class="keyword">new</span> OwnerInvocationHandler(person));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 获得这个对象的代理对象</span></div><div class="line">	<span class="function">PersonBean <span class="title">getNonOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</div><div class="line">		</div><div class="line">        <span class="keyword">return</span> (PersonBean) Proxy.newProxyInstance(</div><div class="line">            	person.getClass().getClassLoader(),</div><div class="line">            	person.getClass().getInterfaces(),</div><div class="line">                <span class="keyword">new</span> NonOwnerInvocationHandler(person));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function">PersonBean <span class="title">getPersonFromDatabase</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> (PersonBean)datingDB.get(name);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initializeDatabase</span><span class="params">()</span> </span>&#123;</div><div class="line">		PersonBean joe = <span class="keyword">new</span> PersonBeanImpl();</div><div class="line">		joe.setName(<span class="string">"Joe Javabean"</span>);</div><div class="line">		joe.setInterests(<span class="string">"cars, computers, music"</span>);</div><div class="line">		joe.setHotOrNotRating(<span class="number">7</span>);</div><div class="line">		datingDB.put(joe.getName(), joe);</div><div class="line"></div><div class="line">		PersonBean kelly = <span class="keyword">new</span> PersonBeanImpl();</div><div class="line">		kelly.setName(<span class="string">"Kelly Klosure"</span>);</div><div class="line">		kelly.setInterests(<span class="string">"ebay, movies, music"</span>);</div><div class="line">		kelly.setHotOrNotRating(<span class="number">6</span>);</div><div class="line">		datingDB.put(kelly.getName(), kelly);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/17/WebService_Big Web Services/" itemprop="url">
                  Big Web Services with Java
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-05-17T00:00:00+09:00" content="2015-05-17">
              2015-05-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/WebService/" itemprop="url" rel="index">
                    <span itemprop="name">WebService</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/17/WebService_Big Web Services/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/17/WebService_Big Web Services/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Web services就是客户端通过HTTP协议向server发送请求，并获得所需要的信息或服务。Web services可以看做一种处于不同机器不同平台上的软件进行交互的一种标准方式。</p>
<p>目前主要有两种类型的Web services：<br>一种是所谓的big web services，因为其相对于第二种方式比较重量级。big web services使用XML封装请求信息以及回答，按照Simple Object Asscess Protocol，所以也称为SOAP消息，提供方法信息和作用域信息，另外使用的一项技术是WSDL(web service description language)，web服务描述语言，是一套用于描述SOAP WEB服务的XML词汇。客户端可以通过参考WSDL文档，可以确切的知道可以调用哪些RPC式方法，需要哪些参数，以及返回值数据类型。SOAP的服务都发布有WSDL文档，否则很难使用。对于很多程序语言，WSDL也是用来自动生成客户端stub必须的文档。</p>
<p>另一种是RESTful webservice，具体两种实现的区别请参考Web Service的<a href="">Programmable Web及其分类</a>。这里主要介绍基于java实现big web service.</p>
<h2 id="Big-web-service的基本技术"><a href="#Big-web-service的基本技术" class="headerlink" title="Big web service的基本技术"></a>Big web service的基本技术</h2><h3 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h3><p>SOAP是Web Service的基本通信协议，是一种规范，用来定义SOAP消息的XML格式（XMLFormat）。包含在一对 SOAP 元素（SOAPElements）中的、结构正确的 XML 段就是 SOAP 消息。<br>SOAP 规范还介绍了如何将程序数据表示为 XML，以及如何使用 SOAP 进行远程过程调用 （RPC）。<br>最后SOAP规范还定义了HTTP消息是怎样传输SOAP消息的。这并不代表SOAP只能用HTTP来作为传输协议，MSMQ、SMTP、TCP/IP都可以做SOAP的传输协议。</p>
<h3 id="WSDL"><a href="#WSDL" class="headerlink" title="WSDL"></a>WSDL</h3><p>Web Services Description Language的缩写，是一个用来描述Web服务和说明如何与Web服务通信的XML语言。WSDL是Web Service的描述语言，用于描述Web Service的服务，接口绑定等，为用户提供详细的接口说明书。<br>举个例子，你要使用供应商的WebService构建应用程序。你可以向供应商索取使用Web Service的范例，然后按照范例来构建应用程序。这样可能出现意料不到的错误，比如说，你在程序中使用的客户代码的数据类型是integer，而供应商使用的数据类型是string。WSDL详细定义客户端消息的格式，需要什么样的参数，这样可以避免不必要的错误。<br>要查看 WSDL 的值，可以假设您要调用由您的一位业务伙伴提供的 SOAP 方法。您可以要求对方提供一些 SOAP 消息示例，然后编写您的应用程序以生成并使用与示例类似的消息。WSDL 通过明确的表示法指定请求消息必须包含的内容以及响应消息的样式。<br>WSDL 文件用于说明消息格式的表示法以 XML 架构标准为基础，这意味着它与编程语言无关，而且以标准为基础，因此适用于说明可从不同平台、以不同编程语言访问的 XML Web Service 接口。除说明消息内容外，WSDL 还定义了服务的位置，以及使用什么通信协议与服务进行通信。WSDL 文件定义了编写使用 XML Web Service 的程序所需的全部内容。</p>
<p>Google搜索服务的WSDL文档片断：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doGoogleSearch"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">message</span>=<span class="string">"typens:doGoogleSearch"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">output</span> <span class="attr">message</span>=<span class="string">"typens:doGoogleSearchRespnse"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div></pre></td></tr></table></figure>
<p>一个SOAP RPC调用的HTTP请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">POST search/beta2 HTTP/1.1</div><div class="line">Host:...</div><div class="line">...</div><div class="line"></div><div class="line">&lt;?xml version="1.0"...&gt;</div><div class="line">&lt;soap:Envelop xmln:soap="UTF-8"&gt;</div><div class="line">	&lt;soap:body&gt;</div><div class="line">		&lt;gs:doGoogleSearch&gt;</div><div class="line">			&lt;q&gt;plusaber&lt;/q&gt;</div><div class="line">		&lt;/gs:doGoogleSearch&gt;</div><div class="line">	&lt;/soap:Body&gt;</div><div class="line">&lt;/soap:Envelope&gt;</div></pre></td></tr></table></figure>
<h3 id="UDDI"><a href="#UDDI" class="headerlink" title="UDDI"></a>UDDI</h3><p>UniversalDescription Discovery and Integration即统一描述、发现和集成协议。UDDI实现了一组可公开访问的接口，通过这些接口，网络服务可以向服务信息库注册其服务信息、服务需求者可以找到分散在世界各地的网络服务。<br>UDDI 目录条目是介绍所提供的业务和服务的 XML 文件。可以把它比喻成电话本，电话本里记录的是电话信息，而UDDI记录的是Web Service信息。你可以不把Web Service注册到UDDI。但如果要让全球的人知道你的Web Service，最好还是注册到UDDI。<br>UDDI 目录还包含若干种方法，可用于搜索构建您的应用程序所需的服务。例如，您可以搜索特定地理位置的服务提供商或者搜索特定的业务类型。之后，UDDI 目录将提供信息、联系方式、链接和技术数据，以便您确定能满足需要的服务。<br>UDDI 允许您查找提供所需的Web 服务的公司。如果您已经知道要与谁进行业务合作，但尚不了解它还能提供哪些服务，这时该如何处理呢？WS-Inspection规范允许您浏览特定服务器上提供的 XML Web Service 的集合，从中查找所需的服务。</p>
<h2 id="Big-Web-Service的Java实现"><a href="#Big-Web-Service的Java实现" class="headerlink" title="Big Web Service的Java实现"></a>Big Web Service的Java实现</h2><p>Web Service本质是一种标准，具体每种语言都提供了不同的实现。在Java领域，Big Web Service的标准是JAX-WS，实现框架有：<a href="http://cxf.apache.org/docs/a-simple-jax-ws-service.html" target="_blank" rel="external">CXF</a>, axis2, Java 6开始自带的Web Service引擎(自带的<a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnayl.html" target="_blank" rel="external">JAX-WS implementation</a>)。</p>
<h3 id="JAX-WS的不同实现框架"><a href="#JAX-WS的不同实现框架" class="headerlink" title="JAX-WS的不同实现框架"></a>JAX-WS的不同实现框架</h3><p>这里先说明一下为什么存在这些不同的实现框架，特别是Java 6开始自带的Web Service引擎与其他更复杂的框架，参考<a href="http://stackoverflow.com/questions/11566609/difference-between-jax-ws-axis2-cxf" target="_blank" rel="external">Difference between Jax-ws, axis2, cxf</a>：<br>The JAX-WS implementation built into the JDK really is just the basic soap stuff. If you need any of the more complex WS-* things like WS-Security, WS-RM, WS-Policy, etc…, you need to use one of the alternatives like CXF or Metro or Axis2. It can also depend on what you are trying to integrate with. For example, CXF has top notch Spring support as well as very good OSGi support.</p>
<p>CXF also has other things besides just JAX-WS. It has a compliant JAX-RS implementation as well and supports exposing services as both REST and SOAP very well. Has a W3C compliant SOAP/JMS implementation if that type of things is required. Basically, lots of stuff not available from the in-jdk JAX-WS impl.</p>
<p>Also see:<br><a href="http://stackoverflow.com/questions/1243247/difference-between-apache-cxf-and-axis/1245386#1245386" target="_blank" rel="external">Difference between Apache CXF and Axis</a></p>
<p>也就是Java自带的Web Service引擎提供了SOAP通信的服务，但是不支持更高级的需求，比如Web Service安全性，与Spring结合等。</p>
<h3 id="创建和使用Web-Service基本步骤"><a href="#创建和使用Web-Service基本步骤" class="headerlink" title="创建和使用Web Service基本步骤"></a>创建和使用Web Service基本步骤</h3><ol>
<li>编写服务的接口</li>
<li>编写服务接口的实现类</li>
<li>发布</li>
<li>测试或使用</li>
</ol>
<h3 id="使用JAX-WS-Java自带-实现第一个Web-Service"><a href="#使用JAX-WS-Java自带-实现第一个Web-Service" class="headerlink" title="使用JAX-WS(Java自带)实现第一个Web Service"></a>使用JAX-WS(Java自带)实现第一个Web Service</h3><p>项目结构如下：</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/WebService_1.png" alt="WebService_1"></p>
<ul>
<li><strong>编写服务接口HelloWorld</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> jws;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.jws.WebParam;</div><div class="line"><span class="keyword">import</span> javax.jws.WebService;</div><div class="line"></div><div class="line"><span class="meta">@WebService</span>  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloWorld</span> </span>&#123;  </div><div class="line">     </div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(@WebParam(name=<span class="string">"who"</span>)</span> String who)</span>;  </div><div class="line">     </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意<code>@WebService</code>是必须要有的，用于指定这是一个Web Service服务类。</p>
<p>另外要暴露给客户端的方法需要注明为@WebMethod。<code>@WebMethod</code>是用来标注在WebService的方法即操作上的，通过它我们可以指定某一个操作的操作名、使用SOAP绑定时的Action名称，以及该方法是否允许发布为WebService。<code>@WebMethod</code>有三个属性：operationName、action和exclude。如果接口中方法不希望作为WebService访问的时候就可以通过<code>@WebMethod</code>来指定将其排除在外(<code>@WebMethod(exclude=true)</code>)。</p>
<p><code>@Oneway</code>是标注在Service接口的操作方法上的。使用<code>@Oneway</code>标注的方法表示它不需要等待服务端的返回，也不需要预留资源来处理服务端的返回。</p>
<p>因为接口在被编译为class文件的时候不能保存参数名，有时候这会影响可读性。如果需要参数名显示的可读性强一些的话，我们可以使用<code>@WebParam</code>来指定。</p>
<ul>
<li><strong>编写服务接口HelloWorld实现类</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> jws;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.jws.WebMethod;</div><div class="line"><span class="keyword">import</span> javax.jws.WebService;</div><div class="line"></div><div class="line"><span class="comment">// endpointInterface用于指定实现的接口</span></div><div class="line"><span class="comment">// 同时也设定了服务的targetName和name，后面client定位这个服务时需要用到</span></div><div class="line"></div><div class="line"><span class="meta">@WebService</span>(endpointInterface = <span class="string">"jws.HelloWorld"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldImpl</span> <span class="keyword">implements</span> <span class="title">HelloWorld</span> </span>&#123; </div><div class="line">	     </div><div class="line">	   <span class="meta">@Override</span>  </div><div class="line">	   <span class="meta">@WebMethod</span>(exclude=<span class="keyword">true</span>)  </div><div class="line">	   <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String who)</span> </span>&#123;  </div><div class="line">	      <span class="keyword">return</span><span class="string">"Hello, "</span> + who;  </div><div class="line">	   &#125;  </div><div class="line">	   </div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/13417454/javax-xml-ws-webserviceexception-undefined-port-type-java-struts-soap-wsdl" target="_blank" rel="external">javax.xml.ws.WebServiceException: Undefined port type Java Struts SOAP WSDL</a></p>
<ul>
<li><strong>发布服务</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> jws;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.xml.ws.Endpoint;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerTest</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deployService</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Server start ……"</span>);</div><div class="line">        HelloWorld service = <span class="keyword">new</span> HelloWorldImpl();</div><div class="line">        String address = <span class="string">"http://localhost:9999/ws/hello"</span>;</div><div class="line">        Endpoint.publish(address, service);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        deployService();</div><div class="line">        System.out.println(<span class="string">"server ready ……"</span>);</div><div class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">60</span>);</div><div class="line">        System.out.println(<span class="string">"server exiting"</span>);</div><div class="line">        System.exit(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>(可跳过)验证服务</strong></li>
</ul>
<p>打开浏览器，输入<code>http://localhost:9999/ws/hello?wsdl</code>，可以验证服务的WSDL文件(mac的safari不显示，可以用Chrome验证)。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--</span></div><div class="line"> Published by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e. </div><div class="line">--&gt;</div><div class="line"><span class="comment">&lt;!--</span></div><div class="line"> Generated by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e. </div><div class="line">--&gt;</div><div class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns:wsu</span>=<span class="string">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span> <span class="attr">xmlns:wsp</span>=<span class="string">"http://www.w3.org/ns/ws-policy"</span> <span class="attr">xmlns:wsp1_2</span>=<span class="string">"http://schemas.xmlsoap.org/ws/2004/09/policy"</span> <span class="attr">xmlns:wsam</span>=<span class="string">"http://www.w3.org/2007/05/addressing/metadata"</span> <span class="attr">xmlns:soap</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/soap/"</span> <span class="attr">xmlns:tns</span>=<span class="string">"http://jws/"</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span> <span class="attr">xmlns</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/"</span> <span class="attr">targetNamespace</span>=<span class="string">"http://jws/"</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplService"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">types</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xsd:schema</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">"http://jws/"</span> <span class="attr">schemaLocation</span>=<span class="string">"http://localhost:9999/ws/hello?xsd=1"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">types</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHello"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHello"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHelloResponse"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHelloResponse"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">portType</span> <span class="attr">name</span>=<span class="string">"HelloWorld"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHello"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://jws/HelloWorld/sayHelloRequest"</span> <span class="attr">message</span>=<span class="string">"tns:sayHello"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://jws/HelloWorld/sayHelloResponse"</span> <span class="attr">message</span>=<span class="string">"tns:sayHelloResponse"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">portType</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplPortBinding"</span> <span class="attr">type</span>=<span class="string">"tns:HelloWorld"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">soap:binding</span> <span class="attr">transport</span>=<span class="string">"http://schemas.xmlsoap.org/soap/http"</span> <span class="attr">style</span>=<span class="string">"document"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHello"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">binding</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplService"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">port</span> <span class="attr">name</span>=<span class="string">"HelloWorldImplPort"</span> <span class="attr">binding</span>=<span class="string">"tns:HelloWorldImplPortBinding"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">soap:address</span> <span class="attr">location</span>=<span class="string">"http://localhost:9999/ws/hello"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">port</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>编写客户端，调用服务</strong></li>
</ul>
<p>需要利用工具类生成并导入服务的接口类<code>HelloWorld</code>。</p>
<p>method 1: 使用Eclipse工具生成<br>method 2: 通过cxf的命令生成客户端代码。<br>进入apache-cxf-2.3.1\bin所在目录，输入命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wsdl2java -p com.jaxb.client <span class="_">-d</span> . http://localhost:9999/ws/hello?wsdl</div></pre></td></tr></table></figure>
<p>命令格式为：<code>wsdl2java –p 包名 –d 生成代码存放目录 wsdl的url</code></p>
<p>wsdl2java用法：</p>
<table>
<thead>
<tr>
<th>param</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>-p</td>
<td>指定其wsdl的命名空间，也就是要生成代码的包名；</td>
</tr>
<tr>
<td>-d</td>
<td>指定要产生代码所在目录；</td>
</tr>
<tr>
<td>-client</td>
<td>生成客户端测试web service的代码；</td>
</tr>
<tr>
<td>-server</td>
<td>生成服务器启动web service的代码；</td>
</tr>
<tr>
<td>-impl</td>
<td>生成web service的实现代码；</td>
</tr>
<tr>
<td>-ant</td>
<td>生成build.xml文件；</td>
</tr>
<tr>
<td>-all</td>
<td>生成所有开始端点代码：types,serviceproxy, service interface, server mainline, client mainline, implementation object,and an Ant build.xml file。</td>
</tr>
</tbody>
</table>
<p>另外还需要知道服务wsdl文件中的targetNamespace和name用于定位服务。</p>
<p><code>targetNamespace=&quot;http://jws/&quot; 
name=&quot;HelloWorldImplService</code></p>
<p>将生成代码拷贝到client代码目录下或导入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> client;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.net.MalformedURLException;</div><div class="line"><span class="keyword">import</span> java.net.URL;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.xml.namespace.QName;</div><div class="line"><span class="keyword">import</span> javax.xml.ws.Service;</div><div class="line"></div><div class="line"><span class="keyword">import</span> jws.HelloWorld;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		URL url = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            url = <span class="keyword">new</span> URL(<span class="string">"http://localhost:9999/ws/hello?wsdl"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</div><div class="line">            java.util.logging.Logger.getLogger(HelloWorld.class.getName())</div><div class="line">                .log(java.util.logging.Level.INFO, </div><div class="line">                     <span class="string">"Can not initialize the default wsdl from &#123;0&#125;"</span>, <span class="string">"http://localhost:9000/helloWorld?wsdl"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        QName qname = <span class="keyword">new</span> QName(<span class="string">"http://jws/"</span>, <span class="string">"HelloWorldImplService"</span>);</div><div class="line">        </div><div class="line">        Service service = Service.create(url, qname);</div><div class="line">        </div><div class="line">        HelloWorld hw = service.getPort(HelloWorld.class);</div><div class="line">        System.out.println(hw.sayHello(<span class="string">"World"</span>));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hello, World</div></pre></td></tr></table></figure>
<p>上面是基本的基于Java 6开始自带的Web Service引擎的helloworld实现，没有使用任何其他包，例如CFX。</p>
<h2 id="HelloWrold基于CXF的实现"><a href="#HelloWrold基于CXF的实现" class="headerlink" title="HelloWrold基于CXF的实现"></a>HelloWrold基于CXF的实现</h2><p>基本流程和上面一致。</p>
<p>使用CXF的JaxWsServerFactoryBean类进行发布。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">HelloServiceImpl impl = <span class="keyword">new</span> HelloServiceImpl();</div><div class="line">JaxWsServerFactoryBean factoryBean = newJaxWsServerFactoryBean();</div><div class="line">factoryBean.setAddress(<span class="string">"http://localhost:8080/WSCXF/helloService"</span>);</div><div class="line">factoryBean.setServiceClass(IHelloService.class);<span class="comment">//接口类</span></div><div class="line">factoryBean.setServiceBean(impl);</div><div class="line">factoryBean.create();</div><div class="line">System.out.println(<span class="string">"WS发布成功！"</span>);</div></pre></td></tr></table></figure>
<p>这两种方法都是将服务发布到Jetty下。另外还可以利用cxf和spring整合在tomcat下进行发布。</p>
<p>客户端使用cxf的调用服务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">JaxWsProxyFactoryBean soapFactoryBean = newJaxWsProxyFactoryBean();</div><div class="line">soapFactoryBean.setAddress(<span class="string">"http://localhost:8080/WSCXF/helloService"</span>);</div><div class="line">soapFactoryBean.setServiceClass(IHelloService.class);</div><div class="line">Object o = soapFactoryBean.create();</div><div class="line">IHelloService helloService = (IHelloService)o;</div></pre></td></tr></table></figure>
<p>可以看出Big web service的生成发布以及调用过程都是基本一致的，只是在各个步骤可以使用不同的框架和实现，不同框架提供了不同程度的安全性，整合等支持。</p>
<h2 id="CXF和Spring整合"><a href="#CXF和Spring整合" class="headerlink" title="CXF和Spring整合"></a>CXF和Spring整合</h2><p>参考<a href="http://www.mkyong.com/webservices/jax-ws/jax-ws-hello-world-example-document-style/" target="_blank" rel="external">JAX-WS Hello World Example – Document Style</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/16/WebService_Programmable Web及其分类/" itemprop="url">
                  REST_Programmable Web及其分类
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-05-16T00:00:00+09:00" content="2015-05-16">
              2015-05-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/WebService/" itemprop="url" rel="index">
                    <span itemprop="name">WebService</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/16/WebService_Programmable Web及其分类/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/16/WebService_Programmable Web及其分类/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Programmable-Web及其分类"><a href="#Programmable-Web及其分类" class="headerlink" title="Programmable Web及其分类"></a>Programmable Web及其分类</h1><p>在编写计算机程序时，我们经常需要使用第三方库中的算法。但是有时我们需要获得由数据驱动的而且数据无法容易获得的服务，这时我们需要依赖于programmable web。这里programmable web是跟human web相对的。human web指的是传统的面向人类使用的web，如人们浏览的网站返回HTML文档显式供人类查看，而programmable web指的是面向计算机程序使用的web，比如web服务等，一般返回更加规则的结果，如XML文档，JSON文档等作为程序的输入。本质上programmable web在工作方式上跟human web是一致的，都是发送请求后，获得所需要的输出或操作。</p>
<p>programmable web是基于HTTP和XML技术的，虽然HTML,JSON等也在使用，但是使用较多的还是XML。</p>
<p>programmable web分类主要是指可以根据调用web服务的方式和形式不同的技术进行分类，如基于RPC(SOAP+WSDL), REST, REST-RPC混合等方式。到这里还是非常的抽象，要对programmable web进行分类，首先来回顾一下programmable web的一些技术。</p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>HTTP是一种基于文档的协议。客户端把文档放在信封里，然后发送给服务器。接收到请求后，服务器解析请求并作为回应，把相应文档放在信封里，然后发送给客户端。HTTP对信封格式有严格标准，但是并不关心信封里面的内容，一般是有客户端或服务端解析。</p>
<p>一个HTTP GET请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">GET /index.html HTTP/1.1</div><div class="line">Host: www.plusaber.net</div><div class="line">User-Ageent: Mozilla/5.0....</div><div class="line">...</div></pre></td></tr></table></figure>
<p>HTTP请求主要有下面几个组成部分：</p>
<p><strong>HTTP方法</strong>：表示客户端希望服务器如何处理该信封。<br><strong>路径</strong>：这里是URI里主机名(hostname)后面的部分。<br><strong>请求报头</strong>：一组key-value pairs，作为元数据。<br><strong>实体主体，也就是文档</strong>，这里GET请求是没有主体的，POST请求会将请求参数放在这里，而GET请求会请求参数以键值对形式直接放在URI中。</p>
<p>HTTP相应也是一个放在信封里的文档，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Fri....</div><div class="line">Server: Aparche...</div><div class="line">......</div><div class="line"></div><div class="line">&lt;!DOCTYPE html...&gt;</div><div class="line">&lt;head&gt;</div><div class="line">...</div><div class="line">&lt;title&gt;Hello, world&lt;/title&gt;</div><div class="line">......</div></pre></td></tr></table></figure>
<p>HTTP响应可分为三个部分：</p>
<p><strong>HTTP响应代码</strong><br><strong>响应报头</strong><br><strong>实体主体</strong></p>
<h2 id="方法信息"><a href="#方法信息" class="headerlink" title="方法信息"></a>方法信息</h2><p>HTTP是Programmable Web上所有服务所共有的。而Web服务之间的差别的形成，是由于在两个问题上的做法有所不同。只要了解一个Web服务器是如何处理这两个问题的，就可以清楚地直到该服务是否跟Web的理念保持一致。</p>
<p><strong>第一个问题是：客户端如何把自己的意图传达给服务器，也就是客户希望进行什么操作，如获取数据、删除数据还是改写数据。</strong>这种关于对数据采取什么操作的信息，称为方法信息(method information)。</p>
<p>RESTful Web Services的方式是把它放在HTTP方法中(HTTP method)，包括主要的GET, HEAD, PUT, DELETE和POST。通过这些方法足以分辨操作类型，标准化的名称是一个很好的优点。</p>
<p>RPC方式是通过提供另外的方法描述提供method information，如在URI中的参数(RPC-REST混合模式)，在SOAP信封中调用WSDS中定义的方法(SOAP-RPC)。而不关注请求时的HTTP method，RPC-REST混合模式中可能总是使用GET，尽管实际的操作可能是DELETE，SOAP-RPC可能总是使用POST(需要包含SOAP信息进行服务调用)，尽管实际的操作可能是PUT。</p>
<p>Google搜索服务的WSDL文档片断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;operation name=&quot;doGoogleSearch&quot;&gt;</div><div class="line">	&lt;input message=&quot;typens:doGoogleSearch&quot;&gt;</div><div class="line">	&lt;output message=&quot;typens:doGoogleSearchRespnse&quot;&gt;</div><div class="line">&lt;/operation&gt;</div></pre></td></tr></table></figure>
<p>一个SOAP RPC调用的HTTP请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">POST search/beta2 HTTP/1.1</div><div class="line">Host:...</div><div class="line">...</div><div class="line"></div><div class="line">&lt;?xml version=&quot;1.0&quot;...&gt;</div><div class="line">&lt;soap:Envelop xmln:soap=&quot;UTF-8&quot;&gt;</div><div class="line">	&lt;soap:body&gt;</div><div class="line">		&lt;gs:doGoogleSearch&gt;</div><div class="line">			&lt;q&gt;plusaber&lt;/q&gt;</div><div class="line">		&lt;/gs:doGoogleSearch&gt;</div><div class="line">	&lt;/soap:Body&gt;</div><div class="line">&lt;/soap:Envelope&gt;</div></pre></td></tr></table></figure>
<p><strong>第二个问题是：客户端如何告诉服务器对哪些数据进行操作。</strong>也就是作用域信息(scoping information)。</p>
<h2 id="作用域信息"><a href="#作用域信息" class="headerlink" title="作用域信息"></a>作用域信息</h2><p>很多Web服务器都把作用域信息放在URI路径里。<br>另一种选择是把作用域信息放在实体主体里，SOAP Web服务通常采用这种方式。</p>
<p>采用了什么样的服务设计，决定了哪些信息属于方法信息，哪些信息属于作用域信息，即使功能相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">请求(GET)  http://flickr.com/photos/tags/penguin</div><div class="line">请求(GET)  http://api.flickr.com/services/rest/?method=flickr.photos.search&amp;tags=penguin</div></pre></td></tr></table></figure>
<p>两者实现的功能相同，请求也都是GET，但是后者在uri参数中制定了调用的方法名flickr.photos.search，令HTTP的GET方法失去了原本用意，也就是实际上的操作并不不受GET或POST影响。前一个例子中Google SOAP API中也是如此，在SOAP信封中制定了调用的方法甚至参数。</p>
<h2 id="相互竞争的服务架构"><a href="#相互竞争的服务架构" class="headerlink" title="相互竞争的服务架构"></a>相互竞争的服务架构</h2><p>不同Web服务会有不同做法，目前主要有三种常见的Web服务架构：REST式架构、RPC式架构和REST-RPC混合架构。</p>
<p>RPC式架构通过一个复杂的、编程语言式的接口，来暴露其内部算法。而ROA则通过一个简单的、文档处理接口，来暴露其内部数据。</p>
<h3 id="REST式、面向资源的机构-Resource-Oriented-Architectures"><a href="#REST式、面向资源的机构-Resource-Oriented-Architectures" class="headerlink" title="REST式、面向资源的机构(Resource-Oriented Architectures)"></a>REST式、面向资源的机构(Resource-Oriented Architectures)</h3><p>REST式架构意味着，方法信息都在HTTP方法里；面向资源的架构(ROA)意味着，作用域信息都在URI里，二者结合起来可以非常强大。一个面向资源的REST式Web服务，通过HTTP请求第一行就能基本了解客户端需要做什么了。如果HTTP方法跟方法信息对不上，那么服务就不算事RESTful的；如果作用域信息不放在URI里，那么服务就不是面向资源的。</p>
<h3 id="RPC式架构-RPC-Style-Architectures"><a href="#RPC式架构-RPC-Style-Architectures" class="headerlink" title="RPC式架构(RPC-Style Architectures)"></a>RPC式架构(RPC-Style Architectures)</h3><p>RPC式Web服务通常从客户端收到一个包括方法信息和作用域信息的信封，然后发回回复信封。一种常用的信封格式是SOAP，进一步封装杂HTTP信封中。SOAP信封内容随着调用方法和参数不同有所变化，但是HTTP信封格式总是不变的，同样的uri，同样的HTTP method(一般总是POST)。SOAP-RPC服务为采用HTTP的很多特性，只暴露一个URI，并且只支持一种HTTP方法(POST方法)。而REST服务为不同的作用域信息暴露不同的URI。</p>
<p>除了SOAP RPC，更宽泛的是XML-RPC，SOAP其实就是基于XML，不过多了一系列规范和相应的技术栈，包括WSDL,UDDI.</p>
<h3 id="REST-RPC混合架构"><a href="#REST-RPC混合架构" class="headerlink" title="REST-RPC混合架构"></a>REST-RPC混合架构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://api.flickr.com/services/rest/?method=flickr.photos.search&amp;tags=penguin</div></pre></td></tr></table></figure>
<p>这里的服务调用将作用域信息放在URI中，有些类似于REST，但是不同的是其将方法信息也放在URI中了，所以本质上是一个RPC式服务，只是将URI当做信封格式来用。</p>
<p>许多只读的Web服务，尽管起初是按照RPC风格设计的，但都可以被认为是完全REST式和面向资源的。但是如果服务允许DELETE等操作的话，就会出现客户端所使用的HTTP方法与正在想执行的操作不一致的情况，就失去了REST的特征，所以称为REST-RPC混合服务。</p>
<h2 id="Programmable-Web涉及的技术"><a href="#Programmable-Web涉及的技术" class="headerlink" title="Programmable Web涉及的技术"></a>Programmable Web涉及的技术</h2><h3 id="HTTP-1"><a href="#HTTP-1" class="headerlink" title="HTTP"></a>HTTP</h3><p>所有Web服务都用HTTP，只是使用方式有所不同。</p>
<h3 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h3><p>同样的，所有Web服务都用HTTP，但使用方式有所不同。一个REST服务为客户端可能操作的每一个数据暴露一个URI；一个REST-RPC混合服务为客户端可行进行的每个操作暴露一个URI；一个RPC服务为每个远程处理暴露一个相同的URI，即服务的端点(endpoint)。</p>
<h3 id="XML-RPC"><a href="#XML-RPC" class="headerlink" title="XML-RPC"></a>XML-RPC</h3><p>用XML表达函数调用及其返回值，专门用于RPC式Web服务，现在已经逐渐被更完善的SOAP技术栈所替代。</p>
<h3 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h3><p>基于XML的信封格式，同样是为RPC提供方法信息和作用域信息。</p>
<h3 id="WSDL"><a href="#WSDL" class="headerlink" title="WSDL"></a>WSDL</h3><p>WSDL(web service description language)，web服务描述语言，是一套用于描述SOAP WEB服务的XML词汇。客户端可以通过参考WSDL文档，可以确切的知道可以调用哪些RPC式方法，需要哪些参数，以及返回值数据类型。SOAP的服务都发布有WSDL文档，否则很难使用。</p>
<h3 id="WADL"><a href="#WADL" class="headerlink" title="WADL"></a>WADL</h3><p>WADL(web applicaiotn description language), web应用描述语言，是一套用于描述REST式服务的XML词汇。提供的功能与WSDL类似，但是由于REST式服务接口比较简单，其必要性没有像WSDL至于SOAP-RPC那么大。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/01/Design Pattern_State pattern/" itemprop="url">
                  State pattern
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-05-01T00:00:00+09:00" content="2015-05-01">
              2015-05-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Design-Pattern/" itemprop="url" rel="index">
                    <span itemprop="name">Design Pattern</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/01/Design Pattern_State pattern/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/05/01/Design Pattern_State pattern/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="State-pattern"><a href="#State-pattern" class="headerlink" title="State pattern"></a>State pattern</h1><h2 id="问题定义"><a href="#问题定义" class="headerlink" title="问题定义"></a>问题定义</h2><p>假设我们需要制造一台糖果机，其操作如下:</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_state_1.png" alt="Design_pattern_state_1"></p>
<p>我们可以分清楚各个状态以及状态的转换，当做一个简单的状态机来实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</div><div class="line"> </div><div class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD_OUT = <span class="number">0</span>;</div><div class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NO_QUARTER = <span class="number">1</span>;</div><div class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> HAS_QUARTER = <span class="number">2</span>;</div><div class="line">	<span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD = <span class="number">3</span>;</div><div class="line"> </div><div class="line">	<span class="keyword">int</span> state = SOLD_OUT;</div><div class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.count = count;</div><div class="line">		<span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</div><div class="line">			state = NO_QUARTER;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (state == HAS_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"You can't insert another quarter"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</div><div class="line">			state = HAS_QUARTER;</div><div class="line">			System.out.println(<span class="string">"You inserted a quarter"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</div><div class="line">			System.out.println(<span class="string">"You can't insert a quarter, the machine is sold out"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</div><div class="line">        	System.out.println(<span class="string">"Please wait, we're already giving you a gumball"</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (state == HAS_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"Quarter returned"</span>);</div><div class="line">			state = NO_QUARTER;</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</div><div class="line">			System.out.println(<span class="string">"Sorry, you already turned the crank"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</div><div class="line">        	System.out.println(<span class="string">"You can't eject, you haven't inserted a quarter yet"</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line"></div><div class="line"> </div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (state == SOLD) &#123;</div><div class="line">			System.out.println(<span class="string">"Turning twice doesn't get you another gumball!"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"You turned but there's no quarter"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</div><div class="line">			System.out.println(<span class="string">"You turned, but there are no gumballs"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"You turned..."</span>);</div><div class="line">			state = SOLD;</div><div class="line">			dispense();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (state == SOLD) &#123;</div><div class="line">			System.out.println(<span class="string">"A gumball comes rolling out the slot"</span>);</div><div class="line">			count = count - <span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</div><div class="line">				System.out.println(<span class="string">"Oops, out of gumballs!"</span>);</div><div class="line">				state = SOLD_OUT;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				state = NO_QUARTER;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"You need to pay first"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</div><div class="line">			System.out.println(<span class="string">"No gumball dispensed"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</div><div class="line">			System.out.println(<span class="string">"No gumball dispensed"</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> numGumBalls)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.count = numGumBalls;</div><div class="line">		state = NO_QUARTER;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</div><div class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</div><div class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004\n"</span>);</div><div class="line">		result.append(<span class="string">"Inventory: "</span> + count + <span class="string">" gumball"</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</div><div class="line">			result.append(<span class="string">"s"</span>);</div><div class="line">		&#125;</div><div class="line">		result.append(<span class="string">"\nMachine is "</span>);</div><div class="line">		<span class="keyword">if</span> (state == SOLD_OUT) &#123;</div><div class="line">			result.append(<span class="string">"sold out"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</div><div class="line">			result.append(<span class="string">"waiting for quarter"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</div><div class="line">			result.append(<span class="string">"waiting for turn of crank"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</div><div class="line">			result.append(<span class="string">"delivering a gumball"</span>);</div><div class="line">		&#125;</div><div class="line">		result.append(<span class="string">"\n"</span>);</div><div class="line">		<span class="keyword">return</span> result.toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		GumballMachine gumballMachine = <span class="keyword">new</span> GumballMachine(<span class="number">5</span>);</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.ejectQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.ejectQuarter();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当需要增加功能时，这份代码将十分难以修改和扩展，比如现在我们需要当曲柄被转动时，有10%的记录掉下两颗糖果。</p>
<p>更好的设计是：</p>
<ol>
<li>定义一个state接口。在这个接口内，糖果机的每个动作都有一个对应的方法。</li>
<li>然后为机器的每个状态实现状态类。这些类将入则在对应状态下进行机器的行为。</li>
<li>将动作委托到状态类。</li>
</ol>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_state_2.png" alt="Design_pattern_state_2"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> </span>&#123;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</div><div class="line">    GumballMachine gumballMachine;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You inserted a quarter"</span>);</div><div class="line">		gumballMachine.setState(gumballMachine.getHasQuarterState());</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You turned, but there's no quarter"</span>);</div><div class="line">	 &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You need to pay first"</span>);</div><div class="line">	&#125; </div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"waiting for quarter"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HasQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</div><div class="line">	GumballMachine gumballMachine;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HasQuarterState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.gumballMachine = gumballMachine;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You can't insert another quarter"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Quarter returned"</span>);</div><div class="line">		gumballMachine.setState(gumballMachine.getNoQuarterState());</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You turned..."</span>);</div><div class="line">		gumballMachine.setState(gumballMachine.getSoldState());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"No gumball dispensed"</span>);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"waiting for turn of crank"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoldState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</div><div class="line"> </div><div class="line">    GumballMachine gumballMachine;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SoldState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</div><div class="line">    &#125;</div><div class="line">       </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Please wait, we're already giving you a gumball"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Sorry, you already turned the crank"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Turning twice doesn't get you another gumball!"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">		gumballMachine.releaseBall();</div><div class="line">		<span class="keyword">if</span> (gumballMachine.getCount() &gt; <span class="number">0</span>) &#123;</div><div class="line">			gumballMachine.setState(gumballMachine.getNoQuarterState());</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			System.out.println(<span class="string">"Oops, out of gumballs!"</span>);</div><div class="line">			gumballMachine.setState(gumballMachine.getSoldOutState());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"dispensing a gumball"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoldOutState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</div><div class="line">    GumballMachine gumballMachine;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SoldOutState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You can't insert a quarter, the machine is sold out"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You can't eject, you haven't inserted a quarter yet"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"You turned, but there are no gumballs"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"No gumball dispensed"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"sold out"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</div><div class="line"> </div><div class="line">	State soldOutState;</div><div class="line">	State noQuarterState;</div><div class="line">	State hasQuarterState;</div><div class="line">	State soldState;</div><div class="line"> </div><div class="line">	State state = soldOutState;</div><div class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> numberGumballs)</span> </span>&#123;</div><div class="line">		soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</div><div class="line">		noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</div><div class="line">		hasQuarterState = <span class="keyword">new</span> HasQuarterState(<span class="keyword">this</span>);</div><div class="line">		soldState = <span class="keyword">new</span> SoldState(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">		<span class="keyword">this</span>.count = numberGumballs;</div><div class="line"> 		<span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</div><div class="line">			state = noQuarterState;</div><div class="line">		&#125; </div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.insertQuarter();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.ejectQuarter();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.turnCrank();</div><div class="line">		state.dispense();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.state = state;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</div><div class="line">			count = count - <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> count;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.count = count;</div><div class="line">		state = noQuarterState;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldOutState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> soldOutState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoQuarterState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> noQuarterState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasQuarterState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> hasQuarterState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> soldState;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</div><div class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</div><div class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004"</span>);</div><div class="line">		result.append(<span class="string">"\nInventory: "</span> + count + <span class="string">" gumball"</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</div><div class="line">			result.append(<span class="string">"s"</span>);</div><div class="line">		&#125;</div><div class="line">		result.append(<span class="string">"\n"</span>);</div><div class="line">		result.append(<span class="string">"Machine is "</span> + state + <span class="string">"\n"</span>);</div><div class="line">		<span class="keyword">return</span> result.toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		GumballMachine gumballMachine = <span class="keyword">new</span> GumballMachine(<span class="number">5</span>);</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="定义状态模式"><a href="#定义状态模式" class="headerlink" title="定义状态模式"></a>定义状态模式</h2><p>状态模式允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它的类。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_state_3.png" alt="Design_pattern_state_3"></p>
<p>状态模式跟策略模式形式上很相似，但是，意图不同！</p>
<p>状态模式将一群行为封装在状态对象中，运行过程中当前状态在状态对象集合中游走改变，但是客户端对于状态对象完全不了解。状态模式一般是用来避免在context中放置许多条件判断的替代方案，以便于扩展。</p>
<p>而策略模式中，通常是客户主动指定所需要的策略对象，以满足所需要的行为。策略模式是除继承之外一种弹性替代方案，可以避免被父类的行为困住，我们可以通过组合不同的对象来改变行为。</p>
<h2 id="解决扩展问题"><a href="#解决扩展问题" class="headerlink" title="解决扩展问题"></a>解决扩展问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</div><div class="line"> </div><div class="line">	State soldOutState;</div><div class="line">	State noQuarterState;</div><div class="line">	State hasQuarterState;</div><div class="line">	State soldState;</div><div class="line">	State winnerState;</div><div class="line"> </div><div class="line">	State state = soldOutState;</div><div class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> numberGumballs)</span> </span>&#123;</div><div class="line">		soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</div><div class="line">		noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</div><div class="line">		hasQuarterState = <span class="keyword">new</span> HasQuarterState(<span class="keyword">this</span>);</div><div class="line">		soldState = <span class="keyword">new</span> SoldState(<span class="keyword">this</span>);</div><div class="line">		winnerState = <span class="keyword">new</span> WinnerState(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">		<span class="keyword">this</span>.count = numberGumballs;</div><div class="line"> 		<span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</div><div class="line">			state = noQuarterState;</div><div class="line">		&#125; </div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.insertQuarter();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.ejectQuarter();</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		state.turnCrank();</div><div class="line">		state.dispense();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.state = state;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</div><div class="line">			count = count - <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> count;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">refill</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.count = count;</div><div class="line">		state = noQuarterState;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldOutState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> soldOutState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoQuarterState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> noQuarterState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasQuarterState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> hasQuarterState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> soldState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getWinnerState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> winnerState;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		StringBuffer result = <span class="keyword">new</span> StringBuffer();</div><div class="line">		result.append(<span class="string">"\nMighty Gumball, Inc."</span>);</div><div class="line">		result.append(<span class="string">"\nJava-enabled Standing Gumball Model #2004"</span>);</div><div class="line">		result.append(<span class="string">"\nInventory: "</span> + count + <span class="string">" gumball"</span>);</div><div class="line">		<span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</div><div class="line">			result.append(<span class="string">"s"</span>);</div><div class="line">		&#125;</div><div class="line">		result.append(<span class="string">"\n"</span>);</div><div class="line">		result.append(<span class="string">"Machine is "</span> + state + <span class="string">"\n"</span>);</div><div class="line">		<span class="keyword">return</span> result.toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WinnerState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</div><div class="line">    GumballMachine gumballMachine;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WinnerState</span><span class="params">(GumballMachine gumballMachine)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gumballMachine = gumballMachine;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Please wait, we're already giving you a Gumball"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Please wait, we're already giving you a Gumball"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Turning again doesn't get you another gumball!"</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"YOU'RE A WINNER! You get two gumballs for your quarter"</span>);</div><div class="line">		gumballMachine.releaseBall();</div><div class="line">		<span class="keyword">if</span> (gumballMachine.getCount() == <span class="number">0</span>) &#123;</div><div class="line">			gumballMachine.setState(gumballMachine.getSoldOutState());</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			gumballMachine.releaseBall();</div><div class="line">			<span class="keyword">if</span> (gumballMachine.getCount() &gt; <span class="number">0</span>) &#123;</div><div class="line">				gumballMachine.setState(gumballMachine.getNoQuarterState());</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">            	System.out.println(<span class="string">"Oops, out of gumballs!"</span>);</div><div class="line">				gumballMachine.setState(gumballMachine.getSoldOutState());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"despensing two gumballs for your quarter, because YOU'RE A WINNER!"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> headfirst.state.gumballstatewinner;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		GumballMachine gumballMachine = </div><div class="line">			<span class="keyword">new</span> GumballMachine(<span class="number">10</span>);</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line"></div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line">		gumballMachine.insertQuarter();</div><div class="line">		gumballMachine.turnCrank();</div><div class="line"></div><div class="line">		System.out.println(gumballMachine);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/17/Design Pattern_Iterator pattern/" itemprop="url">
                  Iterator pattern
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">發表於</span>
            <time itemprop="dateCreated" datetime="2015-04-17T00:00:00+09:00" content="2015-04-17">
              2015-04-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Design-Pattern/" itemprop="url" rel="index">
                    <span itemprop="name">Design Pattern</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/17/Design Pattern_Iterator pattern/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/04/17/Design Pattern_Iterator pattern/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Iterator-pattern"><a href="#Iterator-pattern" class="headerlink" title="Iterator pattern"></a>Iterator pattern</h1><p>假设有两个餐厅，它们各自的菜单组织形式不同。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span> </span>&#123;</div><div class="line">	String name;</div><div class="line">	String description;</div><div class="line">	<span class="keyword">boolean</span> vegetarian;</div><div class="line">	<span class="keyword">double</span> price;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MenuItem</span><span class="params">(String name, </span></span></div><div class="line">	                String description, </div><div class="line">	                <span class="keyword">boolean</span> vegetarian, </div><div class="line">	                <span class="keyword">double</span> price) </div><div class="line">	&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">		<span class="keyword">this</span>.description = description;</div><div class="line">		<span class="keyword">this</span>.vegetarian = vegetarian;</div><div class="line">		<span class="keyword">this</span>.price = price;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> description;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> price;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> vegetarian;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PanackeHouseMenue</span> </span>&#123;</div><div class="line">	ArrayList menuItems;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DinerMenu</span> </span>&#123;</div><div class="line">	MenuItem[] menuItems;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当遍历菜单时，我们需要提供两个方法遍历两种菜单，使系统变得复杂化。如果需要增加一种新的菜单，需要修改前面的很多代码，造成难以维护。</p>
<h2 id="定义迭代器模式"><a href="#定义迭代器模式" class="headerlink" title="定义迭代器模式"></a>定义迭代器模式</h2><p>这里我们可以把遍历封装起来，让每个类提供相同的方法遍历它自己的元素。外部客户只管调用这些方法来遍历，而不必直到内部是如何实现的。且由于所有类都提供同样的遍历方法，降低的复杂性，使得系统容易扩展和修改。</p>
<p>迭代其模式提供一种同一的方法顺序访问一个聚合对象中的各个元素，而由不暴露其内部的表示。把遍历的任务交给迭代器，而不是聚合对象上，这样简化了聚合对象的接口和实现，也满足了单一责任原则：<strong>一个类应该只负责一个职责，并只有一个引起变化的原因。</strong></p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_iterator_1.png" alt="Design_pattern_iterator_1"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">Object <span class="title">next</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DinerMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</div><div class="line">	MenuItem[] items;</div><div class="line">	<span class="keyword">int</span> position = <span class="number">0</span>;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DinerMenuIterator</span><span class="params">(MenuItem[] items)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.items = items;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">		MenuItem menuItem = items[position];</div><div class="line">		position = position + <span class="number">1</span>;</div><div class="line">		<span class="keyword">return</span> menuItem;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (position &gt;= items.length || items[position] == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PancakeHouseMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</div><div class="line">	ArrayList items;</div><div class="line">	<span class="keyword">int</span> position = <span class="number">0</span>;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PancakeHouseMenuIterator</span><span class="params">(ArrayList items)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.items = items;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">		Object object = items.get(position);</div><div class="line">		position = position + <span class="number">1</span>;</div><div class="line">		<span class="keyword">return</span> object;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (position &gt;= items.size()) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DinerMenu</span> <span class="keyword">implements</span> <span class="title">Menu</span> </span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ITEMS = <span class="number">6</span>;</div><div class="line">	<span class="keyword">int</span> numberOfItems = <span class="number">0</span>;</div><div class="line">	MenuItem[] menuItems;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DinerMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		menuItems = <span class="keyword">new</span> MenuItem[MAX_ITEMS];</div><div class="line"> </div><div class="line">		addItem(<span class="string">"Vegetarian BLT"</span>,</div><div class="line">			<span class="string">"(Fakin') Bacon with lettuce &amp; tomato on whole wheat"</span>, <span class="keyword">true</span>, <span class="number">2.99</span>);</div><div class="line">		addItem(<span class="string">"BLT"</span>,</div><div class="line">			<span class="string">"Bacon with lettuce &amp; tomato on whole wheat"</span>, <span class="keyword">false</span>, <span class="number">2.99</span>);</div><div class="line">		addItem(<span class="string">"Soup of the day"</span>,</div><div class="line">			<span class="string">"Soup of the day, with a side of potato salad"</span>, <span class="keyword">false</span>, <span class="number">3.29</span>);</div><div class="line">		addItem(<span class="string">"Hotdog"</span>,</div><div class="line">			<span class="string">"A hot dog, with saurkraut, relish, onions, topped with cheese"</span>,</div><div class="line">			<span class="keyword">false</span>, <span class="number">3.05</span>);</div><div class="line">		addItem(<span class="string">"Steamed Veggies and Brown Rice"</span>,</div><div class="line">			<span class="string">"Steamed vegetables over brown rice"</span>, <span class="keyword">true</span>, <span class="number">3.99</span>);</div><div class="line">		addItem(<span class="string">"Pasta"</span>,</div><div class="line">			<span class="string">"Spaghetti with Marinara Sauce, and a slice of sourdough bread"</span>,</div><div class="line">			<span class="keyword">true</span>, <span class="number">3.89</span>);</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(String name, String description, </span></span></div><div class="line">	                     <span class="keyword">boolean</span> vegetarian, <span class="keyword">double</span> price) </div><div class="line">	&#123;</div><div class="line">		MenuItem menuItem = <span class="keyword">new</span> MenuItem(name, description, vegetarian, price);</div><div class="line">		<span class="keyword">if</span> (numberOfItems &gt;= MAX_ITEMS) &#123;</div><div class="line">			System.err.println(<span class="string">"Sorry, menu is full!  Can't add item to menu"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			menuItems[numberOfItems] = menuItem;</div><div class="line">			numberOfItems = numberOfItems + <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="keyword">public</span> MenuItem[] getMenuItems() &#123;</div><div class="line">		<span class="keyword">return</span> menuItems;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> DinerMenuIterator(menuItems);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="comment">// other menu methods here</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PancakeHouseMenu</span> <span class="keyword">implements</span> <span class="title">Menu</span> </span>&#123;</div><div class="line">	ArrayList menuItems;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PancakeHouseMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		menuItems = <span class="keyword">new</span> ArrayList();</div><div class="line">    </div><div class="line">		addItem(<span class="string">"K&amp;B's Pancake Breakfast"</span>, </div><div class="line">			<span class="string">"Pancakes with scrambled eggs, and toast"</span>, </div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">2.99</span>);</div><div class="line"> </div><div class="line">		addItem(<span class="string">"Regular Pancake Breakfast"</span>, </div><div class="line">			<span class="string">"Pancakes with fried eggs, sausage"</span>, </div><div class="line">			<span class="keyword">false</span>,</div><div class="line">			<span class="number">2.99</span>);</div><div class="line"> </div><div class="line">		addItem(<span class="string">"Blueberry Pancakes"</span>,</div><div class="line">			<span class="string">"Pancakes made with fresh blueberries"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">3.49</span>);</div><div class="line"> </div><div class="line">		addItem(<span class="string">"Waffles"</span>,</div><div class="line">			<span class="string">"Waffles, with your choice of blueberries or strawberries"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">3.59</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(String name, String description,</span></span></div><div class="line">	                    <span class="keyword">boolean</span> vegetarian, <span class="keyword">double</span> price)</div><div class="line">	&#123;</div><div class="line">		MenuItem menuItem = <span class="keyword">new</span> MenuItem(name, description, vegetarian, price);</div><div class="line">		menuItems.add(menuItem);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> ArrayList <span class="title">getMenuItems</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> menuItems;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PancakeHouseMenuIterator(menuItems);</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"Objectville Pancake House Menu"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// other menu methods here</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</div><div class="line">	PancakeHouseMenu pancakeHouseMenu;</div><div class="line">	DinerMenu dinerMenu;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Waitress</span><span class="params">(PancakeHouseMenu pancakeHouseMenu, DinerMenu dinerMenu)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.pancakeHouseMenu = pancakeHouseMenu;</div><div class="line">		<span class="keyword">this</span>.dinerMenu = dinerMenu;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		Iterator pancakeIterator = pancakeHouseMenu.createIterator();</div><div class="line">		Iterator dinerIterator = dinerMenu.createIterator();</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"MENU\n----\nBREAKFAST"</span>);</div><div class="line">		printMenu(pancakeIterator);</div><div class="line">		System.out.println(<span class="string">"\nLUNCH"</span>);</div><div class="line">		printMenu(dinerIterator);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">(Iterator iterator)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuItem menuItem = (MenuItem)iterator.next();</div><div class="line">			System.out.print(menuItem.getName() + <span class="string">", "</span>);</div><div class="line">			System.out.print(menuItem.getPrice() + <span class="string">" -- "</span>);</div><div class="line">			System.out.println(menuItem.getDescription());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printVegetarianMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		printVegetarianMenu(pancakeHouseMenu.createIterator());</div><div class="line">		printVegetarianMenu(dinerMenu.createIterator());</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isItemVegetarian</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		Iterator breakfastIterator = pancakeHouseMenu.createIterator();</div><div class="line">		<span class="keyword">if</span> (isVegetarian(name, breakfastIterator)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		Iterator dinnerIterator = dinerMenu.createIterator();</div><div class="line">		<span class="keyword">if</span> (isVegetarian(name, dinnerIterator)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printVegetarianMenu</span><span class="params">(Iterator iterator)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuItem menuItem = (MenuItem)iterator.next();</div><div class="line">			<span class="keyword">if</span> (menuItem.isVegetarian()) &#123;</div><div class="line">				System.out.print(menuItem.getName());</div><div class="line">				System.out.println(<span class="string">"\t\t"</span> + menuItem.getPrice());</div><div class="line">				System.out.println(<span class="string">"\t"</span> + menuItem.getDescription());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">(String name, Iterator iterator)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuItem menuItem = (MenuItem)iterator.next();</div><div class="line">			<span class="keyword">if</span> (menuItem.getName().equals(name)) &#123;</div><div class="line">				<span class="keyword">if</span> (menuItem.isVegetarian()) &#123;</div><div class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>通过迭代器，我们可以很容易的新增菜单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CafeMenu</span> <span class="keyword">implements</span> <span class="title">Menu</span> </span>&#123;</div><div class="line">	Hashtable menuItems = <span class="keyword">new</span> Hashtable();</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CafeMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		addItem(<span class="string">"Veggie Burger and Air Fries"</span>,</div><div class="line">			<span class="string">"Veggie burger on a whole wheat bun, lettuce, tomato, and fries"</span>,</div><div class="line">			<span class="keyword">true</span>, <span class="number">3.99</span>);</div><div class="line">		addItem(<span class="string">"Soup of the day"</span>,</div><div class="line">			<span class="string">"A cup of the soup of the day, with a side salad"</span>,</div><div class="line">			<span class="keyword">false</span>, <span class="number">3.69</span>);</div><div class="line">		addItem(<span class="string">"Burrito"</span>,</div><div class="line">			<span class="string">"A large burrito, with whole pinto beans, salsa, guacamole"</span>,</div><div class="line">			<span class="keyword">true</span>, <span class="number">4.29</span>);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(String name, String description, </span></span></div><div class="line">	                     <span class="keyword">boolean</span> vegetarian, <span class="keyword">double</span> price) </div><div class="line">	&#123;</div><div class="line">		MenuItem menuItem = <span class="keyword">new</span> MenuItem(name, description, vegetarian, price);</div><div class="line">		menuItems.put(menuItem.getName(), menuItem);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> Hashtable <span class="title">getItems</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> menuItems;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> menuItems.values().iterator();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</div><div class="line">	Menu pancakeHouseMenu;</div><div class="line">	Menu dinerMenu;</div><div class="line">	Menu cafeMenu;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Waitress</span><span class="params">(Menu pancakeHouseMenu, Menu dinerMenu, Menu cafeMenu)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.pancakeHouseMenu = pancakeHouseMenu;</div><div class="line">		<span class="keyword">this</span>.dinerMenu = dinerMenu;</div><div class="line">		<span class="keyword">this</span>.cafeMenu = cafeMenu;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		Iterator pancakeIterator = pancakeHouseMenu.createIterator();</div><div class="line">		Iterator dinerIterator = dinerMenu.createIterator();</div><div class="line">		Iterator cafeIterator = cafeMenu.createIterator();</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"MENU\n----\nBREAKFAST"</span>);</div><div class="line">		printMenu(pancakeIterator);</div><div class="line">		System.out.println(<span class="string">"\nLUNCH"</span>);</div><div class="line">		printMenu(dinerIterator);</div><div class="line">		System.out.println(<span class="string">"\nDINNER"</span>);</div><div class="line">		printMenu(cafeIterator);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">(Iterator iterator)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuItem menuItem = (MenuItem)iterator.next();</div><div class="line">			System.out.print(menuItem.getName() + <span class="string">", "</span>);</div><div class="line">			System.out.print(menuItem.getPrice() + <span class="string">" -- "</span>);</div><div class="line">			System.out.println(menuItem.getDescription());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printVegetarianMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"\nVEGETARIAN MENU\n---------------"</span>);</div><div class="line">		printVegetarianMenu(pancakeHouseMenu.createIterator());</div><div class="line">		printVegetarianMenu(dinerMenu.createIterator());</div><div class="line">		printVegetarianMenu(cafeMenu.createIterator());</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isItemVegetarian</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		Iterator pancakeIterator = pancakeHouseMenu.createIterator();</div><div class="line">		<span class="keyword">if</span> (isVegetarian(name, pancakeIterator)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		Iterator dinerIterator = dinerMenu.createIterator();</div><div class="line">		<span class="keyword">if</span> (isVegetarian(name, dinerIterator)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		Iterator cafeIterator = cafeMenu.createIterator();</div><div class="line">		<span class="keyword">if</span> (isVegetarian(name, cafeIterator)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printVegetarianMenu</span><span class="params">(Iterator iterator)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuItem menuItem = (MenuItem)iterator.next();</div><div class="line">			<span class="keyword">if</span> (menuItem.isVegetarian()) &#123;</div><div class="line">				System.out.print(menuItem.getName() + <span class="string">", "</span>);</div><div class="line">				System.out.print(menuItem.getPrice() + <span class="string">" -- "</span>);</div><div class="line">				System.out.println(menuItem.getDescription());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">(String name, Iterator iterator)</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuItem menuItem = (MenuItem)iterator.next();</div><div class="line">			<span class="keyword">if</span> (menuItem.getName().equals(name)) &#123;</div><div class="line">				<span class="keyword">if</span> (menuItem.isVegetarian()) &#123;</div><div class="line">					<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>目前在菜单增加时，遍历菜单的方法不需要再修改。但是我们需要单独管理这些菜单，而不是能够讲它们也聚合在一起作为一个单独的聚合对象管理，通过使用基类List可以部分改进该，但是我们仍然无法在菜单里增加子菜单，也就是层级模式。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_iterator_2.png" alt="Design_pattern_iterator_2"></p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_iterator_3.png" alt="Design_pattern_iterator_3"></p>
<h1 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h1><p>这时我们可以使用组合模式解决这个难题：</p>
<h2 id="定义组合模式"><a href="#定义组合模式" class="headerlink" title="定义组合模式"></a>定义组合模式</h2><p>组合模式允许我们将组合对象组合成树形结构来表现”整体/部分”层次结构。组合能够让客户以一致的方式处理个别对象以及对象组合。</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_iterator_4.png" alt="Design_pattern_iterator_4"></p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_iterator_5.png" alt="Design_pattern_iterator_5"></p>
<p>这里我们使用组合设计菜单：</p>
<p><img src="http://7xs07u.com1.z0.glb.clouddn.com/Design_pattern_iterator_6.png" alt="Design_pattern_iterator_6"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuComponent</span> </span>&#123;</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</div><div class="line">	String name;</div><div class="line">	String description;</div><div class="line">	<span class="keyword">boolean</span> vegetarian;</div><div class="line">	<span class="keyword">double</span> price;</div><div class="line">    </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MenuItem</span><span class="params">(String name, </span></span></div><div class="line">	                String description, </div><div class="line">	                <span class="keyword">boolean</span> vegetarian, </div><div class="line">	                <span class="keyword">double</span> price) </div><div class="line">	&#123; </div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">		<span class="keyword">this</span>.description = description;</div><div class="line">		<span class="keyword">this</span>.vegetarian = vegetarian;</div><div class="line">		<span class="keyword">this</span>.price = price;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> description;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> price;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> vegetarian;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.print(<span class="string">"  "</span> + getName());</div><div class="line">		<span class="keyword">if</span> (isVegetarian()) &#123;</div><div class="line">			System.out.print(<span class="string">"(v)"</span>);</div><div class="line">		&#125;</div><div class="line">		System.out.println(<span class="string">", "</span> + getPrice());</div><div class="line">		System.out.println(<span class="string">"     -- "</span> + getDescription());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</div><div class="line">	ArrayList menuComponents = <span class="keyword">new</span> ArrayList();</div><div class="line">	String name;</div><div class="line">	String description;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Menu</span><span class="params">(String name, String description)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">		<span class="keyword">this</span>.description = description;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</div><div class="line">		menuComponents.add(menuComponent);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</div><div class="line">		menuComponents.remove(menuComponent);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> (MenuComponent)menuComponents.get(i);</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> name;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> description;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.print(<span class="string">"\n"</span> + getName());</div><div class="line">		System.out.println(<span class="string">", "</span> + getDescription());</div><div class="line">		System.out.println(<span class="string">"---------------------"</span>);</div><div class="line">  </div><div class="line">		Iterator iterator = menuComponents.iterator();</div><div class="line">		<span class="keyword">while</span> (iterator.hasNext()) &#123;</div><div class="line">			MenuComponent menuComponent = </div><div class="line">				(MenuComponent)iterator.next();</div><div class="line">			menuComponent.print();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</div><div class="line">	MenuComponent allMenus;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Waitress</span><span class="params">(MenuComponent allMenus)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.allMenus = allMenus;</div><div class="line">	&#125;</div><div class="line"> </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">		allMenus.print();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuTestDrive</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">		MenuComponent pancakeHouseMenu = </div><div class="line">			<span class="keyword">new</span> Menu(<span class="string">"PANCAKE HOUSE MENU"</span>, <span class="string">"Breakfast"</span>);</div><div class="line">		MenuComponent dinerMenu = </div><div class="line">			<span class="keyword">new</span> Menu(<span class="string">"DINER MENU"</span>, <span class="string">"Lunch"</span>);</div><div class="line">		MenuComponent cafeMenu = </div><div class="line">			<span class="keyword">new</span> Menu(<span class="string">"CAFE MENU"</span>, <span class="string">"Dinner"</span>);</div><div class="line">		MenuComponent dessertMenu = </div><div class="line">			<span class="keyword">new</span> Menu(<span class="string">"DESSERT MENU"</span>, <span class="string">"Dessert of course!"</span>);</div><div class="line">		MenuComponent coffeeMenu = <span class="keyword">new</span> Menu(<span class="string">"COFFEE MENU"</span>, <span class="string">"Stuff to go with your afternoon coffee"</span>);</div><div class="line">  </div><div class="line">		MenuComponent allMenus = <span class="keyword">new</span> Menu(<span class="string">"ALL MENUS"</span>, <span class="string">"All menus combined"</span>);</div><div class="line">  </div><div class="line">		allMenus.add(pancakeHouseMenu);</div><div class="line">		allMenus.add(dinerMenu);</div><div class="line">		allMenus.add(cafeMenu);</div><div class="line">  </div><div class="line">		pancakeHouseMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"K&amp;B's Pancake Breakfast"</span>, </div><div class="line">			<span class="string">"Pancakes with scrambled eggs, and toast"</span>, </div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">2.99</span>));</div><div class="line">		pancakeHouseMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Regular Pancake Breakfast"</span>, </div><div class="line">			<span class="string">"Pancakes with fried eggs, sausage"</span>, </div><div class="line">			<span class="keyword">false</span>,</div><div class="line">			<span class="number">2.99</span>));</div><div class="line">		pancakeHouseMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Blueberry Pancakes"</span>,</div><div class="line">			<span class="string">"Pancakes made with fresh blueberries, and blueberry syrup"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">3.49</span>));</div><div class="line">		pancakeHouseMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Waffles"</span>,</div><div class="line">			<span class="string">"Waffles, with your choice of blueberries or strawberries"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">3.59</span>));</div><div class="line"></div><div class="line">		dinerMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Vegetarian BLT"</span>,</div><div class="line">			<span class="string">"(Fakin') Bacon with lettuce &amp; tomato on whole wheat"</span>, </div><div class="line">			<span class="keyword">true</span>, </div><div class="line">			<span class="number">2.99</span>));</div><div class="line">		dinerMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"BLT"</span>,</div><div class="line">			<span class="string">"Bacon with lettuce &amp; tomato on whole wheat"</span>, </div><div class="line">			<span class="keyword">false</span>, </div><div class="line">			<span class="number">2.99</span>));</div><div class="line">		dinerMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Soup of the day"</span>,</div><div class="line">			<span class="string">"A bowl of the soup of the day, with a side of potato salad"</span>, </div><div class="line">			<span class="keyword">false</span>, </div><div class="line">			<span class="number">3.29</span>));</div><div class="line">		dinerMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Hotdog"</span>,</div><div class="line">			<span class="string">"A hot dog, with saurkraut, relish, onions, topped with cheese"</span>,</div><div class="line">			<span class="keyword">false</span>, </div><div class="line">			<span class="number">3.05</span>));</div><div class="line">		dinerMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Steamed Veggies and Brown Rice"</span>,</div><div class="line">			<span class="string">"Steamed vegetables over brown rice"</span>, </div><div class="line">			<span class="keyword">true</span>, </div><div class="line">			<span class="number">3.99</span>));</div><div class="line"> </div><div class="line">		dinerMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Pasta"</span>,</div><div class="line">			<span class="string">"Spaghetti with Marinara Sauce, and a slice of sourdough bread"</span>,</div><div class="line">			<span class="keyword">true</span>, </div><div class="line">			<span class="number">3.89</span>));</div><div class="line">   </div><div class="line">		dinerMenu.add(dessertMenu);</div><div class="line">  </div><div class="line">		dessertMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Apple Pie"</span>,</div><div class="line">			<span class="string">"Apple pie with a flakey crust, topped with vanilla icecream"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">1.59</span>));</div><div class="line">  </div><div class="line">		dessertMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Cheesecake"</span>,</div><div class="line">			<span class="string">"Creamy New York cheesecake, with a chocolate graham crust"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">1.99</span>));</div><div class="line">		dessertMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Sorbet"</span>,</div><div class="line">			<span class="string">"A scoop of raspberry and a scoop of lime"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">1.89</span>));</div><div class="line"></div><div class="line">		cafeMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Veggie Burger and Air Fries"</span>,</div><div class="line">			<span class="string">"Veggie burger on a whole wheat bun, lettuce, tomato, and fries"</span>,</div><div class="line">			<span class="keyword">true</span>, </div><div class="line">			<span class="number">3.99</span>));</div><div class="line">		cafeMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Soup of the day"</span>,</div><div class="line">			<span class="string">"A cup of the soup of the day, with a side salad"</span>,</div><div class="line">			<span class="keyword">false</span>, </div><div class="line">			<span class="number">3.69</span>));</div><div class="line">		cafeMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Burrito"</span>,</div><div class="line">			<span class="string">"A large burrito, with whole pinto beans, salsa, guacamole"</span>,</div><div class="line">			<span class="keyword">true</span>, </div><div class="line">			<span class="number">4.29</span>));</div><div class="line"></div><div class="line">		cafeMenu.add(coffeeMenu);</div><div class="line"></div><div class="line">		coffeeMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Coffee Cake"</span>,</div><div class="line">			<span class="string">"Crumbly cake topped with cinnamon and walnuts"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">1.59</span>));</div><div class="line">		coffeeMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Bagel"</span>,</div><div class="line">			<span class="string">"Flavors include sesame, poppyseed, cinnamon raisin, pumpkin"</span>,</div><div class="line">			<span class="keyword">false</span>,</div><div class="line">			<span class="number">0.69</span>));</div><div class="line">		coffeeMenu.add(<span class="keyword">new</span> MenuItem(</div><div class="line">			<span class="string">"Biscotti"</span>,</div><div class="line">			<span class="string">"Three almond or hazelnut biscotti cookies"</span>,</div><div class="line">			<span class="keyword">true</span>,</div><div class="line">			<span class="number">0.89</span>));</div><div class="line"> </div><div class="line">		Waitress waitress = <span class="keyword">new</span> Waitress(allMenus);</div><div class="line">   </div><div class="line">		waitress.printMenu();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="组合模式和组合迭代器"><a href="#组合模式和组合迭代器" class="headerlink" title="组合模式和组合迭代器"></a>组合模式和组合迭代器</h2><p>递归实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</div><div class="line">	<span class="comment">// 其他部分不需要改动</span></div><div class="line"> 	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NullIterator();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</div><div class="line">  	<span class="comment">// 其他部分不需要改动</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> CompositeIterator(menuComponents.iterator());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NullIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositeIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</div><div class="line">	Stack stack = <span class="keyword">new</span> Stack();</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CompositeIterator</span><span class="params">(Iterator iterator)</span> </span>&#123;</div><div class="line">		stack.push(iterator);</div><div class="line">	&#125;</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (hasNext()) &#123;</div><div class="line">			Iterator iterator = (Iterator) stack.peek();</div><div class="line">			MenuComponent component = (MenuComponent) iterator.next();</div><div class="line">			<span class="keyword">if</span> (component <span class="keyword">instanceof</span> Menu) &#123;</div><div class="line">				stack.push(component.createIterator());</div><div class="line">			&#125; </div><div class="line">			<span class="keyword">return</span> component;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">  </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (stack.empty()) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			Iterator iterator = (Iterator) stack.peek();</div><div class="line">			<span class="keyword">if</span> (!iterator.hasNext()) &#123;</div><div class="line">				stack.pop();</div><div class="line">				<span class="keyword">return</span> hasNext();</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">   </div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/55/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><span class="page-number current">56</span><a class="page-number" href="/page/57/">57</a><span class="space">&hellip;</span><a class="page-number" href="/page/66/">66</a><a class="extend next" rel="next" href="/page/57/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/plusaber.jpg"
               alt="Plusaber" />
          <p class="site-author-name" itemprop="name">Plusaber</p>
          <p class="site-description motion-element" itemprop="description">Plusaber's Blog</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">329</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分類</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">標籤</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.kaggle.com" title="Kaggle" target="_blank">Kaggle</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.algolia.com" title="Algolia" target="_blank">Algolia</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://jp.linkedin.com/in/zebangchen" title="LinkedIn" target="_blank">LinkedIn</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://portal.qiniu.com" title="Qiniu" target="_blank">Qiniu</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Plusaber</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'plusaber';
      var disqus_identifier = 'page/56/index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  

  

  


</body>
</html>
